/* Copyright Joyent, Inc. and other Node contributors. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
#include "http_parser.h"
#include <stdlib.h>
#include <assert.h>
#include <stdio.h>
#include <stdlib.h> /* rand */
#include <string.h>
#include <stdarg.h>

#if defined(__APPLE__)
# undef strlncpy
#endif  /* defined(__APPLE__) */

#undef TRUE
#define TRUE 1
#undef FALSE
#define FALSE 0

#define MAX_HEADERS 13
#define MAX_ELEMENT_SIZE 2048
#define MAX_CHUNKS 16

#define MIN(a,b) ((a) < (b) ? (a) : (b))

#define ARRAY_SIZE(x) (sizeof(x) / sizeof(*x))

static http_parser parser;

struct message {
  const char *name; // for debugging purposes
  const char *raw;
  enum http_parser_type type;
  enum http_method method;
  int status_code;
  char response_status[MAX_ELEMENT_SIZE];
  char request_path[MAX_ELEMENT_SIZE];
  char request_url[MAX_ELEMENT_SIZE];
  char fragment[MAX_ELEMENT_SIZE];
  char query_string[MAX_ELEMENT_SIZE];
  char body[MAX_ELEMENT_SIZE];
  size_t body_size;
  const char *host;
  const char *userinfo;
  uint16_t port;
  int num_headers;
  enum { NONE=0, FIELD, VALUE } last_header_element;
  char headers [MAX_HEADERS][2][MAX_ELEMENT_SIZE];
  int should_keep_alive;

  int num_chunks;
  int num_chunks_complete;
  int chunk_lengths[MAX_CHUNKS];

  const char *upgrade; // upgraded body

  unsigned short http_major;
  unsigned short http_minor;

  int message_begin_cb_called;
  int headers_complete_cb_called;
  int message_complete_cb_called;
  int status_cb_called;
  int message_complete_on_eof;
  int body_is_final;
};

static int currently_parsing_eof;

static struct message messages[5];
static int num_messages;
static http_parser_settings *current_pause_parser;

/* * R E Q U E S T S * */
const struct message requests[] =
#define CURL_GET 0
{ {.name= "\x63\x75\x72\x6c\x20\x67\x65\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x74\x65\x73\x74\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x63\x75\x72\x6c\x2f\x37\x2e\x31\x38\x2e\x30\x20\x28\x69\x34\x38\x36\x2d\x70\x63\x2d\x6c\x69\x6e\x75\x78\x2d\x67\x6e\x75\x29\x20\x6c\x69\x62\x63\x75\x72\x6c\x2f\x37\x2e\x31\x38\x2e\x30\x20\x4f\x70\x65\x6e\x53\x53\x4c\x2f\x30\x2e\x39\x2e\x38\x67\x20\x7a\x6c\x69\x62\x2f\x31\x2e\x32\x2e\x33\x2e\x33\x20\x6c\x69\x62\x69\x64\x6e\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x30\x2e\x30\x2e\x30\x2e\x30\x3d\x35\x30\x30\x30\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x3a\x20\x2a\x2f\x2a\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x65\x73\x74"
  ,.request_url= "\x2f\x74\x65\x73\x74"
  ,.num_headers= 3
  ,.headers=
    { { "\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74", "\x63\x75\x72\x6c\x2f\x37\x2e\x31\x38\x2e\x30\x20\x28\x69\x34\x38\x36\x2d\x70\x63\x2d\x6c\x69\x6e\x75\x78\x2d\x67\x6e\x75\x29\x20\x6c\x69\x62\x63\x75\x72\x6c\x2f\x37\x2e\x31\x38\x2e\x30\x20\x4f\x70\x65\x6e\x53\x53\x4c\x2f\x30\x2e\x39\x2e\x38\x67\x20\x7a\x6c\x69\x62\x2f\x31\x2e\x32\x2e\x33\x2e\x33\x20\x6c\x69\x62\x69\x64\x6e\x2f\x31\x2e\x31" }
    , { "\x48\x6f\x73\x74", "\x30\x2e\x30\x2e\x30\x2e\x30\x3d\x35\x30\x30\x30" }
    , { "\x41\x63\x63\x65\x70\x74", "\x2a\x2f\x2a" }
    }
  ,.body= ""
  }

#define FIREFOX_GET 1
, {.name= "\x66\x69\x72\x65\x66\x6f\x78\x20\x67\x65\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x66\x61\x76\x69\x63\x6f\x6e\x2e\x69\x63\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x30\x2e\x30\x2e\x30\x2e\x30\x3d\x35\x30\x30\x30\xd\xa"
         "\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x58\x31\x31\x3b\x20\x55\x3b\x20\x4c\x69\x6e\x75\x78\x20\x69\x36\x38\x36\x3b\x20\x65\x6e\x2d\x55\x53\x3b\x20\x72\x76\x3a\x31\x2e\x39\x29\x20\x47\x65\x63\x6b\x6f\x2f\x32\x30\x30\x38\x30\x36\x31\x30\x31\x35\x20\x46\x69\x72\x65\x66\x6f\x78\x2f\x33\x2e\x30\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x2c\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x68\x74\x6d\x6c\x2b\x78\x6d\x6c\x2c\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x6d\x6c\x3b\x71\x3d\x30\x2e\x39\x2c\x2a\x2f\x2a\x3b\x71\x3d\x30\x2e\x38\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x2d\x4c\x61\x6e\x67\x75\x61\x67\x65\x3a\x20\x65\x6e\x2d\x75\x73\x2c\x65\x6e\x3b\x71\x3d\x30\x2e\x35\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x67\x7a\x69\x70\x2c\x64\x65\x66\x6c\x61\x74\x65\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x2d\x43\x68\x61\x72\x73\x65\x74\x3a\x20\x49\x53\x4f\x2d\x38\x38\x35\x39\x2d\x31\x2c\x75\x74\x66\x2d\x38\x3b\x71\x3d\x30\x2e\x37\x2c\x2a\x3b\x71\x3d\x30\x2e\x37\xd\xa"
         "\x4b\x65\x65\x70\x2d\x41\x6c\x69\x76\x65\x3a\x20\x33\x30\x30\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x66\x61\x76\x69\x63\x6f\x6e\x2e\x69\x63\x6f"
  ,.request_url= "\x2f\x66\x61\x76\x69\x63\x6f\x6e\x2e\x69\x63\x6f"
  ,.num_headers= 8
  ,.headers=
    { { "\x48\x6f\x73\x74", "\x30\x2e\x30\x2e\x30\x2e\x30\x3d\x35\x30\x30\x30" }
    , { "\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74", "\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x58\x31\x31\x3b\x20\x55\x3b\x20\x4c\x69\x6e\x75\x78\x20\x69\x36\x38\x36\x3b\x20\x65\x6e\x2d\x55\x53\x3b\x20\x72\x76\x3a\x31\x2e\x39\x29\x20\x47\x65\x63\x6b\x6f\x2f\x32\x30\x30\x38\x30\x36\x31\x30\x31\x35\x20\x46\x69\x72\x65\x66\x6f\x78\x2f\x33\x2e\x30" }
    , { "\x41\x63\x63\x65\x70\x74", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x2c\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x68\x74\x6d\x6c\x2b\x78\x6d\x6c\x2c\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x6d\x6c\x3b\x71\x3d\x30\x2e\x39\x2c\x2a\x2f\x2a\x3b\x71\x3d\x30\x2e\x38" }
    , { "\x41\x63\x63\x65\x70\x74\x2d\x4c\x61\x6e\x67\x75\x61\x67\x65", "\x65\x6e\x2d\x75\x73\x2c\x65\x6e\x3b\x71\x3d\x30\x2e\x35" }
    , { "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x67\x7a\x69\x70\x2c\x64\x65\x66\x6c\x61\x74\x65" }
    , { "\x41\x63\x63\x65\x70\x74\x2d\x43\x68\x61\x72\x73\x65\x74", "\x49\x53\x4f\x2d\x38\x38\x35\x39\x2d\x31\x2c\x75\x74\x66\x2d\x38\x3b\x71\x3d\x30\x2e\x37\x2c\x2a\x3b\x71\x3d\x30\x2e\x37" }
    , { "\x4b\x65\x65\x70\x2d\x41\x6c\x69\x76\x65", "\x33\x30\x30" }
    , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65" }
    }
  ,.body= ""
  }

#define DUMBLUCK 2
, {.name= "\x64\x75\x6d\x62\x6c\x75\x63\x6b"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x64\x75\x6d\x62\x6c\x75\x63\x6b\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x3a\x2b\x2b\x2b\x2b\x2b\x2b\x2b\x2b\x2b\x2b\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x64\x75\x6d\x62\x6c\x75\x63\x6b"
  ,.request_url= "\x2f\x64\x75\x6d\x62\x6c\x75\x63\x6b"
  ,.num_headers= 1
  ,.headers=
    { { "\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61",  "\x2b\x2b\x2b\x2b\x2b\x2b\x2b\x2b\x2b\x2b" }
    }
  ,.body= ""
  }

#define FRAGMENT_IN_URI 3
, {.name= "\x66\x72\x61\x67\x6d\x65\x6e\x74\x20\x69\x6e\x20\x75\x72\x6c"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x66\x6f\x72\x75\x6d\x73\x2f\x31\x2f\x74\x6f\x70\x69\x63\x73\x2f\x32\x33\x37\x35\x3f\x70\x61\x67\x65\x3d\x31\x23\x70\x6f\x73\x74\x73\x2d\x31\x37\x34\x30\x38\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= "\x70\x61\x67\x65\x3d\x31"
  ,.fragment= "\x70\x6f\x73\x74\x73\x2d\x31\x37\x34\x30\x38"
  ,.request_path= "\x2f\x66\x6f\x72\x75\x6d\x73\x2f\x31\x2f\x74\x6f\x70\x69\x63\x73\x2f\x32\x33\x37\x35"
  /* XXX request url does include fragment? */
  ,.request_url= "\x2f\x66\x6f\x72\x75\x6d\x73\x2f\x31\x2f\x74\x6f\x70\x69\x63\x73\x2f\x32\x33\x37\x35\x3f\x70\x61\x67\x65\x3d\x31\x23\x70\x6f\x73\x74\x73\x2d\x31\x37\x34\x30\x38"
  ,.num_headers= 0
  ,.body= ""
  }

#define GET_NO_HEADERS_NO_BODY 4
, {.name= "\x67\x65\x74\x20\x6e\x6f\x20\x68\x65\x61\x64\x65\x72\x73\x20\x6e\x6f\x20\x62\x6f\x64\x79"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x67\x65\x74\x5f\x6e\x6f\x5f\x68\x65\x61\x64\x65\x72\x73\x5f\x6e\x6f\x5f\x62\x6f\x64\x79\x2f\x77\x6f\x72\x6c\x64\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE /* would need Connection: close */
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x67\x65\x74\x5f\x6e\x6f\x5f\x68\x65\x61\x64\x65\x72\x73\x5f\x6e\x6f\x5f\x62\x6f\x64\x79\x2f\x77\x6f\x72\x6c\x64"
  ,.request_url= "\x2f\x67\x65\x74\x5f\x6e\x6f\x5f\x68\x65\x61\x64\x65\x72\x73\x5f\x6e\x6f\x5f\x62\x6f\x64\x79\x2f\x77\x6f\x72\x6c\x64"
  ,.num_headers= 0
  ,.body= ""
  }

#define GET_ONE_HEADER_NO_BODY 5
, {.name= "\x67\x65\x74\x20\x6f\x6e\x65\x20\x68\x65\x61\x64\x65\x72\x20\x6e\x6f\x20\x62\x6f\x64\x79"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x67\x65\x74\x5f\x6f\x6e\x65\x5f\x68\x65\x61\x64\x65\x72\x5f\x6e\x6f\x5f\x62\x6f\x64\x79\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x3a\x20\x2a\x2f\x2a\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE /* would need Connection: close */
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x67\x65\x74\x5f\x6f\x6e\x65\x5f\x68\x65\x61\x64\x65\x72\x5f\x6e\x6f\x5f\x62\x6f\x64\x79"
  ,.request_url= "\x2f\x67\x65\x74\x5f\x6f\x6e\x65\x5f\x68\x65\x61\x64\x65\x72\x5f\x6e\x6f\x5f\x62\x6f\x64\x79"
  ,.num_headers= 1
  ,.headers=
    { { "\x41\x63\x63\x65\x70\x74" , "\x2a\x2f\x2a" }
    }
  ,.body= ""
  }

#define GET_FUNKY_CONTENT_LENGTH 6
, {.name= "\x67\x65\x74\x20\x66\x75\x6e\x6b\x79\x20\x63\x6f\x6e\x74\x65\x6e\x74\x20\x6c\x65\x6e\x67\x74\x68\x20\x62\x6f\x64\x79\x20\x68\x65\x6c\x6c\x6f"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x67\x65\x74\x5f\x66\x75\x6e\x6b\x79\x5f\x63\x6f\x6e\x74\x65\x6e\x74\x5f\x6c\x65\x6e\x67\x74\x68\x5f\x62\x6f\x64\x79\x5f\x68\x65\x6c\x6c\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x30\xd\xa"
         "\x63\x6f\x6e\x54\x45\x4e\x54\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x35\xd\xa"
         "\xd\xa"
         "\x48\x45\x4c\x4c\x4f"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x67\x65\x74\x5f\x66\x75\x6e\x6b\x79\x5f\x63\x6f\x6e\x74\x65\x6e\x74\x5f\x6c\x65\x6e\x67\x74\x68\x5f\x62\x6f\x64\x79\x5f\x68\x65\x6c\x6c\x6f"
  ,.request_url= "\x2f\x67\x65\x74\x5f\x66\x75\x6e\x6b\x79\x5f\x63\x6f\x6e\x74\x65\x6e\x74\x5f\x6c\x65\x6e\x67\x74\x68\x5f\x62\x6f\x64\x79\x5f\x68\x65\x6c\x6c\x6f"
  ,.num_headers= 1
  ,.headers=
    { { "\x63\x6f\x6e\x54\x45\x4e\x54\x2d\x4c\x65\x6e\x67\x74\x68" , "\x35" }
    }
  ,.body= "\x48\x45\x4c\x4c\x4f"
  }

#define POST_IDENTITY_BODY_WORLD 7
, {.name= "\x70\x6f\x73\x74\x20\x69\x64\x65\x6e\x74\x69\x74\x79\x20\x62\x6f\x64\x79\x20\x77\x6f\x72\x6c\x64"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x70\x6f\x73\x74\x5f\x69\x64\x65\x6e\x74\x69\x74\x79\x5f\x62\x6f\x64\x79\x5f\x77\x6f\x72\x6c\x64\x3f\x71\x3d\x73\x65\x61\x72\x63\x68\x23\x68\x65\x79\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x3a\x20\x2a\x2f\x2a\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x35\xd\xa"
         "\xd\xa"
         "\x57\x6f\x72\x6c\x64"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= "\x71\x3d\x73\x65\x61\x72\x63\x68"
  ,.fragment= "\x68\x65\x79"
  ,.request_path= "\x2f\x70\x6f\x73\x74\x5f\x69\x64\x65\x6e\x74\x69\x74\x79\x5f\x62\x6f\x64\x79\x5f\x77\x6f\x72\x6c\x64"
  ,.request_url= "\x2f\x70\x6f\x73\x74\x5f\x69\x64\x65\x6e\x74\x69\x74\x79\x5f\x62\x6f\x64\x79\x5f\x77\x6f\x72\x6c\x64\x3f\x71\x3d\x73\x65\x61\x72\x63\x68\x23\x68\x65\x79"
  ,.num_headers= 2
  ,.headers=
    { { "\x41\x63\x63\x65\x70\x74", "\x2a\x2f\x2a" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x35" }
    }
  ,.body= "\x57\x6f\x72\x6c\x64"
  }

#define POST_CHUNKED_ALL_YOUR_BASE 8
, {.name= "\x70\x6f\x73\x74\x20\x2d\x20\x63\x68\x75\x6e\x6b\x65\x64\x20\x62\x6f\x64\x79\x3a\x20\x61\x6c\x6c\x20\x79\x6f\x75\x72\x20\x62\x61\x73\x65\x20\x61\x72\x65\x20\x62\x65\x6c\x6f\x6e\x67\x20\x74\x6f\x20\x75\x73"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x70\x6f\x73\x74\x5f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x61\x6c\x6c\x5f\x79\x6f\x75\x72\x5f\x62\x61\x73\x65\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x31\x65\xd\xaa\x6c\x6c\x20\x79\x6f\x75\x72\x20\x62\x61\x73\x65\x20\x61\x72\x65\x20\x62\x65\x6c\x6f\x6e\x67\x20\x74\x6f\x20\x75\x73\xd\xa"
         "\x30\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x70\x6f\x73\x74\x5f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x61\x6c\x6c\x5f\x79\x6f\x75\x72\x5f\x62\x61\x73\x65"
  ,.request_url= "\x2f\x70\x6f\x73\x74\x5f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x61\x6c\x6c\x5f\x79\x6f\x75\x72\x5f\x62\x61\x73\x65"
  ,.num_headers= 1
  ,.headers=
    { { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67" , "\x63\x68\x75\x6e\x6b\x65\x64" }
    }
  ,.body= "\x61\x6c\x6c\x20\x79\x6f\x75\x72\x20\x62\x61\x73\x65\x20\x61\x72\x65\x20\x62\x65\x6c\x6f\x6e\x67\x20\x74\x6f\x20\x75\x73"
  ,.num_chunks_complete= 2
  ,.chunk_lengths= { 0x1e }
  }

#define TWO_CHUNKS_MULT_ZERO_END 9
, {.name= "\x74\x77\x6f\x20\x63\x68\x75\x6e\x6b\x73\x20\x3b\x20\x74\x72\x69\x70\x6c\x65\x20\x7a\x65\x72\x6f\x20\x65\x6e\x64\x69\x6e\x67"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x74\x77\x6f\x5f\x63\x68\x75\x6e\x6b\x73\x5f\x6d\x75\x6c\x74\x5f\x7a\x65\x72\x6f\x5f\x65\x6e\x64\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x35\xd\xa\x68\x65\x6c\x6c\x6f\xd\xa"
         "\x36\xd\xa\x20\x77\x6f\x72\x6c\x64\xd\xa"
         "\x30\x30\x30\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x77\x6f\x5f\x63\x68\x75\x6e\x6b\x73\x5f\x6d\x75\x6c\x74\x5f\x7a\x65\x72\x6f\x5f\x65\x6e\x64"
  ,.request_url= "\x2f\x74\x77\x6f\x5f\x63\x68\x75\x6e\x6b\x73\x5f\x6d\x75\x6c\x74\x5f\x7a\x65\x72\x6f\x5f\x65\x6e\x64"
  ,.num_headers= 1
  ,.headers=
    { { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
    }
  ,.body= "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  ,.num_chunks_complete= 3
  ,.chunk_lengths= { 5, 6 }
  }

#define CHUNKED_W_TRAILING_HEADERS 10
, {.name= "\x63\x68\x75\x6e\x6b\x65\x64\x20\x77\x69\x74\x68\x20\x74\x72\x61\x69\x6c\x69\x6e\x67\x20\x68\x65\x61\x64\x65\x72\x73\x2e\x20\x62\x6c\x65\x63\x68\x2e"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x77\x5f\x74\x72\x61\x69\x6c\x69\x6e\x67\x5f\x68\x65\x61\x64\x65\x72\x73\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x35\xd\xa\x68\x65\x6c\x6c\x6f\xd\xa"
         "\x36\xd\xa\x20\x77\x6f\x72\x6c\x64\xd\xa"
         "\x30\xd\xa"
         "\x56\x61\x72\x79\x3a\x20\x2a\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x77\x5f\x74\x72\x61\x69\x6c\x69\x6e\x67\x5f\x68\x65\x61\x64\x65\x72\x73"
  ,.request_url= "\x2f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x77\x5f\x74\x72\x61\x69\x6c\x69\x6e\x67\x5f\x68\x65\x61\x64\x65\x72\x73"
  ,.num_headers= 3
  ,.headers=
    { { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67",  "\x63\x68\x75\x6e\x6b\x65\x64" }
    , { "\x56\x61\x72\x79", "\x2a" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e" }
    }
  ,.body= "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  ,.num_chunks_complete= 3
  ,.chunk_lengths= { 5, 6 }
  }

#define CHUNKED_W_NONSENSE_AFTER_LENGTH 11
, {.name= "\x77\x69\x74\x68\x20\x6e\x6f\x6e\x73\x65\x6e\x73\x65\x20\x61\x66\x74\x65\x72\x20\x74\x68\x65\x20\x6c\x65\x6e\x67\x74\x68"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x77\x5f\x6e\x6f\x6e\x73\x65\x6e\x73\x65\x5f\x61\x66\x74\x65\x72\x5f\x6c\x65\x6e\x67\x74\x68\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x35\x3b\x20\x69\x6c\x6f\x76\x65\x77\x33\x3b\x77\x68\x61\x74\x74\x68\x65\x6c\x75\x63\x6b\x3d\x61\x72\x65\x74\x68\x65\x73\x65\x70\x61\x72\x61\x6d\x65\x74\x65\x72\x73\x66\x6f\x72\xd\xa\x68\x65\x6c\x6c\x6f\xd\xa"
         "\x36\x3b\x20\x62\x6c\x61\x68\x62\x6c\x61\x68\x3b\x20\x62\x6c\x61\x68\xd\xa\x20\x77\x6f\x72\x6c\x64\xd\xa"
         "\x30\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x77\x5f\x6e\x6f\x6e\x73\x65\x6e\x73\x65\x5f\x61\x66\x74\x65\x72\x5f\x6c\x65\x6e\x67\x74\x68"
  ,.request_url= "\x2f\x63\x68\x75\x6e\x6b\x65\x64\x5f\x77\x5f\x6e\x6f\x6e\x73\x65\x6e\x73\x65\x5f\x61\x66\x74\x65\x72\x5f\x6c\x65\x6e\x67\x74\x68"
  ,.num_headers= 1
  ,.headers=
    { { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
    }
  ,.body= "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  ,.num_chunks_complete= 3
  ,.chunk_lengths= { 5, 6 }
  }

#define WITH_QUOTES 12
, {.name= "\x77\x69\x74\x68\x20\x71\x75\x6f\x74\x65\x73"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x77\x69\x74\x68\x5f\x22\x73\x74\x75\x70\x69\x64\x22\x5f\x71\x75\x6f\x74\x65\x73\x3f\x66\x6f\x6f\x3d\x22\x62\x61\x72\x22\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= "\x66\x6f\x6f\x3d\x22\x62\x61\x72\x22"
  ,.fragment= ""
  ,.request_path= "\x2f\x77\x69\x74\x68\x5f\x22\x73\x74\x75\x70\x69\x64\x22\x5f\x71\x75\x6f\x74\x65\x73"
  ,.request_url= "\x2f\x77\x69\x74\x68\x5f\x22\x73\x74\x75\x70\x69\x64\x22\x5f\x71\x75\x6f\x74\x65\x73\x3f\x66\x6f\x6f\x3d\x22\x62\x61\x72\x22"
  ,.num_headers= 0
  ,.headers= { }
  ,.body= ""
  }

#define APACHEBENCH_GET 13
/* The server receiving this request SHOULD NOT wait for EOF
 * to know that content-length == 0.
 * How to represent this in a unit test? message_complete_on_eof
 * Compare with NO_CONTENT_LENGTH_RESPONSE.
 */
, {.name = "\x61\x70\x61\x63\x68\x65\x62\x65\x6e\x63\x68\x20\x67\x65\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x74\x65\x73\x74\x20\x48\x54\x54\x50\x2f\x31\x2e\x30\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x30\x2e\x30\x2e\x30\x2e\x30\x3a\x35\x30\x30\x30\xd\xa"
         "\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x41\x70\x61\x63\x68\x65\x42\x65\x6e\x63\x68\x2f\x32\x2e\x33\xd\xa"
         "\x41\x63\x63\x65\x70\x74\x3a\x20\x2a\x2f\x2a\xd\xa\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x65\x73\x74"
  ,.request_url= "\x2f\x74\x65\x73\x74"
  ,.num_headers= 3
  ,.headers= { { "\x48\x6f\x73\x74", "\x30\x2e\x30\x2e\x30\x2e\x30\x3a\x35\x30\x30\x30" }
             , { "\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74", "\x41\x70\x61\x63\x68\x65\x42\x65\x6e\x63\x68\x2f\x32\x2e\x33" }
             , { "\x41\x63\x63\x65\x70\x74", "\x2a\x2f\x2a" }
             }
  ,.body= ""
  }

#define QUERY_URL_WITH_QUESTION_MARK_GET 14
/* Some clients include '?' characters in query strings.
 */
, {.name = "\x71\x75\x65\x72\x79\x20\x75\x72\x6c\x20\x77\x69\x74\x68\x20\x71\x75\x65\x73\x74\x69\x6f\x6e\x20\x6d\x61\x72\x6b"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x74\x65\x73\x74\x2e\x63\x67\x69\x3f\x66\x6f\x6f\x3d\x62\x61\x72\x3f\x62\x61\x7a\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= "\x66\x6f\x6f\x3d\x62\x61\x72\x3f\x62\x61\x7a"
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x65\x73\x74\x2e\x63\x67\x69"
  ,.request_url= "\x2f\x74\x65\x73\x74\x2e\x63\x67\x69\x3f\x66\x6f\x6f\x3d\x62\x61\x72\x3f\x62\x61\x7a"
  ,.num_headers= 0
  ,.headers= {}
  ,.body= ""
  }

#define PREFIX_NEWLINE_GET 15
/* Some clients, especially after a POST in a keep-alive connection,
 * will send an extra CRLF before the next request
 */
, {.name = "\x6e\x65\x77\x6c\x69\x6e\x65\x20\x70\x72\x65\x66\x69\x78\x20\x67\x65\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\xd\xa\x47\x45\x54\x20\x2f\x74\x65\x73\x74\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x65\x73\x74"
  ,.request_url= "\x2f\x74\x65\x73\x74"
  ,.num_headers= 0
  ,.headers= { }
  ,.body= ""
  }

#define UPGRADE_REQUEST 16
, {.name = "\x75\x70\x67\x72\x61\x64\x65\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x64\x65\x6d\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x55\x70\x67\x72\x61\x64\x65\xd\xa"
         "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x32\x3a\x20\x31\x32\x39\x39\x38\x20\x35\x20\x59\x33\x20\x31\x20\x20\x2e\x50\x30\x30\xd\xa"
         "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x50\x72\x6f\x74\x6f\x63\x6f\x6c\x3a\x20\x73\x61\x6d\x70\x6c\x65\xd\xa"
         "\x55\x70\x67\x72\x61\x64\x65\x3a\x20\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\xd\xa"
         "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x31\x3a\x20\x34\x20\x40\x31\x20\x20\x34\x36\x35\x34\x36\x78\x57\x25\x30\x6c\x20\x31\x20\x35\xd\xa"
         "\x4f\x72\x69\x67\x69\x6e\x3a\x20\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\xd\xa"
         "\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x64\x65\x6d\x6f"
  ,.request_url= "\x2f\x64\x65\x6d\x6f"
  ,.num_headers= 7
  ,.upgrade="\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.headers= { { "\x48\x6f\x73\x74", "\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x55\x70\x67\x72\x61\x64\x65" }
             , { "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x32", "\x31\x32\x39\x39\x38\x20\x35\x20\x59\x33\x20\x31\x20\x20\x2e\x50\x30\x30" }
             , { "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x50\x72\x6f\x74\x6f\x63\x6f\x6c", "\x73\x61\x6d\x70\x6c\x65" }
             , { "\x55\x70\x67\x72\x61\x64\x65", "\x57\x65\x62\x53\x6f\x63\x6b\x65\x74" }
             , { "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x31", "\x34\x20\x40\x31\x20\x20\x34\x36\x35\x34\x36\x78\x57\x25\x30\x6c\x20\x31\x20\x35" }
             , { "\x4f\x72\x69\x67\x69\x6e", "\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             }
  ,.body= ""
  }

#define CONNECT_REQUEST 17
, {.name = "\x63\x6f\x6e\x6e\x65\x63\x74\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x43\x4f\x4e\x4e\x45\x43\x54\x20\x30\x2d\x68\x6f\x6d\x65\x30\x2e\x6e\x65\x74\x73\x63\x61\x70\x65\x2e\x63\x6f\x6d\x3a\x34\x34\x33\x20\x48\x54\x54\x50\x2f\x31\x2e\x30\xd\xa"
         "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e\xd\xa"
         "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e\x3a\x20\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d\xd\xa"
         "\xd\xa"
         "\x73\x6f\x6d\x65\x20\x64\x61\x74\x61\xd\xa"
         "\x61\x6e\x64\x20\x79\x65\x74\x20\x65\x76\x65\x6e\x20\x6d\x6f\x72\x65\x20\x64\x61\x74\x61"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_CONNECT
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= ""
  ,.request_url= "\x30\x2d\x68\x6f\x6d\x65\x30\x2e\x6e\x65\x74\x73\x63\x61\x70\x65\x2e\x63\x6f\x6d\x3a\x34\x34\x33"
  ,.num_headers= 2
  ,.upgrade="\x73\x6f\x6d\x65\x20\x64\x61\x74\x61\xd\xaa\x6e\x64\x20\x79\x65\x74\x20\x65\x76\x65\x6e\x20\x6d\x6f\x72\x65\x20\x64\x61\x74\x61"
  ,.headers= { { "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74", "\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e" }
             , { "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e", "\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d" }
             }
  ,.body= ""
  }

#define REPORT_REQ 18
, {.name= "\x72\x65\x70\x6f\x72\x74\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x52\x45\x50\x4f\x52\x54\x20\x2f\x74\x65\x73\x74\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_REPORT
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x65\x73\x74"
  ,.request_url= "\x2f\x74\x65\x73\x74"
  ,.num_headers= 0
  ,.headers= {}
  ,.body= ""
  }

#define NO_HTTP_VERSION 19
, {.name= "\x72\x65\x71\x75\x65\x73\x74\x20\x77\x69\x74\x68\x20\x6e\x6f\x20\x68\x74\x74\x70\x20\x76\x65\x72\x73\x69\x6f\x6e"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 0
  ,.http_minor= 9
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f"
  ,.request_url= "\x2f"
  ,.num_headers= 0
  ,.headers= {}
  ,.body= ""
  }

#define MSEARCH_REQ 20
, {.name= "\x6d\x2d\x73\x65\x61\x72\x63\x68\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x4d\x2d\x53\x45\x41\x52\x43\x48\x20\x2a\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x4f\x53\x54\x3a\x20\x32\x33\x39\x2e\x32\x35\x35\x2e\x32\x35\x35\x2e\x32\x35\x30\x3a\x31\x39\x30\x30\xd\xa"
         "\x4d\x41\x4e\x3a\x20\x22\x73\x73\x64\x70\x3a\x64\x69\x73\x63\x6f\x76\x65\x72\x22\xd\xa"
         "\x53\x54\x3a\x20\x22\x73\x73\x64\x70\x3a\x61\x6c\x6c\x22\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_MSEARCH
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2a"
  ,.request_url= "\x2a"
  ,.num_headers= 3
  ,.headers= { { "\x48\x4f\x53\x54", "\x32\x33\x39\x2e\x32\x35\x35\x2e\x32\x35\x35\x2e\x32\x35\x30\x3a\x31\x39\x30\x30" }
             , { "\x4d\x41\x4e", "\x22\x73\x73\x64\x70\x3a\x64\x69\x73\x63\x6f\x76\x65\x72\x22" }
             , { "\x53\x54", "\x22\x73\x73\x64\x70\x3a\x61\x6c\x6c\x22" }
             }
  ,.body= ""
  }

#define LINE_FOLDING_IN_HEADER 21
, {.name= "\x6c\x69\x6e\x65\x20\x66\x6f\x6c\x64\x69\x6e\x67\x20\x69\x6e\x20\x68\x65\x61\x64\x65\x72\x20\x76\x61\x6c\x75\x65"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x4c\x69\x6e\x65\x31\x3a\x20\x20\x20\x61\x62\x63\xd\xa"
         "\x9d\x65\x66\xd\xa"
         "\x20\x67\x68\x69\xd\xa"
         "\x9\x9\x6a\x6b\x6c\xd\xa"
         "\x20\x20\x6d\x6e\x6f\x20\xd\xa"
         "\x9\x20\x9\x71\x72\x73\xd\xa"
         "\x4c\x69\x6e\x65\x32\x3a\x20\x9\x20\x6c\x69\x6e\x65\x32\x9\xd\xa"
         "\x4c\x69\x6e\x65\x33\x3a\xd\xa"
         "\x20\x6c\x69\x6e\x65\x33\xd\xa"
         "\x4c\x69\x6e\x65\x34\x3a\x20\xd\xa"
         "\x20\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\xd\xa"
         "\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f"
  ,.request_url= "\x2f"
  ,.num_headers= 5
  ,.headers= { { "\x4c\x69\x6e\x65\x31", "\x61\x62\x63\x9d\x65\x66\x20\x67\x68\x69\x9\x9\x6a\x6b\x6c\x20\x20\x6d\x6e\x6f\x20\x9\x20\x9\x71\x72\x73" }
             , { "\x4c\x69\x6e\x65\x32", "\x6c\x69\x6e\x65\x32\x9" }
             , { "\x4c\x69\x6e\x65\x33", "\x6c\x69\x6e\x65\x33" }
             , { "\x4c\x69\x6e\x65\x34", "" }
             , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" },
             }
  ,.body= ""
  }


#define QUERY_TERMINATED_HOST 22
, {.name= "\x68\x6f\x73\x74\x20\x74\x65\x72\x6d\x69\x6e\x61\x74\x65\x64\x20\x62\x79\x20\x61\x20\x71\x75\x65\x72\x79\x20\x73\x74\x72\x69\x6e\x67"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x68\x74\x74\x70\x3a\x2f\x2f\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3f\x68\x61\x69\x6c\x3d\x61\x6c\x6c\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= "\x68\x61\x69\x6c\x3d\x61\x6c\x6c"
  ,.fragment= ""
  ,.request_path= ""
  ,.request_url= "\x68\x74\x74\x70\x3a\x2f\x2f\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3f\x68\x61\x69\x6c\x3d\x61\x6c\x6c"
  ,.host= "\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67"
  ,.num_headers= 0
  ,.headers= { }
  ,.body= ""
  }

#define QUERY_TERMINATED_HOSTPORT 23
, {.name= "\x68\x6f\x73\x74\x3a\x70\x6f\x72\x74\x20\x74\x65\x72\x6d\x69\x6e\x61\x74\x65\x64\x20\x62\x79\x20\x61\x20\x71\x75\x65\x72\x79\x20\x73\x74\x72\x69\x6e\x67"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x68\x74\x74\x70\x3a\x2f\x2f\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3a\x31\x32\x33\x34\x3f\x68\x61\x69\x6c\x3d\x61\x6c\x6c\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= "\x68\x61\x69\x6c\x3d\x61\x6c\x6c"
  ,.fragment= ""
  ,.request_path= ""
  ,.request_url= "\x68\x74\x74\x70\x3a\x2f\x2f\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3a\x31\x32\x33\x34\x3f\x68\x61\x69\x6c\x3d\x61\x6c\x6c"
  ,.host= "\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67"
  ,.port= 1234
  ,.num_headers= 0
  ,.headers= { }
  ,.body= ""
  }

#define SPACE_TERMINATED_HOSTPORT 24
, {.name= "\x68\x6f\x73\x74\x3a\x70\x6f\x72\x74\x20\x74\x65\x72\x6d\x69\x6e\x61\x74\x65\x64\x20\x62\x79\x20\x61\x20\x73\x70\x61\x63\x65"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x68\x74\x74\x70\x3a\x2f\x2f\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3a\x31\x32\x33\x34\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= ""
  ,.request_url= "\x68\x74\x74\x70\x3a\x2f\x2f\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3a\x31\x32\x33\x34"
  ,.host= "\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67"
  ,.port= 1234
  ,.num_headers= 0
  ,.headers= { }
  ,.body= ""
  }

#define PATCH_REQ 25
, {.name = "\x50\x41\x54\x43\x48\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x41\x54\x43\x48\x20\x2f\x66\x69\x6c\x65\x2e\x74\x78\x74\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x65\x78\x61\x6d\x70\x6c\x65\xd\xa"
         "\x49\x66\x2d\x4d\x61\x74\x63\x68\x3a\x20\x22\x65\x30\x30\x32\x33\x61\x61\x34\x65\x22\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\x30\xd\xa"
         "\xd\xa"
         "\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_PATCH
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x66\x69\x6c\x65\x2e\x74\x78\x74"
  ,.request_url= "\x2f\x66\x69\x6c\x65\x2e\x74\x78\x74"
  ,.num_headers= 4
  ,.headers= { { "\x48\x6f\x73\x74", "\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x65\x78\x61\x6d\x70\x6c\x65" }
             , { "\x49\x66\x2d\x4d\x61\x74\x63\x68", "\x22\x65\x30\x30\x32\x33\x61\x61\x34\x65\x22" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x31\x30" }
             }
  ,.body= "\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63"
  }

#define CONNECT_CAPS_REQUEST 26
, {.name = "\x63\x6f\x6e\x6e\x65\x63\x74\x20\x63\x61\x70\x73\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x43\x4f\x4e\x4e\x45\x43\x54\x20\x48\x4f\x4d\x45\x30\x2e\x4e\x45\x54\x53\x43\x41\x50\x45\x2e\x43\x4f\x4d\x3a\x34\x34\x33\x20\x48\x54\x54\x50\x2f\x31\x2e\x30\xd\xa"
         "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e\xd\xa"
         "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e\x3a\x20\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_CONNECT
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= ""
  ,.request_url= "\x48\x4f\x4d\x45\x30\x2e\x4e\x45\x54\x53\x43\x41\x50\x45\x2e\x43\x4f\x4d\x3a\x34\x34\x33"
  ,.num_headers= 2
  ,.upgrade=""
  ,.headers= { { "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74", "\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e" }
             , { "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e", "\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d" }
             }
  ,.body= ""
  }

#if !HTTP_PARSER_STRICT
#define UTF8_PATH_REQ 27
, {.name= "\x75\x74\x66\x2d\x38\x20\x70\x61\x74\x68\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\xff\xff\xff\xff\x2f\xff\xff\x74\x2f\x70\x6f\x70\x65\x3f\x71\x3d\x31\x23\x6e\x61\x72\x66\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x67\x69\x74\x68\x75\x62\x2e\x63\x6f\x6d\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= "\x71\x3d\x31"
  ,.fragment= "\x6e\x61\x72\x66"
  ,.request_path= "\x2f\xff\xff\xff\xff\x2f\xff\xff\x74\x2f\x70\x6f\x70\x65"
  ,.request_url= "\x2f\xff\xff\xff\xff\x2f\xff\xff\x74\x2f\x70\x6f\x70\x65\x3f\x71\x3d\x31\x23\x6e\x61\x72\x66"
  ,.num_headers= 1
  ,.headers= { {"\x48\x6f\x73\x74", "\x67\x69\x74\x68\x75\x62\x2e\x63\x6f\x6d" }
             }
  ,.body= ""
  }

#define HOSTNAME_UNDERSCORE 28
, {.name = "\x68\x6f\x73\x74\x6e\x61\x6d\x65\x20\x75\x6e\x64\x65\x72\x73\x63\x6f\x72\x65"
  ,.type= HTTP_REQUEST
  ,.raw= "\x43\x4f\x4e\x4e\x45\x43\x54\x20\x68\x6f\x6d\x65\x5f\x30\x2e\x6e\x65\x74\x73\x63\x61\x70\x65\x2e\x63\x6f\x6d\x3a\x34\x34\x33\x20\x48\x54\x54\x50\x2f\x31\x2e\x30\xd\xa"
         "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e\xd\xa"
         "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e\x3a\x20\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_CONNECT
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= ""
  ,.request_url= "\x68\x6f\x6d\x65\x5f\x30\x2e\x6e\x65\x74\x73\x63\x61\x70\x65\x2e\x63\x6f\x6d\x3a\x34\x34\x33"
  ,.num_headers= 2
  ,.upgrade=""
  ,.headers= { { "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74", "\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e" }
             , { "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e", "\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d" }
             }
  ,.body= ""
  }
#endif  /* !HTTP_PARSER_STRICT */

/* see https://github.com/ry/http-parser/issues/47 */
#define EAT_TRAILING_CRLF_NO_CONNECTION_CLOSE 29
, {.name = "\x65\x61\x74\x20\x43\x52\x4c\x46\x20\x62\x65\x74\x77\x65\x65\x6e\x20\x72\x65\x71\x75\x65\x73\x74\x73\x2c\x20\x6e\x6f\x20\x22\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\x22\x20\x68\x65\x61\x64\x65\x72"
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x34\xd\xa"
         "\xd\xa"
         "\x71\x3d\x34\x32\xd\xa" /* note the trailing CRLF */
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f"
  ,.request_url= "\x2f"
  ,.num_headers= 3
  ,.upgrade= 0
  ,.headers= { { "\x48\x6f\x73\x74", "\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x34" }
             }
  ,.body= "\x71\x3d\x34\x32"
  }

/* see https://github.com/ry/http-parser/issues/47 */
#define EAT_TRAILING_CRLF_WITH_CONNECTION_CLOSE 30
, {.name = "\x65\x61\x74\x20\x43\x52\x4c\x46\x20\x62\x65\x74\x77\x65\x65\x6e\x20\x72\x65\x71\x75\x65\x73\x74\x73\x20\x65\x76\x65\x6e\x20\x69\x66\x20\x22\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\x22\x20\x69\x73\x20\x73\x65\x74"
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x34\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\xd\xa"
         "\x71\x3d\x34\x32\xd\xa" /* note the trailing CRLF */
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE /* input buffer isn't empty when on_message_complete is called */
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f"
  ,.request_url= "\x2f"
  ,.num_headers= 4
  ,.upgrade= 0
  ,.headers= { { "\x48\x6f\x73\x74", "\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x34" }
             , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
             }
  ,.body= "\x71\x3d\x34\x32"
  }

#define PURGE_REQ 31
, {.name = "\x50\x55\x52\x47\x45\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x55\x52\x47\x45\x20\x2f\x66\x69\x6c\x65\x2e\x74\x78\x74\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_PURGE
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x66\x69\x6c\x65\x2e\x74\x78\x74"
  ,.request_url= "\x2f\x66\x69\x6c\x65\x2e\x74\x78\x74"
  ,.num_headers= 1
  ,.headers= { { "\x48\x6f\x73\x74", "\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" } }
  ,.body= ""
  }

#define SEARCH_REQ 32
, {.name = "\x53\x45\x41\x52\x43\x48\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x53\x45\x41\x52\x43\x48\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_SEARCH
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f"
  ,.request_url= "\x2f"
  ,.num_headers= 1
  ,.headers= { { "\x48\x6f\x73\x74", "\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" } }
  ,.body= ""
  }

#define PROXY_WITH_BASIC_AUTH 33
, {.name= "\x68\x6f\x73\x74\x3a\x70\x6f\x72\x74\x20\x61\x6e\x64\x20\x62\x61\x73\x69\x63\x5f\x61\x75\x74\x68"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x68\x74\x74\x70\x3a\x2f\x2f\x61\x25\x31\x32\x3a\x62\x21\x26\x2a\x24\x40\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3a\x31\x32\x33\x34\x2f\x74\x6f\x74\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.fragment= ""
  ,.request_path= "\x2f\x74\x6f\x74\x6f"
  ,.request_url= "\x68\x74\x74\x70\x3a\x2f\x2f\x61\x25\x31\x32\x3a\x62\x21\x26\x2a\x24\x40\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67\x3a\x31\x32\x33\x34\x2f\x74\x6f\x74\x6f"
  ,.host= "\x68\x79\x70\x6e\x6f\x74\x6f\x61\x64\x2e\x6f\x72\x67"
  ,.userinfo= "\x61\x25\x31\x32\x3a\x62\x21\x26\x2a\x24"
  ,.port= 1234
  ,.num_headers= 0
  ,.headers= { }
  ,.body= ""
  }

#define LINE_FOLDING_IN_HEADER_WITH_LF 34
, {.name= "\x6c\x69\x6e\x65\x20\x66\x6f\x6c\x64\x69\x6e\x67\x20\x69\x6e\x20\x68\x65\x61\x64\x65\x72\x20\x76\x61\x6c\x75\x65"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xa"
         "\x4c\x69\x6e\x65\x31\x3a\x20\x20\x20\x61\x62\x63\xa"
         "\x9d\x65\x66\xa"
         "\x20\x67\x68\x69\xa"
         "\x9\x9\x6a\x6b\x6c\xa"
         "\x20\x20\x6d\x6e\x6f\x20\xa"
         "\x9\x20\x9\x71\x72\x73\xa"
         "\x4c\x69\x6e\x65\x32\x3a\x20\x9\x20\x6c\x69\x6e\x65\x32\x9\xa"
         "\x4c\x69\x6e\x65\x33\x3a\xa"
         "\x20\x6c\x69\x6e\x65\x33\xa"
         "\x4c\x69\x6e\x65\x34\x3a\x20\xa"
         "\x20\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\xa"
         "\x20\x63\x6c\x6f\x73\x65\xa"
         "\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f"
  ,.request_url= "\x2f"
  ,.num_headers= 5
  ,.headers= { { "\x4c\x69\x6e\x65\x31", "\x61\x62\x63\x9d\x65\x66\x20\x67\x68\x69\x9\x9\x6a\x6b\x6c\x20\x20\x6d\x6e\x6f\x20\x9\x20\x9\x71\x72\x73" }
             , { "\x4c\x69\x6e\x65\x32", "\x6c\x69\x6e\x65\x32\x9" }
             , { "\x4c\x69\x6e\x65\x33", "\x6c\x69\x6e\x65\x33" }
             , { "\x4c\x69\x6e\x65\x34", "" }
             , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" },
             }
  ,.body= ""
  }

#define CONNECTION_MULTI 35
, {.name = "\x6d\x75\x6c\x74\x69\x70\x6c\x65\x20\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x68\x65\x61\x64\x65\x72\x20\x76\x61\x6c\x75\x65\x73\x20\x77\x69\x74\x68\x20\x66\x6f\x6c\x64\x69\x6e\x67"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x64\x65\x6d\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x53\x6f\x6d\x65\x74\x68\x69\x6e\x67\x2c\xd\xa"
         "\x20\x55\x70\x67\x72\x61\x64\x65\x2c\x20\x2c\x4b\x65\x65\x70\x2d\x41\x6c\x69\x76\x65\xd\xa"
         "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x32\x3a\x20\x31\x32\x39\x39\x38\x20\x35\x20\x59\x33\x20\x31\x20\x20\x2e\x50\x30\x30\xd\xa"
         "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x50\x72\x6f\x74\x6f\x63\x6f\x6c\x3a\x20\x73\x61\x6d\x70\x6c\x65\xd\xa"
         "\x55\x70\x67\x72\x61\x64\x65\x3a\x20\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\xd\xa"
         "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x31\x3a\x20\x34\x20\x40\x31\x20\x20\x34\x36\x35\x34\x36\x78\x57\x25\x30\x6c\x20\x31\x20\x35\xd\xa"
         "\x4f\x72\x69\x67\x69\x6e\x3a\x20\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\xd\xa"
         "\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x64\x65\x6d\x6f"
  ,.request_url= "\x2f\x64\x65\x6d\x6f"
  ,.num_headers= 7
  ,.upgrade="\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.headers= { { "\x48\x6f\x73\x74", "\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x53\x6f\x6d\x65\x74\x68\x69\x6e\x67\x2c\x20\x55\x70\x67\x72\x61\x64\x65\x2c\x20\x2c\x4b\x65\x65\x70\x2d\x41\x6c\x69\x76\x65" }
             , { "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x32", "\x31\x32\x39\x39\x38\x20\x35\x20\x59\x33\x20\x31\x20\x20\x2e\x50\x30\x30" }
             , { "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x50\x72\x6f\x74\x6f\x63\x6f\x6c", "\x73\x61\x6d\x70\x6c\x65" }
             , { "\x55\x70\x67\x72\x61\x64\x65", "\x57\x65\x62\x53\x6f\x63\x6b\x65\x74" }
             , { "\x53\x65\x63\x2d\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\x2d\x4b\x65\x79\x31", "\x34\x20\x40\x31\x20\x20\x34\x36\x35\x34\x36\x78\x57\x25\x30\x6c\x20\x31\x20\x35" }
             , { "\x4f\x72\x69\x67\x69\x6e", "\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             }
  ,.body= ""
  }

#define CONNECTION_MULTI_LWS 36
, {.name = "\x6d\x75\x6c\x74\x69\x70\x6c\x65\x20\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x68\x65\x61\x64\x65\x72\x20\x76\x61\x6c\x75\x65\x73\x20\x77\x69\x74\x68\x20\x66\x6f\x6c\x64\x69\x6e\x67\x20\x61\x6e\x64\x20\x6c\x77\x73"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x64\x65\x6d\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x2c\x20\x75\x70\x67\x72\x61\x64\x65\xd\xa"
         "\x55\x70\x67\x72\x61\x64\x65\x3a\x20\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\xd\xa"
         "\xd\xa"
         "\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x64\x65\x6d\x6f"
  ,.request_url= "\x2f\x64\x65\x6d\x6f"
  ,.num_headers= 2
  ,.upgrade="\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.headers= { { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x2c\x20\x75\x70\x67\x72\x61\x64\x65" }
             , { "\x55\x70\x67\x72\x61\x64\x65", "\x57\x65\x62\x53\x6f\x63\x6b\x65\x74" }
             }
  ,.body= ""
  }

#define CONNECTION_MULTI_LWS_CRLF 37
, {.name = "\x6d\x75\x6c\x74\x69\x70\x6c\x65\x20\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x68\x65\x61\x64\x65\x72\x20\x76\x61\x6c\x75\x65\x73\x20\x77\x69\x74\x68\x20\x66\x6f\x6c\x64\x69\x6e\x67\x20\x61\x6e\x64\x20\x6c\x77\x73"
  ,.type= HTTP_REQUEST
  ,.raw= "\x47\x45\x54\x20\x2f\x64\x65\x6d\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x2c\x20\xd\xa\x20\x75\x70\x67\x72\x61\x64\x65\xd\xa"
         "\x55\x70\x67\x72\x61\x64\x65\x3a\x20\x57\x65\x62\x53\x6f\x63\x6b\x65\x74\xd\xa"
         "\xd\xa"
         "\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_GET
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "\x2f\x64\x65\x6d\x6f"
  ,.request_url= "\x2f\x64\x65\x6d\x6f"
  ,.num_headers= 2
  ,.upgrade="\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.headers= { { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x2c\x20\x20\x75\x70\x67\x72\x61\x64\x65" }
             , { "\x55\x70\x67\x72\x61\x64\x65", "\x57\x65\x62\x53\x6f\x63\x6b\x65\x74" }
             }
  ,.body= ""
  }

#define UPGRADE_POST_REQUEST 38
, {.name = "\x75\x70\x67\x72\x61\x64\x65\x20\x70\x6f\x73\x74\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x50\x4f\x53\x54\x20\x2f\x64\x65\x6d\x6f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x55\x70\x67\x72\x61\x64\x65\xd\xa"
         "\x55\x70\x67\x72\x61\x64\x65\x3a\x20\x48\x54\x54\x50\x2f\x32\x2e\x30\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\x35\xd\xa"
         "\xd\xa"
         "\x73\x77\x65\x65\x74\x20\x70\x6f\x73\x74\x20\x62\x6f\x64\x79"
         "\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.request_path= "\x2f\x64\x65\x6d\x6f"
  ,.request_url= "\x2f\x64\x65\x6d\x6f"
  ,.num_headers= 4
  ,.upgrade="\x48\x6f\x74\x20\x64\x69\x67\x67\x69\x74\x79\x20\x64\x6f\x67\x67"
  ,.headers= { { "\x48\x6f\x73\x74", "\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x55\x70\x67\x72\x61\x64\x65" }
             , { "\x55\x70\x67\x72\x61\x64\x65", "\x48\x54\x54\x50\x2f\x32\x2e\x30" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x31\x35" }
             }
  ,.body= "\x73\x77\x65\x65\x74\x20\x70\x6f\x73\x74\x20\x62\x6f\x64\x79"
  }

#define CONNECT_WITH_BODY_REQUEST 39
, {.name = "\x63\x6f\x6e\x6e\x65\x63\x74\x20\x77\x69\x74\x68\x20\x62\x6f\x64\x79\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x43\x4f\x4e\x4e\x45\x43\x54\x20\x66\x6f\x6f\x2e\x62\x61\x72\x2e\x63\x6f\x6d\x3a\x34\x34\x33\x20\x48\x54\x54\x50\x2f\x31\x2e\x30\xd\xa"
         "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e\xd\xa"
         "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e\x3a\x20\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\x30\xd\xa"
         "\xd\xa"
         "\x62\x6c\x61\x72\x66\x63\x69\x63\x6c\x65"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_CONNECT
  ,.request_url= "\x66\x6f\x6f\x2e\x62\x61\x72\x2e\x63\x6f\x6d\x3a\x34\x34\x33"
  ,.num_headers= 3
  ,.upgrade="\x62\x6c\x61\x72\x66\x63\x69\x63\x6c\x65"
  ,.headers= { { "\x55\x73\x65\x72\x2d\x61\x67\x65\x6e\x74", "\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x31\x2e\x31\x4e" }
             , { "\x50\x72\x6f\x78\x79\x2d\x61\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e", "\x62\x61\x73\x69\x63\x20\x61\x47\x56\x73\x62\x47\x38\x36\x64\x32\x39\x79\x62\x47\x51\x3d" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x31\x30" }
             }
  ,.body= ""
  }

/* Examples from the Internet draft for LINK/UNLINK methods:
 * https://tools.ietf.org/id/draft-snell-link-method-01.html#rfc.section.5
 */

#define LINK_REQUEST 40
, {.name = "\x6c\x69\x6e\x6b\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x4c\x49\x4e\x4b\x20\x2f\x69\x6d\x61\x67\x65\x73\x2f\x6d\x79\x5f\x64\x6f\x67\x2e\x6a\x70\x67\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x4c\x69\x6e\x6b\x3a\x20\x3c\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x70\x72\x6f\x66\x69\x6c\x65\x73\x2f\x6a\x6f\x65\x3e\x3b\x20\x72\x65\x6c\x3d\x22\x74\x61\x67\x22\xd\xa"
         "\x4c\x69\x6e\x6b\x3a\x20\x3c\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x70\x72\x6f\x66\x69\x6c\x65\x73\x2f\x73\x61\x6c\x6c\x79\x3e\x3b\x20\x72\x65\x6c\x3d\x22\x74\x61\x67\x22\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_LINK
  ,.request_path= "\x2f\x69\x6d\x61\x67\x65\x73\x2f\x6d\x79\x5f\x64\x6f\x67\x2e\x6a\x70\x67"
  ,.request_url= "\x2f\x69\x6d\x61\x67\x65\x73\x2f\x6d\x79\x5f\x64\x6f\x67\x2e\x6a\x70\x67"
  ,.query_string= ""
  ,.fragment= ""
  ,.num_headers= 3
  ,.headers= { { "\x48\x6f\x73\x74", "\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
             , { "\x4c\x69\x6e\x6b", "\x3c\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x70\x72\x6f\x66\x69\x6c\x65\x73\x2f\x6a\x6f\x65\x3e\x3b\x20\x72\x65\x6c\x3d\x22\x74\x61\x67\x22" }
	     , { "\x4c\x69\x6e\x6b", "\x3c\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x70\x72\x6f\x66\x69\x6c\x65\x73\x2f\x73\x61\x6c\x6c\x79\x3e\x3b\x20\x72\x65\x6c\x3d\x22\x74\x61\x67\x22" }
             }
  ,.body= ""
  }

#define UNLINK_REQUEST 41
, {.name = "\x75\x6e\x6c\x69\x6e\x6b\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.type= HTTP_REQUEST
  ,.raw= "\x55\x4e\x4c\x49\x4e\x4b\x20\x2f\x69\x6d\x61\x67\x65\x73\x2f\x6d\x79\x5f\x64\x6f\x67\x2e\x6a\x70\x67\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
         "\x48\x6f\x73\x74\x3a\x20\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
         "\x4c\x69\x6e\x6b\x3a\x20\x3c\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x70\x72\x6f\x66\x69\x6c\x65\x73\x2f\x73\x61\x6c\x6c\x79\x3e\x3b\x20\x72\x65\x6c\x3d\x22\x74\x61\x67\x22\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_UNLINK
  ,.request_path= "\x2f\x69\x6d\x61\x67\x65\x73\x2f\x6d\x79\x5f\x64\x6f\x67\x2e\x6a\x70\x67"
  ,.request_url= "\x2f\x69\x6d\x61\x67\x65\x73\x2f\x6d\x79\x5f\x64\x6f\x67\x2e\x6a\x70\x67"
  ,.query_string= ""
  ,.fragment= ""
  ,.num_headers= 2
  ,.headers= { { "\x48\x6f\x73\x74", "\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d" }
	     , { "\x4c\x69\x6e\x6b", "\x3c\x68\x74\x74\x70\x3a\x2f\x2f\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x70\x72\x6f\x66\x69\x6c\x65\x73\x2f\x73\x61\x6c\x6c\x79\x3e\x3b\x20\x72\x65\x6c\x3d\x22\x74\x61\x67\x22" }
             }
  ,.body= ""
  }

#define SOURCE_REQUEST 42
, {.name = "source request"
  ,.type= HTTP_REQUEST
  ,.raw= "SOURCE /music/sweet/music HTTP/1.1\r\n"
         "Host: example.com\r\n"
         "\r\n"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_SOURCE
  ,.request_path= "/music/sweet/music"
  ,.request_url= "/music/sweet/music"
  ,.query_string= ""
  ,.fragment= ""
  ,.num_headers= 1
  ,.headers= { { "Host", "example.com" } }
  ,.body= ""
  }

#define SOURCE_ICE_REQUEST 42
, {.name = "source request"
  ,.type= HTTP_REQUEST
  ,.raw= "SOURCE /music/sweet/music ICE/1.0\r\n"
         "Host: example.com\r\n"
         "\r\n"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.method= HTTP_SOURCE
  ,.request_path= "/music/sweet/music"
  ,.request_url= "/music/sweet/music"
  ,.query_string= ""
  ,.fragment= ""
  ,.num_headers= 1
  ,.headers= { { "Host", "example.com" } }
  ,.body= ""
  }

#define POST_MULTI_TE_LAST_CHUNKED 43
, {.name= "post - multi coding transfer-encoding chunked body"
  ,.type= HTTP_REQUEST
  ,.raw= "POST / HTTP/1.1\r\n"
         "Transfer-Encoding: deflate, chunked\r\n"
         "\r\n"
         "1e\r\nall your base are belong to us\r\n"
         "0\r\n"
         "\r\n"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "/"
  ,.request_url= "/"
  ,.num_headers= 1
  ,.headers=
    { { "Transfer-Encoding" , "deflate, chunked" }
    }
  ,.body= "all your base are belong to us"
  ,.num_chunks_complete= 2
  ,.chunk_lengths= { 0x1e }
  }

#define POST_MULTI_LINE_TE_LAST_CHUNKED 43
, {.name= "post - multi coding transfer-encoding chunked body"
  ,.type= HTTP_REQUEST
  ,.raw= "POST / HTTP/1.1\r\n"
         "Transfer-Encoding: deflate,\r\n"
         " chunked\r\n"
         "\r\n"
         "1e\r\nall your base are belong to us\r\n"
         "0\r\n"
         "\r\n"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.method= HTTP_POST
  ,.query_string= ""
  ,.fragment= ""
  ,.request_path= "/"
  ,.request_url= "/"
  ,.num_headers= 1
  ,.headers=
    { { "Transfer-Encoding" , "deflate, chunked" }
    }
  ,.body= "all your base are belong to us"
  ,.num_chunks_complete= 2
  ,.chunk_lengths= { 0x1e }
  }
};

/* * R E S P O N S E S * */
const struct message responses[] =
#define GOOGLE_301 0
{ {.name= "\x67\x6f\x6f\x67\x6c\x65\x20\x33\x30\x31"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x20\x50\x65\x72\x6d\x61\x6e\x65\x6e\x74\x6c\x79\xd\xa"
         "\x4c\x6f\x63\x61\x74\x69\x6f\x6e\x3a\x20\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x53\x75\x6e\x2c\x20\x32\x36\x20\x41\x70\x72\x20\x32\x30\x30\x39\x20\x31\x31\x3a\x31\x31\x3a\x34\x39\x20\x47\x4d\x54\xd\xa"
         "\x45\x78\x70\x69\x72\x65\x73\x3a\x20\x54\x75\x65\x2c\x20\x32\x36\x20\x4d\x61\x79\x20\x32\x30\x30\x39\x20\x31\x31\x3a\x31\x31\x3a\x34\x39\x20\x47\x4d\x54\xd\xa"
         "\x58\x2d\x24\x50\x72\x6f\x74\x6f\x74\x79\x70\x65\x42\x49\x2d\x56\x65\x72\x73\x69\x6f\x6e\x3a\x20\x31\x2e\x36\x2e\x30\x2e\x33\xd\xa" /* $ char in header field */
         "\x43\x61\x63\x68\x65\x2d\x43\x6f\x6e\x74\x72\x6f\x6c\x3a\x20\x70\x75\x62\x6c\x69\x63\x2c\x20\x6d\x61\x78\x2d\x61\x67\x65\x3d\x32\x35\x39\x32\x30\x30\x30\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x67\x77\x73\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x20\x32\x31\x39\x20\x20\xd\xa"
         "\xd\xa"
         "\x3c\x48\x54\x4d\x4c\x3e\x3c\x48\x45\x41\x44\x3e\x3c\x6d\x65\x74\x61\x20\x68\x74\x74\x70\x2d\x65\x71\x75\x69\x76\x3d\x22\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65\x22\x20\x63\x6f\x6e\x74\x65\x6e\x74\x3d\x22\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x63\x68\x61\x72\x73\x65\x74\x3d\x75\x74\x66\x2d\x38\x22\x3e\xa"
         "\x3c\x54\x49\x54\x4c\x45\x3e\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x3c\x2f\x54\x49\x54\x4c\x45\x3e\x3c\x2f\x48\x45\x41\x44\x3e\x3c\x42\x4f\x44\x59\x3e\xa"
         "\x3c\x48\x31\x3e\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x3c\x2f\x48\x31\x3e\xa"
         "\x54\x68\x65\x20\x64\x6f\x63\x75\x6d\x65\x6e\x74\x20\x68\x61\x73\x20\x6d\x6f\x76\x65\x64\xa"
         "\x3c\x41\x20\x48\x52\x45\x46\x3d\x22\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x22\x3e\x68\x65\x72\x65\x3c\x2f\x41\x3e\x2e\xd\xa"
         "\x3c\x2f\x42\x4f\x44\x59\x3e\x3c\x2f\x48\x54\x4d\x4c\x3e\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 301
  ,.response_status= "\x4d\x6f\x76\x65\x64\x20\x50\x65\x72\x6d\x61\x6e\x65\x6e\x74\x6c\x79"
  ,.num_headers= 8
  ,.headers=
    { { "\x4c\x6f\x63\x61\x74\x69\x6f\x6e", "\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38" }
    , { "\x44\x61\x74\x65", "\x53\x75\x6e\x2c\x20\x32\x36\x20\x41\x70\x72\x20\x32\x30\x30\x39\x20\x31\x31\x3a\x31\x31\x3a\x34\x39\x20\x47\x4d\x54" }
    , { "\x45\x78\x70\x69\x72\x65\x73", "\x54\x75\x65\x2c\x20\x32\x36\x20\x4d\x61\x79\x20\x32\x30\x30\x39\x20\x31\x31\x3a\x31\x31\x3a\x34\x39\x20\x47\x4d\x54" }
    , { "\x58\x2d\x24\x50\x72\x6f\x74\x6f\x74\x79\x70\x65\x42\x49\x2d\x56\x65\x72\x73\x69\x6f\x6e", "\x31\x2e\x36\x2e\x30\x2e\x33" }
    , { "\x43\x61\x63\x68\x65\x2d\x43\x6f\x6e\x74\x72\x6f\x6c", "\x70\x75\x62\x6c\x69\x63\x2c\x20\x6d\x61\x78\x2d\x61\x67\x65\x3d\x32\x35\x39\x32\x30\x30\x30" }
    , { "\x53\x65\x72\x76\x65\x72", "\x67\x77\x73" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x32\x31\x39\x20\x20" }
    }
  ,.body= "\x3c\x48\x54\x4d\x4c\x3e\x3c\x48\x45\x41\x44\x3e\x3c\x6d\x65\x74\x61\x20\x68\x74\x74\x70\x2d\x65\x71\x75\x69\x76\x3d\x22\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65\x22\x20\x63\x6f\x6e\x74\x65\x6e\x74\x3d\x22\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x63\x68\x61\x72\x73\x65\x74\x3d\x75\x74\x66\x2d\x38\x22\x3e\xa"
          "\x3c\x54\x49\x54\x4c\x45\x3e\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x3c\x2f\x54\x49\x54\x4c\x45\x3e\x3c\x2f\x48\x45\x41\x44\x3e\x3c\x42\x4f\x44\x59\x3e\xa"
          "\x3c\x48\x31\x3e\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x3c\x2f\x48\x31\x3e\xa"
          "\x54\x68\x65\x20\x64\x6f\x63\x75\x6d\x65\x6e\x74\x20\x68\x61\x73\x20\x6d\x6f\x76\x65\x64\xa"
          "\x3c\x41\x20\x48\x52\x45\x46\x3d\x22\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x22\x3e\x68\x65\x72\x65\x3c\x2f\x41\x3e\x2e\xd\xa"
          "\x3c\x2f\x42\x4f\x44\x59\x3e\x3c\x2f\x48\x54\x4d\x4c\x3e\xd\xa"
  }

#define NO_CONTENT_LENGTH_RESPONSE 1
/* The client should wait for the server's EOF. That is, when content-length
 * is not specified, and "Connection: close", the end of body is specified
 * by the EOF.
 * Compare with APACHEBENCH_GET
 */
, {.name= "\x6e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x6c\x65\x6e\x67\x74\x68\x20\x72\x65\x73\x70\x6f\x6e\x73\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x54\x75\x65\x2c\x20\x30\x34\x20\x41\x75\x67\x20\x32\x30\x30\x39\x20\x30\x37\x3a\x35\x39\x3a\x33\x32\x20\x47\x4d\x54\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x41\x70\x61\x63\x68\x65\xd\xa"
         "\x58\x2d\x50\x6f\x77\x65\x72\x65\x64\x2d\x42\x79\x3a\x20\x53\x65\x72\x76\x6c\x65\x74\x2f\x32\x2e\x35\x20\x4a\x53\x50\x2f\x32\x2e\x31\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x78\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x75\x74\x66\x2d\x38\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\xd\xa"
         "\x3c\x3f\x78\x6d\x6c\x20\x76\x65\x72\x73\x69\x6f\x6e\x3d\x22\x31\x2e\x30\x22\x20\x65\x6e\x63\x6f\x64\x69\x6e\x67\x3d\x22\x55\x54\x46\x2d\x38\x22\x3f\x3e\xa"
         "\x3c\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x45\x6e\x76\x65\x6c\x6f\x70\x65\x20\x78\x6d\x6c\x6e\x73\x3a\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3d\x22\x68\x74\x74\x70\x3a\x2f\x2f\x73\x63\x68\x65\x6d\x61\x73\x2e\x78\x6d\x6c\x73\x6f\x61\x70\x2e\x6f\x72\x67\x2f\x73\x6f\x61\x70\x2f\x65\x6e\x76\x65\x6c\x6f\x70\x65\x2f\x22\x3e\xa"
         "\x20\x20\x3c\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x42\x6f\x64\x79\x3e\xa"
         "\x20\x20\x20\x20\x3c\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x46\x61\x75\x6c\x74\x3e\xa"
         "\x20\x20\x20\x20\x20\x20\x20\x3c\x66\x61\x75\x6c\x74\x63\x6f\x64\x65\x3e\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x43\x6c\x69\x65\x6e\x74\x3c\x2f\x66\x61\x75\x6c\x74\x63\x6f\x64\x65\x3e\xa"
         "\x20\x20\x20\x20\x20\x20\x20\x3c\x66\x61\x75\x6c\x74\x73\x74\x72\x69\x6e\x67\x3e\x43\x6c\x69\x65\x6e\x74\x20\x45\x72\x72\x6f\x72\x3c\x2f\x66\x61\x75\x6c\x74\x73\x74\x72\x69\x6e\x67\x3e\xa"
         "\x20\x20\x20\x20\x3c\x2f\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x46\x61\x75\x6c\x74\x3e\xa"
         "\x20\x20\x3c\x2f\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x42\x6f\x64\x79\x3e\xa"
         "\x3c\x2f\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x45\x6e\x76\x65\x6c\x6f\x70\x65\x3e"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 5
  ,.headers=
    { { "\x44\x61\x74\x65", "\x54\x75\x65\x2c\x20\x30\x34\x20\x41\x75\x67\x20\x32\x30\x30\x39\x20\x30\x37\x3a\x35\x39\x3a\x33\x32\x20\x47\x4d\x54" }
    , { "\x53\x65\x72\x76\x65\x72", "\x41\x70\x61\x63\x68\x65" }
    , { "\x58\x2d\x50\x6f\x77\x65\x72\x65\x64\x2d\x42\x79", "\x53\x65\x72\x76\x6c\x65\x74\x2f\x32\x2e\x35\x20\x4a\x53\x50\x2f\x32\x2e\x31" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x78\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x75\x74\x66\x2d\x38" }
    , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
    }
  ,.body= "\x3c\x3f\x78\x6d\x6c\x20\x76\x65\x72\x73\x69\x6f\x6e\x3d\x22\x31\x2e\x30\x22\x20\x65\x6e\x63\x6f\x64\x69\x6e\x67\x3d\x22\x55\x54\x46\x2d\x38\x22\x3f\x3e\xa"
          "\x3c\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x45\x6e\x76\x65\x6c\x6f\x70\x65\x20\x78\x6d\x6c\x6e\x73\x3a\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3d\x22\x68\x74\x74\x70\x3a\x2f\x2f\x73\x63\x68\x65\x6d\x61\x73\x2e\x78\x6d\x6c\x73\x6f\x61\x70\x2e\x6f\x72\x67\x2f\x73\x6f\x61\x70\x2f\x65\x6e\x76\x65\x6c\x6f\x70\x65\x2f\x22\x3e\xa"
          "\x20\x20\x3c\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x42\x6f\x64\x79\x3e\xa"
          "\x20\x20\x20\x20\x3c\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x46\x61\x75\x6c\x74\x3e\xa"
          "\x20\x20\x20\x20\x20\x20\x20\x3c\x66\x61\x75\x6c\x74\x63\x6f\x64\x65\x3e\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x43\x6c\x69\x65\x6e\x74\x3c\x2f\x66\x61\x75\x6c\x74\x63\x6f\x64\x65\x3e\xa"
          "\x20\x20\x20\x20\x20\x20\x20\x3c\x66\x61\x75\x6c\x74\x73\x74\x72\x69\x6e\x67\x3e\x43\x6c\x69\x65\x6e\x74\x20\x45\x72\x72\x6f\x72\x3c\x2f\x66\x61\x75\x6c\x74\x73\x74\x72\x69\x6e\x67\x3e\xa"
          "\x20\x20\x20\x20\x3c\x2f\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x46\x61\x75\x6c\x74\x3e\xa"
          "\x20\x20\x3c\x2f\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x42\x6f\x64\x79\x3e\xa"
          "\x3c\x2f\x53\x4f\x41\x50\x2d\x45\x4e\x56\x3a\x45\x6e\x76\x65\x6c\x6f\x70\x65\x3e"
  }

#define NO_HEADERS_NO_BODY_404 2
, {.name= "\x34\x30\x34\x20\x6e\x6f\x20\x68\x65\x61\x64\x65\x72\x73\x20\x6e\x6f\x20\x62\x6f\x64\x79"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x34\x30\x34\x20\x4e\x6f\x74\x20\x46\x6f\x75\x6e\x64\xd\xa\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 404
  ,.response_status= "\x4e\x6f\x74\x20\x46\x6f\x75\x6e\x64"
  ,.num_headers= 0
  ,.headers= {}
  ,.body_size= 0
  ,.body= ""
  }

#define NO_REASON_PHRASE 3
, {.name= "\x33\x30\x31\x20\x6e\x6f\x20\x72\x65\x73\x70\x6f\x6e\x73\x65\x20\x70\x68\x72\x61\x73\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x33\x30\x31\xd\xa\xd\xa"
  ,.should_keep_alive = FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 301
  ,.response_status= ""
  ,.num_headers= 0
  ,.headers= {}
  ,.body= ""
  }

#define TRAILING_SPACE_ON_CHUNKED_BODY 4
, {.name="\x32\x30\x30\x20\x74\x72\x61\x69\x6c\x69\x6e\x67\x20\x73\x70\x61\x63\x65\x20\x6f\x6e\x20\x63\x68\x75\x6e\x6b\x65\x64\x20\x62\x6f\x64\x79"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x32\x35\x20\x20\xd\xa"
         "\x54\x68\x69\x73\x20\x69\x73\x20\x74\x68\x65\x20\x64\x61\x74\x61\x20\x69\x6e\x20\x74\x68\x65\x20\x66\x69\x72\x73\x74\x20\x63\x68\x75\x6e\x6b\xd\xa"
         "\xd\xa"
         "\x31\x43\xd\xa"
         "\x61\x6e\x64\x20\x74\x68\x69\x73\x20\x69\x73\x20\x74\x68\x65\x20\x73\x65\x63\x6f\x6e\x64\x20\x6f\x6e\x65\xd\xa"
         "\xd\xa"
         "\x30\x20\x20\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 2
  ,.headers=
    { {"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e" }
    , {"\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
    }
  ,.body_size = 37+28
  ,.body =
         "\x54\x68\x69\x73\x20\x69\x73\x20\x74\x68\x65\x20\x64\x61\x74\x61\x20\x69\x6e\x20\x74\x68\x65\x20\x66\x69\x72\x73\x74\x20\x63\x68\x75\x6e\x6b\xd\xa"
         "\x61\x6e\x64\x20\x74\x68\x69\x73\x20\x69\x73\x20\x74\x68\x65\x20\x73\x65\x63\x6f\x6e\x64\x20\x6f\x6e\x65\xd\xa"
  ,.num_chunks_complete= 3
  ,.chunk_lengths= { 0x25, 0x1c }
  }

#define NO_CARRIAGE_RET 5
, {.name="\x6e\x6f\x20\x63\x61\x72\x72\x69\x61\x67\x65\x20\x72\x65\x74"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x75\x74\x66\x2d\x38\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xa"
         "\xa"
         "\x74\x68\x65\x73\x65\x20\x68\x65\x61\x64\x65\x72\x73\x20\x61\x72\x65\x20\x66\x72\x6f\x6d\x20\x68\x74\x74\x70\x3a\x2f\x2f\x6e\x65\x77\x73\x2e\x79\x63\x6f\x6d\x62\x69\x6e\x61\x74\x6f\x72\x2e\x63\x6f\x6d\x2f"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 2
  ,.headers=
    { {"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x75\x74\x66\x2d\x38" }
    , {"\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
    }
  ,.body= "\x74\x68\x65\x73\x65\x20\x68\x65\x61\x64\x65\x72\x73\x20\x61\x72\x65\x20\x66\x72\x6f\x6d\x20\x68\x74\x74\x70\x3a\x2f\x2f\x6e\x65\x77\x73\x2e\x79\x63\x6f\x6d\x62\x69\x6e\x61\x74\x6f\x72\x2e\x63\x6f\x6d\x2f"
  }

#define PROXY_CONNECTION 6
, {.name="\x70\x72\x6f\x78\x79\x20\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\x31\xd\xa"
         "\x50\x72\x6f\x78\x79\x2d\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x54\x68\x75\x2c\x20\x33\x31\x20\x44\x65\x63\x20\x32\x30\x30\x39\x20\x32\x30\x3a\x35\x35\x3a\x34\x38\x20\x2b\x30\x30\x30\x30\xd\xa"
         "\xd\xa"
         "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 4
  ,.headers=
    { {"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38" }
    , {"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x31\x31" }
    , {"\x50\x72\x6f\x78\x79\x2d\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
    , {"\x44\x61\x74\x65", "\x54\x68\x75\x2c\x20\x33\x31\x20\x44\x65\x63\x20\x32\x30\x30\x39\x20\x32\x30\x3a\x35\x35\x3a\x34\x38\x20\x2b\x30\x30\x30\x30"}
    }
  ,.body= "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  }

#define UNDERSTORE_HEADER_KEY 7
  // shown by
  // curl -o /dev/null -v "http://ad.doubleclick.net/pfadx/DARTSHELLCONFIGXML;dcmt=text/xml;"
, {.name="\x75\x6e\x64\x65\x72\x73\x63\x6f\x72\x65\x20\x68\x65\x61\x64\x65\x72\x20\x6b\x65\x79"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x44\x43\x4c\x4b\x2d\x41\x64\x53\x76\x72\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x78\x6d\x6c\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x30\xd\xa"
         "\x44\x43\x4c\x4b\x5f\x69\x6d\x70\x3a\x20\x76\x37\x3b\x78\x3b\x31\x31\x34\x37\x35\x30\x38\x35\x36\x3b\x30\x2d\x30\x3b\x30\x3b\x31\x37\x38\x32\x30\x30\x32\x30\x3b\x30\x2f\x30\x3b\x32\x31\x36\x30\x33\x35\x36\x37\x2f\x32\x31\x36\x32\x31\x34\x35\x37\x2f\x31\x3b\x3b\x7e\x6f\x6b\x76\x3d\x3b\x64\x63\x6d\x74\x3d\x74\x65\x78\x74\x2f\x78\x6d\x6c\x3b\x3b\x7e\x63\x73\x3d\x6f\xd\xa\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 4
  ,.headers=
    { {"\x53\x65\x72\x76\x65\x72", "\x44\x43\x4c\x4b\x2d\x41\x64\x53\x76\x72" }
    , {"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x78\x6d\x6c" }
    , {"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x30" }
    , {"\x44\x43\x4c\x4b\x5f\x69\x6d\x70", "\x76\x37\x3b\x78\x3b\x31\x31\x34\x37\x35\x30\x38\x35\x36\x3b\x30\x2d\x30\x3b\x30\x3b\x31\x37\x38\x32\x30\x30\x32\x30\x3b\x30\x2f\x30\x3b\x32\x31\x36\x30\x33\x35\x36\x37\x2f\x32\x31\x36\x32\x31\x34\x35\x37\x2f\x31\x3b\x3b\x7e\x6f\x6b\x76\x3d\x3b\x64\x63\x6d\x74\x3d\x74\x65\x78\x74\x2f\x78\x6d\x6c\x3b\x3b\x7e\x63\x73\x3d\x6f" }
    }
  ,.body= ""
  }

#define BONJOUR_MADAME_FR 8
/* The client should not merge two headers fields when the first one doesn't
 * have a value.
 */
, {.name= "\x62\x6f\x6e\x6a\x6f\x75\x72\x6d\x61\x64\x61\x6d\x65\x2e\x66\x72"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x20\x50\x65\x72\x6d\x61\x6e\x65\x6e\x74\x6c\x79\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x54\x68\x75\x2c\x20\x30\x33\x20\x4a\x75\x6e\x20\x32\x30\x31\x30\x20\x30\x39\x3a\x35\x36\x3a\x33\x32\x20\x47\x4d\x54\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x41\x70\x61\x63\x68\x65\x2f\x32\x2e\x32\x2e\x33\x20\x28\x52\x65\x64\x20\x48\x61\x74\x29\xd\xa"
         "\x43\x61\x63\x68\x65\x2d\x43\x6f\x6e\x74\x72\x6f\x6c\x3a\x20\x70\x75\x62\x6c\x69\x63\xd\xa"
         "\x50\x72\x61\x67\x6d\x61\x3a\x20\xd\xa"
         "\x4c\x6f\x63\x61\x74\x69\x6f\x6e\x3a\x20\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x62\x6f\x6e\x6a\x6f\x75\x72\x6d\x61\x64\x61\x6d\x65\x2e\x66\x72\x2f\xd\xa"
         "\x56\x61\x72\x79\x3a\x20\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x30\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.status_code= 301
  ,.response_status= "\x4d\x6f\x76\x65\x64\x20\x50\x65\x72\x6d\x61\x6e\x65\x6e\x74\x6c\x79"
  ,.num_headers= 9
  ,.headers=
    { { "\x44\x61\x74\x65", "\x54\x68\x75\x2c\x20\x30\x33\x20\x4a\x75\x6e\x20\x32\x30\x31\x30\x20\x30\x39\x3a\x35\x36\x3a\x33\x32\x20\x47\x4d\x54" }
    , { "\x53\x65\x72\x76\x65\x72", "\x41\x70\x61\x63\x68\x65\x2f\x32\x2e\x32\x2e\x33\x20\x28\x52\x65\x64\x20\x48\x61\x74\x29" }
    , { "\x43\x61\x63\x68\x65\x2d\x43\x6f\x6e\x74\x72\x6f\x6c", "\x70\x75\x62\x6c\x69\x63" }
    , { "\x50\x72\x61\x67\x6d\x61", "" }
    , { "\x4c\x6f\x63\x61\x74\x69\x6f\x6e", "\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x62\x6f\x6e\x6a\x6f\x75\x72\x6d\x61\x64\x61\x6d\x65\x2e\x66\x72\x2f" }
    , { "\x56\x61\x72\x79",  "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x30" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38" }
    , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65" }
    }
  ,.body= ""
  }

#define RES_FIELD_UNDERSCORE 9
/* Should handle spaces in header fields */
, {.name= "\x66\x69\x65\x6c\x64\x20\x75\x6e\x64\x65\x72\x73\x63\x6f\x72\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x54\x75\x65\x2c\x20\x32\x38\x20\x53\x65\x70\x20\x32\x30\x31\x30\x20\x30\x31\x3a\x31\x34\x3a\x31\x33\x20\x47\x4d\x54\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x41\x70\x61\x63\x68\x65\xd\xa"
         "\x43\x61\x63\x68\x65\x2d\x43\x6f\x6e\x74\x72\x6f\x6c\x3a\x20\x6e\x6f\x2d\x63\x61\x63\x68\x65\x2c\x20\x6d\x75\x73\x74\x2d\x72\x65\x76\x61\x6c\x69\x64\x61\x74\x65\xd\xa"
         "\x45\x78\x70\x69\x72\x65\x73\x3a\x20\x4d\x6f\x6e\x2c\x20\x32\x36\x20\x4a\x75\x6c\x20\x31\x39\x39\x37\x20\x30\x35\x3a\x30\x30\x3a\x30\x30\x20\x47\x4d\x54\xd\xa"
         "\x2e\x65\x74\x2d\x43\x6f\x6f\x6b\x69\x65\x3a\x20\x50\x6c\x61\x78\x6f\x43\x53\x3d\x31\x32\x37\x34\x38\x30\x34\x36\x32\x32\x33\x35\x33\x36\x39\x30\x35\x32\x31\x3b\x20\x70\x61\x74\x68\x3d\x2f\x3b\x20\x64\x6f\x6d\x61\x69\x6e\x3d\x2e\x70\x6c\x61\x78\x6f\x2e\x63\x6f\x6d\xd\xa"
         "\x56\x61\x72\x79\x3a\x20\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\xd\xa"
         "\x5f\x65\x65\x70\x2d\x41\x6c\x69\x76\x65\x3a\x20\x74\x69\x6d\x65\x6f\x75\x74\x3d\x34\x35\xd\xa" /* semantic value ignored */
         "\x5f\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x4b\x65\x65\x70\x2d\x41\x6c\x69\x76\x65\xd\xa" /* semantic value ignored */
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\xd\xa"
         "\x30\xd\xa\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 11
  ,.headers=
    { { "\x44\x61\x74\x65", "\x54\x75\x65\x2c\x20\x32\x38\x20\x53\x65\x70\x20\x32\x30\x31\x30\x20\x30\x31\x3a\x31\x34\x3a\x31\x33\x20\x47\x4d\x54" }
    , { "\x53\x65\x72\x76\x65\x72", "\x41\x70\x61\x63\x68\x65" }
    , { "\x43\x61\x63\x68\x65\x2d\x43\x6f\x6e\x74\x72\x6f\x6c", "\x6e\x6f\x2d\x63\x61\x63\x68\x65\x2c\x20\x6d\x75\x73\x74\x2d\x72\x65\x76\x61\x6c\x69\x64\x61\x74\x65" }
    , { "\x45\x78\x70\x69\x72\x65\x73", "\x4d\x6f\x6e\x2c\x20\x32\x36\x20\x4a\x75\x6c\x20\x31\x39\x39\x37\x20\x30\x35\x3a\x30\x30\x3a\x30\x30\x20\x47\x4d\x54" }
    , { "\x2e\x65\x74\x2d\x43\x6f\x6f\x6b\x69\x65", "\x50\x6c\x61\x78\x6f\x43\x53\x3d\x31\x32\x37\x34\x38\x30\x34\x36\x32\x32\x33\x35\x33\x36\x39\x30\x35\x32\x31\x3b\x20\x70\x61\x74\x68\x3d\x2f\x3b\x20\x64\x6f\x6d\x61\x69\x6e\x3d\x2e\x70\x6c\x61\x78\x6f\x2e\x63\x6f\x6d" }
    , { "\x56\x61\x72\x79", "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67" }
    , { "\x5f\x65\x65\x70\x2d\x41\x6c\x69\x76\x65", "\x74\x69\x6d\x65\x6f\x75\x74\x3d\x34\x35" }
    , { "\x5f\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x4b\x65\x65\x70\x2d\x41\x6c\x69\x76\x65" }
    , { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c" }
    , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
    }
  ,.body= ""
  ,.num_chunks_complete= 1
  ,.chunk_lengths= {}
  }

#define NON_ASCII_IN_STATUS_LINE 10
/* Should handle non-ASCII in status line */
, {.name= "\x6e\x6f\x6e\x2d\x41\x53\x43\x49\x49\x20\x69\x6e\x20\x73\x74\x61\x74\x75\x73\x20\x6c\x69\x6e\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x35\x30\x30\x20\x4f\x72\x69\xff\xff\x6e\x74\x61\x74\x69\x65\x70\x72\x6f\x62\x6c\x65\x65\x6d\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x46\x72\x69\x2c\x20\x35\x20\x4e\x6f\x76\x20\x32\x30\x31\x30\x20\x32\x33\x3a\x30\x37\x3a\x31\x32\x20\x47\x4d\x54\x2b\x32\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x30\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 500
  ,.response_status= "\x4f\x72\x69\xff\xff\x6e\x74\x61\x74\x69\x65\x70\x72\x6f\x62\x6c\x65\x65\x6d"
  ,.num_headers= 3
  ,.headers=
    { { "\x44\x61\x74\x65", "\x46\x72\x69\x2c\x20\x35\x20\x4e\x6f\x76\x20\x32\x30\x31\x30\x20\x32\x33\x3a\x30\x37\x3a\x31\x32\x20\x47\x4d\x54\x2b\x32" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x30" }
    , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
    }
  ,.body= ""
  }

#define HTTP_VERSION_0_9 11
/* Should handle HTTP/0.9 */
, {.name= "\x68\x74\x74\x70\x20\x76\x65\x72\x73\x69\x6f\x6e\x20\x30\x2e\x39"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x30\x2e\x39\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 0
  ,.http_minor= 9
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 0
  ,.headers=
    {}
  ,.body= ""
  }

#define NO_CONTENT_LENGTH_NO_TRANSFER_ENCODING_RESPONSE 12
/* The client should wait for the server's EOF. That is, when neither
 * content-length nor transfer-encoding is specified, the end of body
 * is specified by the EOF.
 */
, {.name= "\x6e\x65\x69\x74\x68\x65\x72\x20\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x6c\x65\x6e\x67\x74\x68\x20\x6e\x6f\x72\x20\x74\x72\x61\x6e\x73\x66\x65\x72\x2d\x65\x6e\x63\x6f\x64\x69\x6e\x67\x20\x72\x65\x73\x70\x6f\x6e\x73\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e\xd\xa"
         "\xd\xa"
         "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 1
  ,.headers=
    { { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e" }
    }
  ,.body= "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"
  }

#define NO_BODY_HTTP10_KA_200 13
, {.name= "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x77\x69\x74\x68\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x20\x61\x6e\x64\x20\x45\x4f\x46\x2d\x74\x65\x72\x6d\x69\x6e\x61\x74\x65\x64\x20\x32\x30\x30\x20\x73\x74\x61\x74\x75\x73"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 0
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 1
  ,.headers=
    { { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65" }
    }
  ,.body_size= 0
  ,.body= ""
  }

#define NO_BODY_HTTP10_KA_204 14
, {.name= "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x77\x69\x74\x68\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x20\x61\x6e\x64\x20\x61\x20\x32\x30\x34\x20\x73\x74\x61\x74\x75\x73"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x32\x30\x34\x20\x4e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 0
  ,.status_code= 204
  ,.response_status= "\x4e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74"
  ,.num_headers= 1
  ,.headers=
    { { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65" }
    }
  ,.body_size= 0
  ,.body= ""
  }

#define NO_BODY_HTTP11_KA_200 15
, {.name= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x77\x69\x74\x68\x20\x61\x6e\x20\x45\x4f\x46\x2d\x74\x65\x72\x6d\x69\x6e\x61\x74\x65\x64\x20\x32\x30\x30\x20\x73\x74\x61\x74\x75\x73"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 0
  ,.headers={}
  ,.body_size= 0
  ,.body= ""
  }

#define NO_BODY_HTTP11_KA_204 16
, {.name= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x77\x69\x74\x68\x20\x61\x20\x32\x30\x34\x20\x73\x74\x61\x74\x75\x73"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x34\x20\x4e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 204
  ,.response_status= "\x4e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74"
  ,.num_headers= 0
  ,.headers={}
  ,.body_size= 0
  ,.body= ""
  }

#define NO_BODY_HTTP11_NOKA_204 17
, {.name= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x77\x69\x74\x68\x20\x61\x20\x32\x30\x34\x20\x73\x74\x61\x74\x75\x73\x20\x61\x6e\x64\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\x20\x64\x69\x73\x61\x62\x6c\x65\x64"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x34\x20\x4e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x63\x6c\x6f\x73\x65\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 204
  ,.response_status= "\x4e\x6f\x20\x63\x6f\x6e\x74\x65\x6e\x74"
  ,.num_headers= 1
  ,.headers=
    { { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x63\x6c\x6f\x73\x65" }
    }
  ,.body_size= 0
  ,.body= ""
  }

#define NO_BODY_HTTP11_KA_CHUNKED_200 18
, {.name= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x77\x69\x74\x68\x20\x63\x68\x75\x6e\x6b\x65\x64\x20\x65\x6e\x64\x6f\x63\x69\x6e\x67\x20\x61\x6e\x64\x20\x61\x20\x32\x30\x30\x20\x72\x65\x73\x70\x6f\x6e\x73\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x30\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 1
  ,.headers=
    { { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
    }
  ,.body_size= 0
  ,.body= ""
  ,.num_chunks_complete= 1
  }

#if !HTTP_PARSER_STRICT
#define SPACE_IN_FIELD_RES 19
/* Should handle spaces in header fields */
, {.name= "\x66\x69\x65\x6c\x64\x20\x73\x70\x61\x63\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x4d\x69\x63\x72\x6f\x73\x6f\x66\x74\x2d\x49\x49\x53\x2f\x36\x2e\x30\xd\xa"
         "\x58\x2d\x50\x6f\x77\x65\x72\x65\x64\x2d\x42\x79\x3a\x20\x41\x53\x50\x2e\x4e\x45\x54\xd\xa"
         "\x65\x6e\x2d\x55\x53\x20\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x78\x6d\x6c\xd\xa" /* this is the problem */
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x78\x6d\x6c\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\x36\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x46\x72\x69\x2c\x20\x32\x33\x20\x4a\x75\x6c\x20\x32\x30\x31\x30\x20\x31\x38\x3a\x34\x35\x3a\x33\x38\x20\x47\x4d\x54\xd\xa"
         "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x3a\x20\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65\xd\xa"
         "\xd\xa"
         "\x3c\x78\x6d\x6c\x3e\x68\x65\x6c\x6c\x6f\x3c\x2f\x78\x6d\x6c\x3e" /* fake body */
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "\x4f\x4b"
  ,.num_headers= 7
  ,.headers=
    { { "\x53\x65\x72\x76\x65\x72",  "\x4d\x69\x63\x72\x6f\x73\x6f\x66\x74\x2d\x49\x49\x53\x2f\x36\x2e\x30" }
    , { "\x58\x2d\x50\x6f\x77\x65\x72\x65\x64\x2d\x42\x79", "\x41\x53\x50\x2e\x4e\x45\x54" }
    , { "\x65\x6e\x2d\x55\x53\x20\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x78\x6d\x6c" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x78\x6d\x6c" }
    , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68", "\x31\x36" }
    , { "\x44\x61\x74\x65", "\x46\x72\x69\x2c\x20\x32\x33\x20\x4a\x75\x6c\x20\x32\x30\x31\x30\x20\x31\x38\x3a\x34\x35\x3a\x33\x38\x20\x47\x4d\x54" }
    , { "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e", "\x6b\x65\x65\x70\x2d\x61\x6c\x69\x76\x65" }
    }
  ,.body= "\x3c\x78\x6d\x6c\x3e\x68\x65\x6c\x6c\x6f\x3c\x2f\x78\x6d\x6c\x3e"
  }
#endif /* !HTTP_PARSER_STRICT */

#define AMAZON_COM 20
, {.name= "\x61\x6d\x61\x7a\x6f\x6e\x2e\x63\x6f\x6d"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x33\x30\x31\x20\x4d\x6f\x76\x65\x64\x50\x65\x72\x6d\x61\x6e\x65\x6e\x74\x6c\x79\xd\xa"
         "\x44\x61\x74\x65\x3a\x20\x57\x65\x64\x2c\x20\x31\x35\x20\x4d\x61\x79\x20\x32\x30\x31\x33\x20\x31\x37\x3a\x30\x36\x3a\x33\x33\x20\x47\x4d\x54\xd\xa"
         "\x53\x65\x72\x76\x65\x72\x3a\x20\x53\x65\x72\x76\x65\x72\xd\xa"
         "\x78\x2d\x61\x6d\x7a\x2d\x69\x64\x2d\x31\x3a\x20\x30\x47\x50\x48\x4b\x58\x53\x4a\x51\x38\x32\x36\x52\x4b\x37\x47\x5a\x45\x42\x32\xd\xa"
         "\x70\x33\x70\x3a\x20\x70\x6f\x6c\x69\x63\x79\x72\x65\x66\x3d\x22\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x61\x6d\x61\x7a\x6f\x6e\x2e\x63\x6f\x6d\x2f\x77\x33\x63\x2f\x70\x33\x70\x2e\x78\x6d\x6c\x22\x2c\x43\x50\x3d\x22\x43\x41\x4f\x20\x44\x53\x50\x20\x4c\x41\x57\x20\x43\x55\x52\x20\x41\x44\x4d\x20\x49\x56\x41\x6f\x20\x49\x56\x44\x6f\x20\x43\x4f\x4e\x6f\x20\x4f\x54\x50\x6f\x20\x4f\x55\x52\x20\x44\x45\x4c\x69\x20\x50\x55\x42\x69\x20\x4f\x54\x52\x69\x20\x42\x55\x53\x20\x50\x48\x59\x20\x4f\x4e\x4c\x20\x55\x4e\x49\x20\x50\x55\x52\x20\x46\x49\x4e\x20\x43\x4f\x4d\x20\x4e\x41\x56\x20\x49\x4e\x54\x20\x44\x45\x4d\x20\x43\x4e\x54\x20\x53\x54\x41\x20\x48\x45\x41\x20\x50\x52\x45\x20\x4c\x4f\x43\x20\x47\x4f\x56\x20\x4f\x54\x43\x20\x22\xd\xa"
         "\x78\x2d\x61\x6d\x7a\x2d\x69\x64\x2d\x32\x3a\x20\x53\x54\x4e\x36\x39\x56\x5a\x78\x49\x46\x53\x7a\x39\x59\x4a\x4c\x62\x7a\x31\x47\x44\x62\x78\x70\x62\x6a\x47\x36\x51\x6a\x6d\x6d\x71\x35\x45\x33\x44\x78\x52\x68\x4f\x55\x77\x2b\x45\x74\x30\x70\x34\x68\x72\x37\x63\x2f\x51\x38\x71\x4e\x63\x78\x34\x6f\x41\x44\xd\xa"
         "\x4c\x6f\x63\x61\x74\x69\x6f\x6e\x3a\x20\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x61\x6d\x61\x7a\x6f\x6e\x2e\x63\x6f\x6d\x2f\x44\x61\x6e\x2d\x42\x72\x6f\x77\x6e\x2f\x65\x2f\x42\x30\x30\x30\x41\x50\x39\x44\x53\x55\x2f\x72\x65\x66\x3d\x73\x39\x5f\x70\x6f\x70\x5f\x67\x77\x5f\x61\x6c\x31\x3f\x5f\x65\x6e\x63\x6f\x64\x69\x6e\x67\x3d\x55\x54\x46\x38\x26\x72\x65\x66\x69\x6e\x65\x6d\x65\x6e\x74\x49\x64\x3d\x36\x31\x38\x30\x37\x33\x30\x31\x31\x26\x70\x66\x5f\x72\x64\x5f\x6d\x3d\x41\x54\x56\x50\x44\x4b\x49\x4b\x58\x30\x44\x45\x52\x26\x70\x66\x5f\x72\x64\x5f\x73\x3d\x63\x65\x6e\x74\x65\x72\x2d\x32\x26\x70\x66\x5f\x72\x64\x5f\x72\x3d\x30\x53\x48\x59\x59\x35\x42\x5a\x58\x4e\x33\x4b\x52\x32\x30\x42\x4e\x46\x41\x59\x26\x70\x66\x5f\x72\x64\x5f\x74\x3d\x31\x30\x31\x26\x70\x66\x5f\x72\x64\x5f\x70\x3d\x31\x32\x36\x33\x33\x34\x30\x39\x32\x32\x26\x70\x66\x5f\x72\x64\x5f\x69\x3d\x35\x30\x37\x38\x34\x36\xd\xa"
         "\x56\x61\x72\x79\x3a\x20\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x2c\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\xd\xa"
         "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x49\x53\x4f\x2d\x38\x38\x35\x39\x2d\x31\xd\xa"
         "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
         "\xd\xa"
         "\x31\xd\xa"
         "\xa\xd\xa"
         "\x30\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 301
  ,.response_status= "\x4d\x6f\x76\x65\x64\x50\x65\x72\x6d\x61\x6e\x65\x6e\x74\x6c\x79"
  ,.num_headers= 9
  ,.headers= { { "\x44\x61\x74\x65", "\x57\x65\x64\x2c\x20\x31\x35\x20\x4d\x61\x79\x20\x32\x30\x31\x33\x20\x31\x37\x3a\x30\x36\x3a\x33\x33\x20\x47\x4d\x54" }
             , { "\x53\x65\x72\x76\x65\x72", "\x53\x65\x72\x76\x65\x72" }
             , { "\x78\x2d\x61\x6d\x7a\x2d\x69\x64\x2d\x31", "\x30\x47\x50\x48\x4b\x58\x53\x4a\x51\x38\x32\x36\x52\x4b\x37\x47\x5a\x45\x42\x32" }
             , { "\x70\x33\x70", "\x70\x6f\x6c\x69\x63\x79\x72\x65\x66\x3d\x22\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x61\x6d\x61\x7a\x6f\x6e\x2e\x63\x6f\x6d\x2f\x77\x33\x63\x2f\x70\x33\x70\x2e\x78\x6d\x6c\x22\x2c\x43\x50\x3d\x22\x43\x41\x4f\x20\x44\x53\x50\x20\x4c\x41\x57\x20\x43\x55\x52\x20\x41\x44\x4d\x20\x49\x56\x41\x6f\x20\x49\x56\x44\x6f\x20\x43\x4f\x4e\x6f\x20\x4f\x54\x50\x6f\x20\x4f\x55\x52\x20\x44\x45\x4c\x69\x20\x50\x55\x42\x69\x20\x4f\x54\x52\x69\x20\x42\x55\x53\x20\x50\x48\x59\x20\x4f\x4e\x4c\x20\x55\x4e\x49\x20\x50\x55\x52\x20\x46\x49\x4e\x20\x43\x4f\x4d\x20\x4e\x41\x56\x20\x49\x4e\x54\x20\x44\x45\x4d\x20\x43\x4e\x54\x20\x53\x54\x41\x20\x48\x45\x41\x20\x50\x52\x45\x20\x4c\x4f\x43\x20\x47\x4f\x56\x20\x4f\x54\x43\x20\x22" }
             , { "\x78\x2d\x61\x6d\x7a\x2d\x69\x64\x2d\x32", "\x53\x54\x4e\x36\x39\x56\x5a\x78\x49\x46\x53\x7a\x39\x59\x4a\x4c\x62\x7a\x31\x47\x44\x62\x78\x70\x62\x6a\x47\x36\x51\x6a\x6d\x6d\x71\x35\x45\x33\x44\x78\x52\x68\x4f\x55\x77\x2b\x45\x74\x30\x70\x34\x68\x72\x37\x63\x2f\x51\x38\x71\x4e\x63\x78\x34\x6f\x41\x44" }
             , { "\x4c\x6f\x63\x61\x74\x69\x6f\x6e", "\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x61\x6d\x61\x7a\x6f\x6e\x2e\x63\x6f\x6d\x2f\x44\x61\x6e\x2d\x42\x72\x6f\x77\x6e\x2f\x65\x2f\x42\x30\x30\x30\x41\x50\x39\x44\x53\x55\x2f\x72\x65\x66\x3d\x73\x39\x5f\x70\x6f\x70\x5f\x67\x77\x5f\x61\x6c\x31\x3f\x5f\x65\x6e\x63\x6f\x64\x69\x6e\x67\x3d\x55\x54\x46\x38\x26\x72\x65\x66\x69\x6e\x65\x6d\x65\x6e\x74\x49\x64\x3d\x36\x31\x38\x30\x37\x33\x30\x31\x31\x26\x70\x66\x5f\x72\x64\x5f\x6d\x3d\x41\x54\x56\x50\x44\x4b\x49\x4b\x58\x30\x44\x45\x52\x26\x70\x66\x5f\x72\x64\x5f\x73\x3d\x63\x65\x6e\x74\x65\x72\x2d\x32\x26\x70\x66\x5f\x72\x64\x5f\x72\x3d\x30\x53\x48\x59\x59\x35\x42\x5a\x58\x4e\x33\x4b\x52\x32\x30\x42\x4e\x46\x41\x59\x26\x70\x66\x5f\x72\x64\x5f\x74\x3d\x31\x30\x31\x26\x70\x66\x5f\x72\x64\x5f\x70\x3d\x31\x32\x36\x33\x33\x34\x30\x39\x32\x32\x26\x70\x66\x5f\x72\x64\x5f\x69\x3d\x35\x30\x37\x38\x34\x36" }
             , { "\x56\x61\x72\x79", "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x2c\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74" }
             , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c\x3b\x20\x63\x68\x61\x72\x73\x65\x74\x3d\x49\x53\x4f\x2d\x38\x38\x35\x39\x2d\x31" }
             , { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
             }
  ,.body= "\xa"
  ,.num_chunks_complete= 2
  ,.chunk_lengths= { 1 }
  }

#define EMPTY_REASON_PHRASE_AFTER_SPACE 20
, {.name= "\x65\x6d\x70\x74\x79\x20\x72\x65\x61\x73\x6f\x6e\x20\x70\x68\x72\x61\x73\x65\x20\x61\x66\x74\x65\x72\x20\x73\x70\x61\x63\x65"
  ,.type= HTTP_RESPONSE
  ,.raw= "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\xd\xa"
         "\xd\xa"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= ""
  ,.num_headers= 0
  ,.headers= {}
  ,.body= ""
  }

#define CONTENT_LENGTH_X 21
, {.name= "Content-Length-X"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 200 OK\r\n"
         "Content-Length-X: 0\r\n"
         "Transfer-Encoding: chunked\r\n"
         "\r\n"
         "2\r\n"
         "OK\r\n"
         "0\r\n"
         "\r\n"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "OK"
  ,.num_headers= 2
  ,.headers= { { "Content-Length-X", "0" }
             , { "Transfer-Encoding", "chunked" }
             }
  ,.body= "OK"
  ,.num_chunks_complete= 2
  ,.chunk_lengths= { 2 }
  }

#define HTTP_101_RESPONSE_WITH_UPGRADE_HEADER 22
, {.name= "HTTP 101 response with Upgrade header"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 101 Switching Protocols\r\n"
         "Connection: upgrade\r\n"
         "Upgrade: h2c\r\n"
         "\r\n"
         "proto"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 101
  ,.response_status= "Switching Protocols"
  ,.upgrade= "proto"
  ,.num_headers= 2
  ,.headers=
    { { "Connection", "upgrade" }
    , { "Upgrade", "h2c" }
    }
  }

#define HTTP_101_RESPONSE_WITH_UPGRADE_HEADER_AND_CONTENT_LENGTH 23
, {.name= "HTTP 101 response with Upgrade and Content-Length header"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 101 Switching Protocols\r\n"
         "Connection: upgrade\r\n"
         "Upgrade: h2c\r\n"
         "Content-Length: 4\r\n"
         "\r\n"
         "body"
         "proto"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 101
  ,.response_status= "Switching Protocols"
  ,.body= "body"
  ,.upgrade= "proto"
  ,.num_headers= 3
  ,.headers=
    { { "Connection", "upgrade" }
    , { "Upgrade", "h2c" }
    , { "Content-Length", "4" }
    }
  }

#define HTTP_101_RESPONSE_WITH_UPGRADE_HEADER_AND_TRANSFER_ENCODING 24
, {.name= "HTTP 101 response with Upgrade and Transfer-Encoding header"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 101 Switching Protocols\r\n"
         "Connection: upgrade\r\n"
         "Upgrade: h2c\r\n"
         "Transfer-Encoding: chunked\r\n"
         "\r\n"
         "2\r\n"
         "bo\r\n"
         "2\r\n"
         "dy\r\n"
         "0\r\n"
         "\r\n"
         "proto"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 101
  ,.response_status= "Switching Protocols"
  ,.body= "body"
  ,.upgrade= "proto"
  ,.num_headers= 3
  ,.headers=
    { { "Connection", "upgrade" }
    , { "Upgrade", "h2c" }
    , { "Transfer-Encoding", "chunked" }
    }
  ,.num_chunks_complete= 3
  ,.chunk_lengths= { 2, 2 }
  }

#define HTTP_200_RESPONSE_WITH_UPGRADE_HEADER 25
, {.name= "HTTP 200 response with Upgrade header"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 200 OK\r\n"
         "Connection: upgrade\r\n"
         "Upgrade: h2c\r\n"
         "\r\n"
         "body"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "OK"
  ,.body= "body"
  ,.upgrade= NULL
  ,.num_headers= 2
  ,.headers=
    { { "Connection", "upgrade" }
    , { "Upgrade", "h2c" }
    }
  }

#define HTTP_200_RESPONSE_WITH_UPGRADE_HEADER_AND_CONTENT_LENGTH 26
, {.name= "HTTP 200 response with Upgrade and Content-Length header"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 200 OK\r\n"
         "Connection: upgrade\r\n"
         "Upgrade: h2c\r\n"
         "Content-Length: 4\r\n"
         "\r\n"
         "body"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "OK"
  ,.num_headers= 3
  ,.body= "body"
  ,.upgrade= NULL
  ,.headers=
    { { "Connection", "upgrade" }
    , { "Upgrade", "h2c" }
    , { "Content-Length", "4" }
    }
  }

#define HTTP_200_RESPONSE_WITH_UPGRADE_HEADER_AND_TRANSFER_ENCODING 27
, {.name= "HTTP 200 response with Upgrade and Transfer-Encoding header"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 200 OK\r\n"
         "Connection: upgrade\r\n"
         "Upgrade: h2c\r\n"
         "Transfer-Encoding: chunked\r\n"
         "\r\n"
         "2\r\n"
         "bo\r\n"
         "2\r\n"
         "dy\r\n"
         "0\r\n"
         "\r\n"
  ,.should_keep_alive= TRUE
  ,.message_complete_on_eof= FALSE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "OK"
  ,.num_headers= 3
  ,.body= "body"
  ,.upgrade= NULL
  ,.headers=
    { { "Connection", "upgrade" }
    , { "Upgrade", "h2c" }
    , { "Transfer-Encoding", "chunked" }
    }
  ,.num_chunks_complete= 3
  ,.chunk_lengths= { 2, 2 }
  }
#define HTTP_200_MULTI_TE_NOT_LAST_CHUNKED 28
, {.name= "HTTP 200 response with `chunked` being *not last* Transfer-Encoding"
  ,.type= HTTP_RESPONSE
  ,.raw= "HTTP/1.1 200 OK\r\n"
         "Transfer-Encoding: chunked, identity\r\n"
         "\r\n"
         "2\r\n"
         "OK\r\n"
         "0\r\n"
         "\r\n"
  ,.should_keep_alive= FALSE
  ,.message_complete_on_eof= TRUE
  ,.http_major= 1
  ,.http_minor= 1
  ,.status_code= 200
  ,.response_status= "OK"
  ,.num_headers= 1
  ,.headers= { { "Transfer-Encoding", "chunked, identity" }
             }
  ,.body= "2\r\nOK\r\n0\r\n\r\n"
  ,.num_chunks_complete= 0
  }
};

/* strnlen() is a POSIX.2008 addition. Can't rely on it being available so
 * define it ourselves.
 */
size_t
strnlen(const char *s, size_t maxlen)
{
  const char *p;

  p = memchr(s, '\x0', maxlen);
  if (p == NULL)
    return maxlen;

  return p - s;
}

size_t
strlncat(char *dst, size_t len, const char *src, size_t n)
{
  size_t slen;
  size_t dlen;
  size_t rlen;
  size_t ncpy;

  slen = strnlen(src, n);
  dlen = strnlen(dst, len);

  if (dlen < len) {
    rlen = len - dlen;
    ncpy = slen < rlen ? slen : (rlen - 1);
    memcpy(dst + dlen, src, ncpy);
    dst[dlen + ncpy] = '\x0';
  }

  assert(len > slen + dlen);
  return slen + dlen;
}

size_t
strlncpy(char *dst, size_t len, const char *src, size_t n)
{
  size_t slen;
  size_t ncpy;

  slen = strnlen(src, n);

  if (len > 0) {
    ncpy = slen < len ? slen : (len - 1);
    memcpy(dst, src, ncpy);
    dst[ncpy] = '\x0';
  }

  assert(len > slen);
  return slen;
}

int
request_url_cb (http_parser *p, const char *buf, size_t len)
{
  assert(p == &parser);
  strlncat(messages[num_messages].request_url,
           sizeof(messages[num_messages].request_url),
           buf,
           len);
  return 0;
}

int
header_field_cb (http_parser *p, const char *buf, size_t len)
{
  assert(p == &parser);
  struct message *m = &messages[num_messages];

  if (m->last_header_element != FIELD)
    m->num_headers++;

  strlncat(m->headers[m->num_headers-1][0],
           sizeof(m->headers[m->num_headers-1][0]),
           buf,
           len);

  m->last_header_element = FIELD;

  return 0;
}

int
header_value_cb (http_parser *p, const char *buf, size_t len)
{
  assert(p == &parser);
  struct message *m = &messages[num_messages];

  strlncat(m->headers[m->num_headers-1][1],
           sizeof(m->headers[m->num_headers-1][1]),
           buf,
           len);

  m->last_header_element = VALUE;

  return 0;
}

void
check_body_is_final (const http_parser *p)
{
  if (messages[num_messages].body_is_final) {
    fprintf(stderr, "\n\n *** Error http_body_is_final() should return 1 "
                    "\x6f\x6e\x20\x6c\x61\x73\x74\x20\x6f\x6e\x5f\x62\x6f\x64\x79\x20\x63\x61\x6c\x6c\x62\x61\x63\x6b\x20\x63\x61\x6c\x6c\x20"
                    "\x62\x75\x74\x20\x69\x74\x20\x64\x6f\x65\x73\x6e\x27\x74\x21\x20\x2a\x2a\x2a\xa\xa");
    assert(0);
    abort();
  }
  messages[num_messages].body_is_final = http_body_is_final(p);
}

int
body_cb (http_parser *p, const char *buf, size_t len)
{
  assert(p == &parser);
  strlncat(messages[num_messages].body,
           sizeof(messages[num_messages].body),
           buf,
           len);
  messages[num_messages].body_size += len;
  check_body_is_final(p);
 // printf("body_cb: '%s'\n", requests[num_messages].body);
  return 0;
}

int
count_body_cb (http_parser *p, const char *buf, size_t len)
{
  assert(p == &parser);
  assert(buf);
  messages[num_messages].body_size += len;
  check_body_is_final(p);
  return 0;
}

int
message_begin_cb (http_parser *p)
{
  assert(p == &parser);
  assert(!messages[num_messages].message_begin_cb_called);
  messages[num_messages].message_begin_cb_called = TRUE;
  return 0;
}

int
headers_complete_cb (http_parser *p)
{
  assert(p == &parser);
  messages[num_messages].method = parser.method;
  messages[num_messages].status_code = parser.status_code;
  messages[num_messages].http_major = parser.http_major;
  messages[num_messages].http_minor = parser.http_minor;
  messages[num_messages].headers_complete_cb_called = TRUE;
  messages[num_messages].should_keep_alive = http_should_keep_alive(&parser);
  return 0;
}

int
message_complete_cb (http_parser *p)
{
  assert(p == &parser);
  if (messages[num_messages].should_keep_alive !=
      http_should_keep_alive(&parser))
  {
    fprintf(stderr, "\n\n *** Error http_should_keep_alive() should have same "
                    "\x76\x61\x6c\x75\x65\x20\x69\x6e\x20\x62\x6f\x74\x68\x20\x6f\x6e\x5f\x6d\x65\x73\x73\x61\x67\x65\x5f\x63\x6f\x6d\x70\x6c\x65\x74\x65\x20\x61\x6e\x64\x20\x6f\x6e\x5f\x68\x65\x61\x64\x65\x72\x73\x5f\x63\x6f\x6d\x70\x6c\x65\x74\x65\x20"
                    "\x62\x75\x74\x20\x69\x74\x20\x64\x6f\x65\x73\x6e\x27\x74\x21\x20\x2a\x2a\x2a\xa\xa");
    assert(0);
    abort();
  }

  if (messages[num_messages].body_size &&
      http_body_is_final(p) &&
      !messages[num_messages].body_is_final)
  {
    fprintf(stderr, "\n\n *** Error http_body_is_final() should return 1 "
                    "\x6f\x6e\x20\x6c\x61\x73\x74\x20\x6f\x6e\x5f\x62\x6f\x64\x79\x20\x63\x61\x6c\x6c\x62\x61\x63\x6b\x20\x63\x61\x6c\x6c\x20"
                    "\x62\x75\x74\x20\x69\x74\x20\x64\x6f\x65\x73\x6e\x27\x74\x21\x20\x2a\x2a\x2a\xa\xa");
    assert(0);
    abort();
  }

  messages[num_messages].message_complete_cb_called = TRUE;

  messages[num_messages].message_complete_on_eof = currently_parsing_eof;

  num_messages++;
  return 0;
}

int
response_status_cb (http_parser *p, const char *buf, size_t len)
{
  assert(p == &parser);

  messages[num_messages].status_cb_called = TRUE;

  strlncat(messages[num_messages].response_status,
           sizeof(messages[num_messages].response_status),
           buf,
           len);
  return 0;
}

int
chunk_header_cb (http_parser *p)
{
  assert(p == &parser);
  int chunk_idx = messages[num_messages].num_chunks;
  messages[num_messages].num_chunks++;
  if (chunk_idx < MAX_CHUNKS) {
    messages[num_messages].chunk_lengths[chunk_idx] = p->content_length;
  }

  return 0;
}

int
chunk_complete_cb (http_parser *p)
{
  assert(p == &parser);

  /* Here we want to verify that each chunk_header_cb is matched by a
   * chunk_complete_cb, so not only should the total number of calls to
   * both callbacks be the same, but they also should be interleaved
   * properly */
  assert(messages[num_messages].num_chunks ==
         messages[num_messages].num_chunks_complete + 1);

  messages[num_messages].num_chunks_complete++;
  return 0;
}

/* These dontcall_* callbacks exist so that we can verify that when we're
 * paused, no additional callbacks are invoked */
int
dontcall_message_begin_cb (http_parser *p)
{
  if (p) { } // gcc
  fprintf(stderr, "\n\n*** on_message_begin() called on paused parser ***\n\n");
  abort();
}

int
dontcall_header_field_cb (http_parser *p, const char *buf, size_t len)
{
  if (p || buf || len) { } // gcc
  fprintf(stderr, "\n\n*** on_header_field() called on paused parser ***\n\n");
  abort();
}

int
dontcall_header_value_cb (http_parser *p, const char *buf, size_t len)
{
  if (p || buf || len) { } // gcc
  fprintf(stderr, "\n\n*** on_header_value() called on paused parser ***\n\n");
  abort();
}

int
dontcall_request_url_cb (http_parser *p, const char *buf, size_t len)
{
  if (p || buf || len) { } // gcc
  fprintf(stderr, "\n\n*** on_request_url() called on paused parser ***\n\n");
  abort();
}

int
dontcall_body_cb (http_parser *p, const char *buf, size_t len)
{
  if (p || buf || len) { } // gcc
  fprintf(stderr, "\n\n*** on_body_cb() called on paused parser ***\n\n");
  abort();
}

int
dontcall_headers_complete_cb (http_parser *p)
{
  if (p) { } // gcc
  fprintf(stderr, "\n\n*** on_headers_complete() called on paused "
                  "\x70\x61\x72\x73\x65\x72\x20\x2a\x2a\x2a\xa\xa");
  abort();
}

int
dontcall_message_complete_cb (http_parser *p)
{
  if (p) { } // gcc
  fprintf(stderr, "\n\n*** on_message_complete() called on paused "
                  "\x70\x61\x72\x73\x65\x72\x20\x2a\x2a\x2a\xa\xa");
  abort();
}

int
dontcall_response_status_cb (http_parser *p, const char *buf, size_t len)
{
  if (p || buf || len) { } // gcc
  fprintf(stderr, "\n\n*** on_status() called on paused parser ***\n\n");
  abort();
}

int
dontcall_chunk_header_cb (http_parser *p)
{
  if (p) { } // gcc
  fprintf(stderr, "\n\n*** on_chunk_header() called on paused parser ***\n\n");
  exit(1);
}

int
dontcall_chunk_complete_cb (http_parser *p)
{
  if (p) { } // gcc
  fprintf(stderr, "\n\n*** on_chunk_complete() "
          "\x63\x61\x6c\x6c\x65\x64\x20\x6f\x6e\x20\x70\x61\x75\x73\x65\x64\x20\x70\x61\x72\x73\x65\x72\x20\x2a\x2a\x2a\xa\xa");
  exit(1);
}

static http_parser_settings settings_dontcall =
  {.on_message_begin = dontcall_message_begin_cb
  ,.on_header_field = dontcall_header_field_cb
  ,.on_header_value = dontcall_header_value_cb
  ,.on_url = dontcall_request_url_cb
  ,.on_status = dontcall_response_status_cb
  ,.on_body = dontcall_body_cb
  ,.on_headers_complete = dontcall_headers_complete_cb
  ,.on_message_complete = dontcall_message_complete_cb
  ,.on_chunk_header = dontcall_chunk_header_cb
  ,.on_chunk_complete = dontcall_chunk_complete_cb
  };

/* These pause_* callbacks always pause the parser and just invoke the regular
 * callback that tracks content. Before returning, we overwrite the parser
 * settings to point to the _dontcall variety so that we can verify that
 * the pause actually did, you know, pause. */
int
pause_message_begin_cb (http_parser *p)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return message_begin_cb(p);
}

int
pause_header_field_cb (http_parser *p, const char *buf, size_t len)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return header_field_cb(p, buf, len);
}

int
pause_header_value_cb (http_parser *p, const char *buf, size_t len)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return header_value_cb(p, buf, len);
}

int
pause_request_url_cb (http_parser *p, const char *buf, size_t len)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return request_url_cb(p, buf, len);
}

int
pause_body_cb (http_parser *p, const char *buf, size_t len)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return body_cb(p, buf, len);
}

int
pause_headers_complete_cb (http_parser *p)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return headers_complete_cb(p);
}

int
pause_message_complete_cb (http_parser *p)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return message_complete_cb(p);
}

int
pause_response_status_cb (http_parser *p, const char *buf, size_t len)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return response_status_cb(p, buf, len);
}

int
pause_chunk_header_cb (http_parser *p)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return chunk_header_cb(p);
}

int
pause_chunk_complete_cb (http_parser *p)
{
  http_parser_pause(p, 1);
  *current_pause_parser = settings_dontcall;
  return chunk_complete_cb(p);
}

int
connect_headers_complete_cb (http_parser *p)
{
  headers_complete_cb(p);
  return 1;
}

int
connect_message_complete_cb (http_parser *p)
{
  messages[num_messages].should_keep_alive = http_should_keep_alive(&parser);
  return message_complete_cb(p);
}

static http_parser_settings settings_pause =
  {.on_message_begin = pause_message_begin_cb
  ,.on_header_field = pause_header_field_cb
  ,.on_header_value = pause_header_value_cb
  ,.on_url = pause_request_url_cb
  ,.on_status = pause_response_status_cb
  ,.on_body = pause_body_cb
  ,.on_headers_complete = pause_headers_complete_cb
  ,.on_message_complete = pause_message_complete_cb
  ,.on_chunk_header = pause_chunk_header_cb
  ,.on_chunk_complete = pause_chunk_complete_cb
  };

static http_parser_settings settings =
  {.on_message_begin = message_begin_cb
  ,.on_header_field = header_field_cb
  ,.on_header_value = header_value_cb
  ,.on_url = request_url_cb
  ,.on_status = response_status_cb
  ,.on_body = body_cb
  ,.on_headers_complete = headers_complete_cb
  ,.on_message_complete = message_complete_cb
  ,.on_chunk_header = chunk_header_cb
  ,.on_chunk_complete = chunk_complete_cb
  };

static http_parser_settings settings_count_body =
  {.on_message_begin = message_begin_cb
  ,.on_header_field = header_field_cb
  ,.on_header_value = header_value_cb
  ,.on_url = request_url_cb
  ,.on_status = response_status_cb
  ,.on_body = count_body_cb
  ,.on_headers_complete = headers_complete_cb
  ,.on_message_complete = message_complete_cb
  ,.on_chunk_header = chunk_header_cb
  ,.on_chunk_complete = chunk_complete_cb
  };

static http_parser_settings settings_connect =
  {.on_message_begin = message_begin_cb
  ,.on_header_field = header_field_cb
  ,.on_header_value = header_value_cb
  ,.on_url = request_url_cb
  ,.on_status = response_status_cb
  ,.on_body = dontcall_body_cb
  ,.on_headers_complete = connect_headers_complete_cb
  ,.on_message_complete = connect_message_complete_cb
  ,.on_chunk_header = chunk_header_cb
  ,.on_chunk_complete = chunk_complete_cb
  };

static http_parser_settings settings_null =
  {.on_message_begin = 0
  ,.on_header_field = 0
  ,.on_header_value = 0
  ,.on_url = 0
  ,.on_status = 0
  ,.on_body = 0
  ,.on_headers_complete = 0
  ,.on_message_complete = 0
  ,.on_chunk_header = 0
  ,.on_chunk_complete = 0
  };

void
parser_init (enum http_parser_type type)
{
  num_messages = 0;
  http_parser_init(&parser, type);
  memset(&messages, 0, sizeof messages);
}

size_t parse (const char *buf, size_t len)
{
  size_t nparsed;
  currently_parsing_eof = (len == 0);
  nparsed = http_parser_execute(&parser, &settings, buf, len);
  return nparsed;
}

size_t parse_count_body (const char *buf, size_t len)
{
  size_t nparsed;
  currently_parsing_eof = (len == 0);
  nparsed = http_parser_execute(&parser, &settings_count_body, buf, len);
  return nparsed;
}

size_t parse_pause (const char *buf, size_t len)
{
  size_t nparsed;
  http_parser_settings s = settings_pause;

  currently_parsing_eof = (len == 0);
  current_pause_parser = &s;
  nparsed = http_parser_execute(&parser, current_pause_parser, buf, len);
  return nparsed;
}

size_t parse_connect (const char *buf, size_t len)
{
  size_t nparsed;
  currently_parsing_eof = (len == 0);
  nparsed = http_parser_execute(&parser, &settings_connect, buf, len);
  return nparsed;
}

static inline int
check_str_eq (const struct message *m,
              const char *prop,
              const char *expected,
              const char *found) {
  if ((expected == NULL) != (found == NULL)) {
    printf("\n*** Error: %s in '%s' ***\n\n", prop, m->name);
    printf("expected %s\n", (expected == NULL) ? "NULL" : expected);
    printf("   found %s\n", (found == NULL) ? "NULL" : found);
    return 0;
  }
  if (expected != NULL && 0 != strcmp(expected, found)) {
    printf("\n*** Error: %s in '%s' ***\n\n", prop, m->name);
    printf("expected '%s'\n", expected);
    printf("   found '%s'\n", found);
    return 0;
  }
  return 1;
}

static inline int
check_num_eq (const struct message *m,
              const char *prop,
              int expected,
              int found) {
  if (expected != found) {
    printf("\n*** Error: %s in '%s' ***\n\n", prop, m->name);
    printf("expected %d\n", expected);
    printf("   found %d\n", found);
    return 0;
  }
  return 1;
}

#define MESSAGE_CHECK_STR_EQ(expected, found, prop) \
  if (!check_str_eq(expected,  USTR(#prop), expected->prop, found->prop)) return 0

#define MESSAGE_CHECK_NUM_EQ(expected, found, prop) \
  if (!check_num_eq(expected,  USTR(#prop), expected->prop, found->prop)) return 0

#define MESSAGE_CHECK_URL_EQ(u, expected, found, prop, fn)           \
do {                                                                 \
  char ubuf[256];                                                    \
                                                                     \
  if ((u)->field_set & (1 << (fn))) {                                \
    memcpy(ubuf, (found)->request_url + (u)->field_data[(fn)].off,   \
      (u)->field_data[(fn)].len);                                    \
    ubuf[(u)->field_data[(fn)].len] = '\x0';                          \
  } else {                                                           \
    ubuf[0] = '\x0';                                                  \
  }                                                                  \
                                                                     \
  check_str_eq(expected,  USTR(#prop), expected->prop, ubuf);               \
} while(0)

int
message_eq (int index, int connect, const struct message *expected)
{
  int i;
  struct message *m = &messages[index];

  MESSAGE_CHECK_NUM_EQ(expected, m, http_major);
  MESSAGE_CHECK_NUM_EQ(expected, m, http_minor);

  if (expected->type == HTTP_REQUEST) {
    MESSAGE_CHECK_NUM_EQ(expected, m, method);
  } else {
    MESSAGE_CHECK_NUM_EQ(expected, m, status_code);
    MESSAGE_CHECK_STR_EQ(expected, m, response_status);
    assert(m->status_cb_called);
  }

  if (!connect) {
    MESSAGE_CHECK_NUM_EQ(expected, m, should_keep_alive);
    MESSAGE_CHECK_NUM_EQ(expected, m, message_complete_on_eof);
  }

  assert(m->message_begin_cb_called);
  assert(m->headers_complete_cb_called);
  assert(m->message_complete_cb_called);


  MESSAGE_CHECK_STR_EQ(expected, m, request_url);

  /* Check URL components; we can't do this w/ CONNECT since it doesn't
   * send us a well-formed URL.
   */
  if (*m->request_url && m->method != HTTP_CONNECT) {
    struct http_parser_url u;

    if (http_parser_parse_url(m->request_url, strlen(m->request_url), 0, &u)) {
      fprintf(stderr, "\n\n*** failed to parse URL %s ***\n\n",
        m->request_url);
      abort();
    }

    if (expected->host) {
      MESSAGE_CHECK_URL_EQ(&u, expected, m, host, UF_HOST);
    }

    if (expected->userinfo) {
      MESSAGE_CHECK_URL_EQ(&u, expected, m, userinfo, UF_USERINFO);
    }

    m->port = (u.field_set & (1 << UF_PORT)) ?
      u.port : 0;

    MESSAGE_CHECK_URL_EQ(&u, expected, m, query_string, UF_QUERY);
    MESSAGE_CHECK_URL_EQ(&u, expected, m, fragment, UF_FRAGMENT);
    MESSAGE_CHECK_URL_EQ(&u, expected, m, request_path, UF_PATH);
    MESSAGE_CHECK_NUM_EQ(expected, m, port);
  }

  if (connect) {
    check_num_eq(m, "\x62\x6f\x64\x79\x5f\x73\x69\x7a\x65", 0, m->body_size);
  } else if (expected->body_size) {
    MESSAGE_CHECK_NUM_EQ(expected, m, body_size);
  } else {
    MESSAGE_CHECK_STR_EQ(expected, m, body);
  }

  if (connect) {
    check_num_eq(m, "\x6e\x75\x6d\x5f\x63\x68\x75\x6e\x6b\x73\x5f\x63\x6f\x6d\x70\x6c\x65\x74\x65", 0, m->num_chunks_complete);
  } else {
    assert(m->num_chunks == m->num_chunks_complete);
    MESSAGE_CHECK_NUM_EQ(expected, m, num_chunks_complete);
    for (i = 0; i < m->num_chunks && i < MAX_CHUNKS; i++) {
      MESSAGE_CHECK_NUM_EQ(expected, m, chunk_lengths[i]);
    }
  }

  MESSAGE_CHECK_NUM_EQ(expected, m, num_headers);

  int r;
  for (i = 0; i < m->num_headers; i++) {
    r = check_str_eq(expected, "\x68\x65\x61\x64\x65\x72\x20\x66\x69\x65\x6c\x64", expected->headers[i][0], m->headers[i][0]);
    if (!r) return 0;
    r = check_str_eq(expected, "\x68\x65\x61\x64\x65\x72\x20\x76\x61\x6c\x75\x65", expected->headers[i][1], m->headers[i][1]);
    if (!r) return 0;
  }

  if (!connect) {
    MESSAGE_CHECK_STR_EQ(expected, m, upgrade);
  }

  return 1;
}

/* Given a sequence of varargs messages, return the number of them that the
 * parser should successfully parse, taking into account that upgraded
 * messages prevent all subsequent messages from being parsed.
 */
size_t
count_parsed_messages(const size_t nmsgs, ...) {
  size_t i;
  va_list ap;

  va_start(ap, nmsgs);

  for (i = 0; i < nmsgs; i++) {
    struct message *m = va_arg(ap, struct message *);

    if (m->upgrade) {
      va_end(ap);
      return i + 1;
    }
  }

  va_end(ap);
  return nmsgs;
}

/* Given a sequence of bytes and the number of these that we were able to
 * parse, verify that upgrade bodies are correct.
 */
void
upgrade_message_fix(char *body, const size_t nread, const size_t nmsgs, ...) {
  va_list ap;
  size_t i;
  size_t off = 0;

  va_start(ap, nmsgs);

  for (i = 0; i < nmsgs; i++) {
    struct message *m = va_arg(ap, struct message *);

    off += strlen(m->raw);

    if (m->upgrade) {
      off -= strlen(m->upgrade);

      /* Check the portion of the response after its specified upgrade */
      if (!check_str_eq(m, "\x75\x70\x67\x72\x61\x64\x65", body + off, body + nread)) {
        abort();
      }

      /* Fix up the response so that message_eq() will verify the beginning
       * of the upgrade */
      *(body + nread + strlen(m->upgrade)) = '\x0';
      messages[num_messages -1 ].upgrade = body + nread;

      va_end(ap);
      return;
    }
  }

  va_end(ap);
  printf("\n\n*** Error: expected a message with upgrade ***\n");

  abort();
}

static void
print_error (const char *raw, size_t error_location)
{
  fprintf(stderr, "\n*** %s ***\n\n",
          http_errno_description(HTTP_PARSER_ERRNO(&parser)));

  int this_line = 0, char_len = 0;
  size_t i, j, len = strlen(raw), error_location_line = 0;
  for (i = 0; i < len; i++) {
    if (i == error_location) this_line = 1;
    switch (raw[i]) {
      case '\xd':
        char_len = 2;
        fprintf(stderr, "\\r");
        break;

      case '\xa':
        fprintf(stderr, "\\n\n");

        if (this_line) goto print;

        error_location_line = 0;
        continue;

      default:
        char_len = 1;
        fputc(raw[i], stderr);
        break;
    }
    if (!this_line) error_location_line += char_len;
  }

  fprintf(stderr, "[eof]\n");

 print:
  for (j = 0; j < error_location_line; j++) {
    fputc('\x20', stderr);
  }
  fprintf(stderr, "^\n\nerror location: %u\n", (unsigned int)error_location);
}

void
test_preserve_data (void)
{
  char my_data[] = "\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2d\x73\x70\x65\x63\x69\x66\x69\x63\x20\x64\x61\x74\x61";
  http_parser parser;
  parser.data = my_data;
  http_parser_init(&parser, HTTP_REQUEST);
  if (parser.data != my_data) {
    printf("\n*** parser.data not preserved accross http_parser_init ***\n\n");
    abort();
  }
}

struct url_test {
  const char *name;
  const char *url;
  int is_connect;
  struct http_parser_url u;
  int rv;
};

const struct url_test url_tests[] =
{ {.name="\x70\x72\x6f\x78\x79\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x6e\x61\x6d\x65\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set=(1 << UF_SCHEMA) | (1 << UF_HOST) | (1 << UF_PATH)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  7,  8 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 15,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x72\x65\x71\x75\x65\x73\x74\x20\x77\x69\x74\x68\x20\x70\x6f\x72\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x34\x34\x34\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set=(1 << UF_SCHEMA) | (1 << UF_HOST) | (1 << UF_PORT) | (1 << UF_PATH)
    ,.port=444
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  7,  8 } /* UF_HOST */
      ,{ 16,  3 } /* UF_PORT */
      ,{ 19,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.url="\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x34\x34\x33"
  ,.is_connect=1
  ,.u=
    {.field_set=(1 << UF_HOST) | (1 << UF_PORT)
    ,.port=443
    ,.field_data=
      {{  0,  0 } /* UF_SCHEMA */
      ,{  0,  8 } /* UF_HOST */
      ,{  9,  3 } /* UF_PORT */
      ,{  0,  0 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x72\x65\x71\x75\x65\x73\x74\x20\x62\x75\x74\x20\x6e\x6f\x74\x20\x63\x6f\x6e\x6e\x65\x63\x74"
  ,.url="\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x34\x34\x33"
  ,.is_connect=0
  ,.rv=1
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x69\x70\x76\x36\x20\x72\x65\x71\x75\x65\x73\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x31\x3a\x32\x3a\x3a\x33\x3a\x34\x5d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set=(1 << UF_SCHEMA) | (1 << UF_HOST) | (1 << UF_PATH)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  8,  8 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 17,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x69\x70\x76\x36\x20\x72\x65\x71\x75\x65\x73\x74\x20\x77\x69\x74\x68\x20\x70\x6f\x72\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x31\x3a\x32\x3a\x3a\x33\x3a\x34\x5d\x3a\x36\x37\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set=(1 << UF_SCHEMA) | (1 << UF_HOST) | (1 << UF_PORT) | (1 << UF_PATH)
    ,.port=67
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  8,  8 } /* UF_HOST */
      ,{ 18,  2 } /* UF_PORT */
      ,{ 20,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x69\x70\x76\x36\x20\x61\x64\x64\x72\x65\x73\x73"
  ,.url="\x5b\x31\x3a\x32\x3a\x3a\x33\x3a\x34\x5d\x3a\x34\x34\x33"
  ,.is_connect=1
  ,.u=
    {.field_set=(1 << UF_HOST) | (1 << UF_PORT)
    ,.port=443
    ,.field_data=
      {{  0,  0 } /* UF_SCHEMA */
      ,{  1,  8 } /* UF_HOST */
      ,{ 11,  3 } /* UF_PORT */
      ,{  0,  0 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x69\x70\x76\x34\x20\x69\x6e\x20\x69\x70\x76\x36\x20\x61\x64\x64\x72\x65\x73\x73"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x32\x30\x30\x31\x3a\x30\x30\x30\x30\x3a\x30\x30\x30\x30\x3a\x30\x30\x30\x30\x3a\x30\x30\x30\x30\x3a\x30\x30\x30\x30\x3a\x31\x2e\x39\x2e\x31\x2e\x31\x5d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set=(1 << UF_SCHEMA) | (1 << UF_HOST) | (1 << UF_PATH)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  8, 37 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 46,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x65\x78\x74\x72\x61\x20\x3f\x20\x69\x6e\x20\x71\x75\x65\x72\x79\x20\x73\x74\x72\x69\x6e\x67"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x61\x2e\x74\x62\x63\x64\x6e\x2e\x63\x6e\x2f\x70\x2f\x66\x70\x2f\x32\x30\x31\x30\x63\x2f\x3f\x3f\x66\x70\x2d\x68\x65\x61\x64\x65\x72\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x62\x61\x73\x65\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c"
  "\x66\x70\x2d\x63\x68\x61\x6e\x6e\x65\x6c\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x70\x72\x6f\x64\x75\x63\x74\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x6d\x61\x6c\x6c\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x63\x61\x74\x65\x67\x6f\x72\x79\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c"
  "\x66\x70\x2d\x73\x75\x62\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x67\x64\x70\x34\x70\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x63\x73\x73\x33\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x2c\x66\x70\x2d\x6d\x69\x73\x63\x2d\x6d\x69\x6e\x2e\x63\x73\x73\x3f\x74\x3d\x32\x30\x31\x30\x31\x30\x32\x32\x2e\x63\x73\x73"
  ,.is_connect=0
  ,.u=
    {.field_set=(1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH) | (1<<UF_QUERY)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  7, 10 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 17, 12 } /* UF_PATH */
      ,{ 30,187 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x73\x70\x61\x63\x65\x20\x55\x52\x4c\x20\x65\x6e\x63\x6f\x64\x65\x64"
  ,.url="\x2f\x74\x6f\x74\x6f\x2e\x68\x74\x6d\x6c\x3f\x74\x6f\x74\x6f\x3d\x61\x25\x32\x30\x62"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_PATH) | (1<<UF_QUERY)
    ,.port=0
    ,.field_data=
      {{  0,  0 } /* UF_SCHEMA */
      ,{  0,  0 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{  0, 10 } /* UF_PATH */
      ,{ 11, 10 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }


, {.name="\x55\x52\x4c\x20\x66\x72\x61\x67\x6d\x65\x6e\x74"
  ,.url="\x2f\x74\x6f\x74\x6f\x2e\x68\x74\x6d\x6c\x23\x74\x69\x74\x69"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_PATH) | (1<<UF_FRAGMENT)
    ,.port=0
    ,.field_data=
      {{  0,  0 } /* UF_SCHEMA */
      ,{  0,  0 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{  0, 10 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{ 11,  4 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x63\x6f\x6d\x70\x6c\x65\x78\x20\x55\x52\x4c\x20\x66\x72\x61\x67\x6d\x65\x6e\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x77\x65\x62\x6d\x61\x73\x74\x65\x72\x77\x6f\x72\x6c\x64\x2e\x63\x6f\x6d\x2f\x72\x2e\x63\x67\x69\x3f\x66\x3d\x32\x31\x26\x64\x3d\x38\x34\x30\x35\x26\x75\x72\x6c\x3d"
    "\x68\x74\x74\x70\x3a\x2f\x2f\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x2f\x69\x6e\x64\x65\x78\x2e\x68\x74\x6d\x6c\x3f\x66\x6f\x6f\x3d\x62\x61\x72\x26\x68\x65\x6c\x6c\x6f\x3d\x77\x6f\x72\x6c\x64\x23\x6d\x69\x64\x70\x61\x67\x65"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH) | (1<<UF_QUERY) |\
      (1<<UF_FRAGMENT)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  7, 22 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 29,  6 } /* UF_PATH */
      ,{ 36, 69 } /* UF_QUERY */
      ,{106,  7 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x63\x6f\x6d\x70\x6c\x65\x78\x20\x55\x52\x4c\x20\x66\x72\x6f\x6d\x20\x6e\x6f\x64\x65\x20\x6a\x73\x20\x75\x72\x6c\x20\x70\x61\x72\x73\x65\x72\x20\x64\x6f\x63"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x2e\x63\x6f\x6d\x3a\x38\x30\x38\x30\x2f\x70\x2f\x61\x2f\x74\x2f\x68\x3f\x71\x75\x65\x72\x79\x3d\x73\x74\x72\x69\x6e\x67\x23\x68\x61\x73\x68"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PORT) | (1<<UF_PATH) |\
      (1<<UF_QUERY) | (1<<UF_FRAGMENT)
    ,.port=8080
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  7,  8 } /* UF_HOST */
      ,{ 16,  4 } /* UF_PORT */
      ,{ 20,  8 } /* UF_PATH */
      ,{ 29, 12 } /* UF_QUERY */
      ,{ 42,  4 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x63\x6f\x6d\x70\x6c\x65\x78\x20\x55\x52\x4c\x20\x77\x69\x74\x68\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68\x20\x66\x72\x6f\x6d\x20\x6e\x6f\x64\x65\x20\x6a\x73\x20\x75\x72\x6c\x20\x70\x61\x72\x73\x65\x72\x20\x64\x6f\x63"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x61\x3a\x62\x40\x68\x6f\x73\x74\x2e\x63\x6f\x6d\x3a\x38\x30\x38\x30\x2f\x70\x2f\x61\x2f\x74\x2f\x68\x3f\x71\x75\x65\x72\x79\x3d\x73\x74\x72\x69\x6e\x67\x23\x68\x61\x73\x68"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PORT) | (1<<UF_PATH) |\
      (1<<UF_QUERY) | (1<<UF_FRAGMENT) | (1<<UF_USERINFO)
    ,.port=8080
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{ 11,  8 } /* UF_HOST */
      ,{ 20,  4 } /* UF_PORT */
      ,{ 24,  8 } /* UF_PATH */
      ,{ 33, 12 } /* UF_QUERY */
      ,{ 46,  4 } /* UF_FRAGMENT */
      ,{  7,  3 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x64\x6f\x75\x62\x6c\x65\x20\x40"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x61\x3a\x62\x40\x40\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x34\x34\x33\x2f"
  ,.is_connect=0
  ,.rv=1
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x65\x6d\x70\x74\x79\x20\x68\x6f\x73\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x3a\x34\x34\x33\x2f"
  ,.is_connect=0
  ,.rv=1
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x65\x6d\x70\x74\x79\x20\x70\x6f\x72\x74"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x2f"
  ,.is_connect=0
  ,.rv=1
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x77\x69\x74\x68\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68"
  ,.url="\x61\x3a\x62\x40\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x34\x34\x33"
  ,.is_connect=1
  ,.rv=1
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x65\x6d\x70\x74\x79\x20\x68\x6f\x73\x74"
  ,.url="\x3a\x34\x34\x33"
  ,.is_connect=1
  ,.rv=1
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x65\x6d\x70\x74\x79\x20\x70\x6f\x72\x74"
  ,.url="\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a"
  ,.is_connect=1
  ,.rv=1
  }

, {.name="\x43\x4f\x4e\x4e\x45\x43\x54\x20\x77\x69\x74\x68\x20\x65\x78\x74\x72\x61\x20\x62\x69\x74\x73"
  ,.url="\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x34\x34\x33\x2f"
  ,.is_connect=1
  ,.rv=1
  }

, {.name="\x73\x70\x61\x63\x65\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\x20\x62\x61\x72\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68\x20\x77\x69\x74\x68\x20\x73\x70\x61\x63\x65\x20\x75\x72\x6c\x20\x65\x6e\x63\x6f\x64\x65\x64"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x61\x25\x32\x30\x3a\x62\x40\x68\x6f\x73\x74\x2e\x63\x6f\x6d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH) | (1<<UF_USERINFO)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{ 14,  8 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 22,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  7,  6 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x63\x61\x72\x72\x69\x61\x67\x65\x20\x72\x65\x74\x75\x72\x6e\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\xdb\x61\x72\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x64\x6f\x75\x62\x6c\x65\x20\x3a\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x6e\x61\x6d\x65\x3a\x3a\x34\x34\x33\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68\x20\x77\x69\x74\x68\x20\x64\x6f\x75\x62\x6c\x65\x20\x3a"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x61\x3a\x3a\x62\x40\x68\x6f\x73\x74\x2e\x63\x6f\x6d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH) | (1<<UF_USERINFO)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{ 12,  8 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 20,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  7,  4 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x6c\x69\x6e\x65\x20\x66\x65\x65\x64\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\xab\x61\x72\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x65\x6d\x70\x74\x79\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x40\x68\x6f\x73\x74\x6e\x61\x6d\x65\x2f\x66\x6f"
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  8,  8 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 16,  3 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }
, {.name="\x70\x72\x6f\x78\x79\x20\x6c\x69\x6e\x65\x20\x66\x65\x65\x64\x20\x69\x6e\x20\x68\x6f\x73\x74\x6e\x61\x6d\x65"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\xaa\x6d\x65\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x6c\x40\x89\x95\x20\x68\x6f\x73\x74\x6e\x61\x6d\x65"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x6c\x95\x81\x6d\x65\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x3b\x20\x69\x6e\x20\x68\x6f\x73\x74\x6e\x61\x6d\x65"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x3b\x61\x6d\x65\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68\x20\x77\x69\x74\x68\x20\x75\x6e\x72\x65\x73\x65\x72\x76\x65\x64\x63\x68\x61\x72\x73"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x61\x21\x3b\x2d\x5f\x21\x3d\x2b\x24\x40\x68\x6f\x73\x74\x2e\x63\x6f\x6d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH) | (1<<UF_USERINFO)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{ 17,  8 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 25,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  7,  9 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x6f\x6e\x6c\x79\x20\x65\x6d\x70\x74\x79\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x40\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x6f\x6e\x6c\x79\x20\x62\x61\x73\x69\x63\x20\x61\x75\x74\x68"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x74\x6f\x74\x6f\x40\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x65\x6d\x74\x70\x79\x20\x68\x6f\x73\x74\x6e\x61\x6d\x65"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x70\x72\x6f\x78\x79\x20\x3d\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x68\x6f\x73\x74\x3d\x61\x6d\x65\x2f\x66\x6f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x69\x70\x76\x36\x20\x61\x64\x64\x72\x65\x73\x73\x20\x77\x69\x74\x68\x20\x5a\x6f\x6e\x65\x20\x49\x44"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x66\x65\x38\x30\x3a\x3a\x61\x6c\xf2\xf5\x85\x74\x68\x30\x5d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  8, 14 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 23,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x69\x70\x76\x36\x20\x61\x64\x64\x72\x65\x73\x73\x20\x77\x69\x74\x68\x20\x5a\x6f\x6e\x65\x20\x49\x44\x2c\x20\x62\x75\x74\x20\x27\x25\x27\x20\x69\x73\x20\x6e\x6f\x74\x20\x70\x65\x72\x63\x65\x6e\x74\x2d\x65\x6e\x63\x6f\x64\x65\x64"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x66\x65\x38\x30\x3a\x3a\x61\x6c\x85\x74\x68\x30\x5d\x2f"
  ,.is_connect=0
  ,.u=
    {.field_set= (1<<UF_SCHEMA) | (1<<UF_HOST) | (1<<UF_PATH)
    ,.port=0
    ,.field_data=
      {{  0,  4 } /* UF_SCHEMA */
      ,{  8, 12 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{ 21,  1 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x69\x70\x76\x36\x20\x61\x64\x64\x72\x65\x73\x73\x20\x65\x6e\x64\x69\x6e\x67\x20\x77\x69\x74\x68\x20\x27\x25\x27"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x66\x65\x38\x30\x3a\x3a\x61\x25\x5d\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x69\x70\x76\x36\x20\x61\x64\x64\x72\x65\x73\x73\x20\x77\x69\x74\x68\x20\x5a\x6f\x6e\x65\x20\x49\x44\x20\x69\x6e\x63\x6c\x75\x64\x69\x6e\x67\x20\x62\x61\x64\x20\x63\x68\x61\x72\x61\x63\x74\x65\x72"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x66\x65\x38\x30\x3a\x3a\x61\x25\x24\x48\x4f\x4d\x45\x5d\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x6a\x75\x73\x74\x20\x69\x70\x76\x36\x20\x5a\x6f\x6e\x65\x20\x49\x44"
  ,.url="\x68\x74\x74\x70\x3a\x2f\x2f\x5b\x6c\x85\x74\x68\x30\x5d\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="empty url"
  ,.url=""
  ,.is_connect=0
  ,.rv=1
  }

, {.name="NULL url"
  ,.url=NULL
  ,.is_connect=0
  ,.rv=1
  }

, {.name="full of spaces url"
  ,.url="  "
  ,.is_connect=0
  ,.rv=1
  }

#if HTTP_PARSER_STRICT

, {.name="\x74\x61\x62\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\x9b\x61\x72\x2f"
  ,.rv=1 /* s_dead */
  }

, {.name="\x66\x6f\x72\x6d\x20\x66\x65\x65\x64\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\xcb\x61\x72\x2f"
  ,.rv=1 /* s_dead */
  }

#else /* !HTTP_PARSER_STRICT */

, {.name="\x74\x61\x62\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\x9b\x61\x72\x2f"
  ,.u=
    {.field_set=(1 << UF_PATH)
    ,.field_data=
      {{  0,  0 } /* UF_SCHEMA */
      ,{  0,  0 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{  0,  9 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }

, {.name="\x66\x6f\x72\x6d\x20\x66\x65\x65\x64\x20\x69\x6e\x20\x55\x52\x4c"
  ,.url="\x2f\x66\x6f\x6f\xcb\x61\x72\x2f"
  ,.u=
    {.field_set=(1 << UF_PATH)
    ,.field_data=
      {{  0,  0 } /* UF_SCHEMA */
      ,{  0,  0 } /* UF_HOST */
      ,{  0,  0 } /* UF_PORT */
      ,{  0,  9 } /* UF_PATH */
      ,{  0,  0 } /* UF_QUERY */
      ,{  0,  0 } /* UF_FRAGMENT */
      ,{  0,  0 } /* UF_USERINFO */
      }
    }
  ,.rv=0
  }
#endif
};

void
dump_url (const char *url, const struct http_parser_url *u)
{
  unsigned int i;

  printf("\tfield_set: 0x%x, port: %u\n", u->field_set, u->port);
  for (i = 0; i < UF_MAX; i++) {
    if ((u->field_set & (1 << i)) == 0) {
      printf("\tfield_data[%u]: unset\n", i);
      continue;
    }

    printf("\tfield_data[%u]: off: %u len: %u part: \"%.*s\n\"",
           i,
           u->field_data[i].off,
           u->field_data[i].len,
           u->field_data[i].len,
           url + u->field_data[i].off);
  }
}

void
test_parse_url (void)
{
  struct http_parser_url u;
  const struct url_test *test;
  unsigned int i;
  int rv;

  for (i = 0; i < (sizeof(url_tests) / sizeof(url_tests[0])); i++) {
    test = &url_tests[i];
    memset(&u, 0, sizeof(u));

    rv = http_parser_parse_url(test->url,
                               test->url ? strlen(test->url) : 0,
                               test->is_connect,
                               &u);

    if (test->rv == 0) {
      if (rv != 0) {
        printf("\n*** http_parser_parse_url(\"%s\") \"%s\" test failed, "
               "\x75\x6e\x65\x78\x70\x65\x63\x74\x65\x64\x20\x72\x76\x20\x6c\x84\x20\x2a\x2a\x2a\xa\xa", test->url, test->name, rv);
        abort();
      }

      if (memcmp(&u, &test->u, sizeof(u)) != 0) {
        printf("\n*** http_parser_parse_url(\"%s\") \"%s\" failed ***\n",
               test->url, test->name);

        printf("target http_parser_url:\n");
        dump_url(test->url, &test->u);
        printf("result http_parser_url:\n");
        dump_url(test->url, &u);

        abort();
      }
    } else {
      /* test->rv != 0 */
      if (rv == 0) {
        printf("\n*** http_parser_parse_url(\"%s\") \"%s\" test failed, "
               "\x75\x6e\x65\x78\x70\x65\x63\x74\x65\x64\x20\x72\x76\x20\x6c\x84\x20\x2a\x2a\x2a\xa\xa", test->url, test->name, rv);
        abort();
      }
    }
  }
}

void
test_method_str (void)
{
  assert(0 == strcmp("\x47\x45\x54", http_method_str(HTTP_GET)));
  assert(0 == strcmp("\x3c\x75\x6e\x6b\x6e\x6f\x77\x6e\x3e", http_method_str(1337)));
}

void
test_status_str (void)
{
  assert(0 == strcmp("OK", http_status_str(HTTP_STATUS_OK)));
  assert(0 == strcmp("Not Found", http_status_str(HTTP_STATUS_NOT_FOUND)));
  assert(0 == strcmp("<unknown>", http_status_str(1337)));
}

void
test_message (const struct message *message)
{
  size_t raw_len = strlen(message->raw);
  size_t msg1len;
  for (msg1len = 0; msg1len < raw_len; msg1len++) {
    parser_init(message->type);

    size_t read;
    const char *msg1 = message->raw;
    const char *msg2 = msg1 + msg1len;
    size_t msg2len = raw_len - msg1len;

    if (msg1len) {
      assert(num_messages == 0);
      messages[0].headers_complete_cb_called = FALSE;

      read = parse(msg1, msg1len);

      if (!messages[0].headers_complete_cb_called && parser.nread != read) {
        assert(parser.nread == read);
        print_error(msg1, read);
        abort();
      }

      if (message->upgrade && parser.upgrade && num_messages > 0) {
        messages[num_messages - 1].upgrade = msg1 + read;
        goto test;
      }

      if (read != msg1len) {
        print_error(msg1, read);
        abort();
      }
    }


    read = parse(msg2, msg2len);

    if (message->upgrade && parser.upgrade) {
      messages[num_messages - 1].upgrade = msg2 + read;
      goto test;
    }

    if (read != msg2len) {
      print_error(msg2, read);
      abort();
    }

    read = parse(NULL, 0);

    if (read != 0) {
      print_error(message->raw, read);
      abort();
    }

  test:

    if (num_messages != 1) {
      printf("\n*** num_messages != 1 after testing '%s' ***\n\n", message->name);
      abort();
    }

    if(!message_eq(0, 0, message)) abort();
  }
}

void
test_message_count_body (const struct message *message)
{
  parser_init(message->type);

  size_t read;
  size_t l = strlen(message->raw);
  size_t i, toread;
  size_t chunk = 4024;

  for (i = 0; i < l; i+= chunk) {
    toread = MIN(l-i, chunk);
    read = parse_count_body(message->raw + i, toread);
    if (read != toread) {
      print_error(message->raw, read);
      abort();
    }
  }


  read = parse_count_body(NULL, 0);
  if (read != 0) {
    print_error(message->raw, read);
    abort();
  }

  if (num_messages != 1) {
    printf("\n*** num_messages != 1 after testing '%s' ***\n\n", message->name);
    abort();
  }

  if(!message_eq(0, 0, message)) abort();
}

void
test_simple_type (const char *buf,
                  enum http_errno err_expected,
                  enum http_parser_type type)
{
  parser_init(type);

  enum http_errno err;

  parse(buf, strlen(buf));
  err = HTTP_PARSER_ERRNO(&parser);
  parse(NULL, 0);

  /* In strict mode, allow us to pass with an unexpected HPE_STRICT as
   * long as the caller isn't expecting success.
   */
#if HTTP_PARSER_STRICT
  if (err_expected != err && err_expected != HPE_OK && err != HPE_STRICT) {
#else
  if (err_expected != err) {
#endif
    fprintf(stderr, "\n*** test_simple expected %s, but saw %s ***\n\n%s\n",
        http_errno_name(err_expected), http_errno_name(err), buf);
    abort();
  }
}

void
test_simple (const char *buf, enum http_errno err_expected)
{
  test_simple_type(buf, err_expected, HTTP_REQUEST);
}

void
test_invalid_header_content (int req, const char* str)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  const char *buf;
  buf = req ?
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa" :
    "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  buf = str;
  size_t buflen = strlen(buf);

  parsed = http_parser_execute(&parser, &settings_null, buf, buflen);
  if (parsed != buflen) {
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_INVALID_HEADER_TOKEN);
    return;
  }

  fprintf(stderr,
          "\xa\x2a\x2a\x2a\x20\x45\x72\x72\x6f\x72\x20\x65\x78\x70\x65\x63\x74\x65\x64\x20\x62\x75\x74\x20\x6e\x6f\x6e\x65\x20\x69\x6e\x20\x69\x6e\x76\x61\x6c\x69\x64\x20\x68\x65\x61\x64\x65\x72\x20\x63\x6f\x6e\x74\x65\x6e\x74\x20\x74\x65\x73\x74\x20\x2a\x2a\x2a\xa");
  abort();
}

void
test_invalid_header_field_content_error (int req)
{
  test_invalid_header_content(req, "\x46\x6f\x6f\x3a\x20\x46\x01\x61\x69\x6c\x75\x72\x65");
  test_invalid_header_content(req, "\x46\x6f\x6f\x3a\x20\x42\x02\x61\x72");
}

void
test_invalid_header_field (int req, const char* str)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  const char *buf;
  buf = req ?
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa" :
    "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  buf = str;
  size_t buflen = strlen(buf);

  parsed = http_parser_execute(&parser, &settings_null, buf, buflen);
  if (parsed != buflen) {
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_INVALID_HEADER_TOKEN);
    return;
  }

  fprintf(stderr,
          "\xa\x2a\x2a\x2a\x20\x45\x72\x72\x6f\x72\x20\x65\x78\x70\x65\x63\x74\x65\x64\x20\x62\x75\x74\x20\x6e\x6f\x6e\x65\x20\x69\x6e\x20\x69\x6e\x76\x61\x6c\x69\x64\x20\x68\x65\x61\x64\x65\x72\x20\x74\x6f\x6b\x65\x6e\x20\x74\x65\x73\x74\x20\x2a\x2a\x2a\xa");
  abort();
}

void
test_invalid_header_field_token_error (int req)
{
  test_invalid_header_field(req, "\x46\x6f\x40\x3a\x20\x46\x61\x69\x6c\x75\x72\x65");
  test_invalid_header_field(req, "\x46\x6f\x6f\x01\x9e\x73\x74\x3a\x20\x42\x61\x72");
}

void
test_double_content_length_error (int req)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  const char *buf;
  buf = req ?
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa" :
    "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  buf = "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x30\xd\xaC\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\xd\xa\xd\xa";
  size_t buflen = strlen(buf);

  parsed = http_parser_execute(&parser, &settings_null, buf, buflen);
  if (parsed != buflen) {
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_UNEXPECTED_CONTENT_LENGTH);
    return;
  }

  fprintf(stderr,
          "\xa\x2a\x2a\x2a\x20\x45\x72\x72\x6f\x72\x20\x65\x78\x70\x65\x63\x74\x65\x64\x20\x62\x75\x74\x20\x6e\x6f\x6e\x65\x20\x69\x6e\x20\x64\x6f\x75\x62\x6c\x65\x20\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x6c\x65\x6e\x67\x74\x68\x20\x74\x65\x73\x74\x20\x2a\x2a\x2a\xa");
  abort();
}

void
test_chunked_content_length_error (int req)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  const char *buf;
  buf = req ?
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa" :
    "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  buf = "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x61\x6e\x79\x74\x68\x69\x6e\x67\xd\xa\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x31\xd\xa\xd\xa";
  size_t buflen = strlen(buf);

  parsed = http_parser_execute(&parser, &settings_null, buf, buflen);
  if (parsed != buflen) {
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_UNEXPECTED_CONTENT_LENGTH);
    return;
  }

  fprintf(stderr,
          "\xa\x2a\x2a\x2a\x20\x45\x72\x72\x6f\x72\x20\x65\x78\x70\x65\x63\x74\x65\x64\x20\x62\x75\x74\x20\x6e\x6f\x6e\x65\x20\x69\x6e\x20\x63\x68\x75\x6e\x6b\x65\x64\x20\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x6c\x65\x6e\x67\x74\x68\x20\x74\x65\x73\x74\x20\x2a\x2a\x2a\xa");
  abort();
}

void
test_header_cr_no_lf_error (int req)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  const char *buf;
  buf = req ?
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa" :
    "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  buf = "\x46\x6f\x6f\x3a\x20\x31\xdB\x61\x72\x3a\x20\x31\xd\xa\xd\xa";
  size_t buflen = strlen(buf);

  parsed = http_parser_execute(&parser, &settings_null, buf, buflen);
  if (parsed != buflen) {
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_LF_EXPECTED);
    return;
  }

  fprintf(stderr,
          "\xa\x2a\x2a\x2a\x20\x45\x72\x72\x6f\x72\x20\x65\x78\x70\x65\x63\x74\x65\x64\x20\x62\x75\x74\x20\x6e\x6f\x6e\x65\x20\x69\x6e\x20\x68\x65\x61\x64\x65\x72\x20\x77\x68\x69\x74\x65\x73\x70\x61\x63\x65\x20\x74\x65\x73\x74\x20\x2a\x2a\x2a\xa");
  abort();
}

void
test_no_overflow_parse_url (void)
{
  int rv;
  struct http_parser_url u;

  http_parser_url_init(&u);
  rv = http_parser_parse_url("http://example.com:8001", 22, 0, &u);

  if (rv != 0) {
    fprintf(stderr,
            "\n*** test_no_overflow_parse_url invalid return value=%d\n",
            rv);
    abort();
  }

  if (u.port != 800) {
    fprintf(stderr,
            "\n*** test_no_overflow_parse_url invalid port number=%d\n",
            u.port);
    abort();
  }
}

void
test_header_overflow_error (int req)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  const char *buf;
  buf = req ? "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa" : "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x32\x30\x30\x20\x4f\x4b\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  buf = "\x68\x65\x61\x64\x65\x72\x2d\x6b\x65\x79\x3a\x20\x68\x65\x61\x64\x65\x72\x2d\x76\x61\x6c\x75\x65\xd\xa";
  size_t buflen = strlen(buf);

  int i;
  for (i = 0; i < 10000; i++) {
    parsed = http_parser_execute(&parser, &settings_null, buf, buflen);
    if (parsed != buflen) {
      //fprintf(stderr, "error found on iter %d\n", i);
      assert(HTTP_PARSER_ERRNO(&parser) == HPE_HEADER_OVERFLOW);
      return;
    }
  }

  fprintf(stderr, "\n*** Error expected but none in header overflow test ***\n");
  abort();
}


void
test_header_nread_value ()
{
  http_parser parser;
  http_parser_init(&parser, HTTP_REQUEST);
  size_t parsed;
  const char *buf;
  buf = "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa\x68\x65\x61\x64\x65\x72\x3a\x20\x76\x61\x6c\x75\x65\xa\x68\x64\x72\x3a\x20\x76\x61\x6c\x75\x65\xd\xa";
  parsed = http_parser_execute(&parser, &settings_null, buf, strlen(buf));
  assert(parsed == strlen(buf));

  assert(parser.nread == strlen(buf));
}


static void
test_content_length_overflow (const char *buf, size_t buflen, int expect_ok)
{
  http_parser parser;
  http_parser_init(&parser, HTTP_RESPONSE);
  http_parser_execute(&parser, &settings_null, buf, buflen);

  if (expect_ok)
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_OK);
  else
    assert(HTTP_PARSER_ERRNO(&parser) == HPE_INVALID_CONTENT_LENGTH);
}

void
test_header_content_length_overflow_error (void)
{
#define X(size)                                                               \
  "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"                                                       \
  "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20"  USTR(#size) "\xd\xa"                                             \
  "\xd\xa"
  const char a[] = X(1844674407370955160);  /* 2^64 / 10 - 1 */
  const char b[] = X(18446744073709551615); /* 2^64-1 */
  const char c[] = X(18446744073709551616); /* 2^64   */
#undef X
  test_content_length_overflow(a, sizeof(a) - 1, 1); /* expect ok      */
  test_content_length_overflow(b, sizeof(b) - 1, 0); /* expect failure */
  test_content_length_overflow(c, sizeof(c) - 1, 0); /* expect failure */
}

void
test_chunk_content_length_overflow_error (void)
{
#define X(size)                                                               \
    "\x48\x54\x54\x50\x2f\x31\x2e\x31\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"                                                     \
    "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"                                          \
    "\xd\xa"                                                                    \
     USTR(#size) "\xd\xa"                                                              \
    "\x2e\x2e\x2e"
  const char a[] = X(FFFFFFFFFFFFFFE);   /* 2^64 / 16 - 1 */
  const char b[] = X(FFFFFFFFFFFFFFFF);  /* 2^64-1 */
  const char c[] = X(10000000000000000); /* 2^64   */
#undef X
  test_content_length_overflow(a, sizeof(a) - 1, 1); /* expect ok      */
  test_content_length_overflow(b, sizeof(b) - 1, 0); /* expect failure */
  test_content_length_overflow(c, sizeof(c) - 1, 0); /* expect failure */
}

void
test_no_overflow_long_body (int req, size_t length)
{
  http_parser parser;
  http_parser_init(&parser, req ? HTTP_REQUEST : HTTP_RESPONSE);
  size_t parsed;
  size_t i;
  char buf1[3000];
  size_t buf1len = sprintf(buf1, "%s\r\nConnection: Keep-Alive\r\nContent-Length: %lu\r\n\r\n",
      req ? "\x50\x4f\x53\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x30" : "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x32\x30\x30\x20\x4f\x4b", (unsigned long)length);
  parsed = http_parser_execute(&parser, &settings_null, buf1, buf1len);
  if (parsed != buf1len)
    goto err;

  for (i = 0; i < length; i++) {
    char foo = '\x61';
    parsed = http_parser_execute(&parser, &settings_null, &foo, 1);
    if (parsed != 1)
      goto err;
  }

  parsed = http_parser_execute(&parser, &settings_null, buf1, buf1len);
  if (parsed != buf1len) goto err;
  return;

 err:
  fprintf(stderr,
          "\xa\x2a\x2a\x2a\x20\x65\x72\x72\x6f\x72\x20\x69\x6e\x20\x74\x65\x73\x74\x5f\x6e\x6f\x5f\x6f\x76\x65\x72\x66\x6c\x6f\x77\x5f\x6c\x6f\x6e\x67\x5f\x62\x6f\x64\x79\x20\x6c\xa2\x20\x6f\x66\x20\x6c\x65\x6e\x67\x74\x68\x20\x6c\x93\xa4\x20\x2a\x2a\x2a\xa",
          req ? "\x52\x45\x51\x55\x45\x53\x54" : "\x52\x45\x53\x50\x4f\x4e\x53\x45",
          (unsigned long)length);
  abort();
}

void
test_multiple3 (const struct message *r1, const struct message *r2, const struct message *r3)
{
  int message_count = count_parsed_messages(3, r1, r2, r3);

  char total[ strlen(r1->raw)
            + strlen(r2->raw)
            + strlen(r3->raw)
            + 1
            ];
  total[0] = '\x0';

  strcat(total, r1->raw);
  strcat(total, r2->raw);
  strcat(total, r3->raw);

  parser_init(r1->type);

  size_t read;

  read = parse(total, strlen(total));

  if (parser.upgrade) {
    upgrade_message_fix(total, read, 3, r1, r2, r3);
    goto test;
  }

  if (read != strlen(total)) {
    print_error(total, read);
    abort();
  }

  read = parse(NULL, 0);

  if (read != 0) {
    print_error(total, read);
    abort();
  }

test:

  if (message_count != num_messages) {
    fprintf(stderr, "\n\n*** Parser didn't see 3 messages only %d *** \n", num_messages);
    abort();
  }

  if (!message_eq(0, 0, r1)) abort();
  if (message_count > 1 && !message_eq(1, 0, r2)) abort();
  if (message_count > 2 && !message_eq(2, 0, r3)) abort();
}

/* SCAN through every possible breaking to make sure the
 * parser can handle getting the content in any chunks that
 * might come from the socket
 */
void
test_scan (const struct message *r1, const struct message *r2, const struct message *r3)
{
  char total[80*1024] = "\x0";
  char buf1[80*1024] = "\x0";
  char buf2[80*1024] = "\x0";
  char buf3[80*1024] = "\x0";

  strcat(total, r1->raw);
  strcat(total, r2->raw);
  strcat(total, r3->raw);

  size_t read;

  int total_len = strlen(total);

  int total_ops = 2 * (total_len - 1) * (total_len - 2) / 2;
  int ops = 0 ;

  size_t buf1_len, buf2_len, buf3_len;
  int message_count = count_parsed_messages(3, r1, r2, r3);

  int i,j,type_both;
  for (type_both = 0; type_both < 2; type_both ++ ) {
    for (j = 2; j < total_len; j ++ ) {
      for (i = 1; i < j; i ++ ) {

        if (ops % 1000 == 0)  {
          printf("\b\b\b\b%3.0f%%", 100 * (float)ops /(float)total_ops);
          fflush(stdout);
        }
        ops += 1;

        parser_init(type_both ? HTTP_BOTH : r1->type);

        buf1_len = i;
        strlncpy(buf1, sizeof(buf1), total, buf1_len);
        buf1[buf1_len] = 0;

        buf2_len = j - i;
        strlncpy(buf2, sizeof(buf1), total+i, buf2_len);
        buf2[buf2_len] = 0;

        buf3_len = total_len - j;
        strlncpy(buf3, sizeof(buf1), total+j, buf3_len);
        buf3[buf3_len] = 0;

        assert(num_messages == 0);
        messages[0].headers_complete_cb_called = FALSE;

        read = parse(buf1, buf1_len);

        if (!messages[0].headers_complete_cb_called && parser.nread != read) {
          print_error(buf1, read);
          goto error;
        }

        if (parser.upgrade) goto test;

        if (read != buf1_len) {
          print_error(buf1, read);
          goto error;
        }

        read += parse(buf2, buf2_len);

        if (parser.upgrade) goto test;

        if (read != buf1_len + buf2_len) {
          print_error(buf2, read);
          goto error;
        }

        read += parse(buf3, buf3_len);

        if (parser.upgrade) goto test;

        if (read != buf1_len + buf2_len + buf3_len) {
          print_error(buf3, read);
          goto error;
        }

        parse(NULL, 0);

test:
        if (parser.upgrade) {
          upgrade_message_fix(total, read, 3, r1, r2, r3);
        }

        if (message_count != num_messages) {
          fprintf(stderr, "\n\nParser didn't see %d messages only %d\n",
            message_count, num_messages);
          goto error;
        }

        if (!message_eq(0, 0, r1)) {
          fprintf(stderr, "\n\nError matching messages[0] in test_scan.\n");
          goto error;
        }

        if (message_count > 1 && !message_eq(1, 0, r2)) {
          fprintf(stderr, "\n\nError matching messages[1] in test_scan.\n");
          goto error;
        }

        if (message_count > 2 && !message_eq(2, 0, r3)) {
          fprintf(stderr, "\n\nError matching messages[2] in test_scan.\n");
          goto error;
        }
      }
    }
  }
  puts("\x8\x8\x8\x81\x30\x30\x25");
  return;

 error:
  fprintf(stderr, "i=%d  j=%d\n", i, j);
  fprintf(stderr, "buf1 (%u) %s\n\n", (unsigned int)buf1_len, buf1);
  fprintf(stderr, "buf2 (%u) %s\n\n", (unsigned int)buf2_len , buf2);
  fprintf(stderr, "buf3 (%u) %s\n", (unsigned int)buf3_len, buf3);
  abort();
}

// user required to free the result
// string terminated by \0
char *
create_large_chunked_message (int body_size_in_kb, const char* headers)
{
  int i;
  size_t wrote = 0;
  size_t headers_len = strlen(headers);
  size_t bufsize = headers_len + (5+1024+2)*body_size_in_kb + 6;
  char * buf = malloc(bufsize);

  memcpy(buf, headers, headers_len);
  wrote += headers_len;

  for (i = 0; i < body_size_in_kb; i++) {
    // write 1kb chunk into the body.
    memcpy(buf + wrote, "\x34\x30\x30\xd\xa", 5);
    wrote += 5;
    memset(buf + wrote, '\x43', 1024);
    wrote += 1024;
    strcpy(buf + wrote, "\xd\xa");
    wrote += 2;
  }

  memcpy(buf + wrote, "\x30\xd\xa\xd\xa", 6);
  wrote += 6;
  assert(wrote == bufsize);

  return buf;
}

/* Verify that we can pause parsing at any of the bytes in the
 * message and still get the result that we're expecting. */
void
test_message_pause (const struct message *msg)
{
  char *buf = (char*) msg->raw;
  size_t buflen = strlen(msg->raw);
  size_t nread;

  parser_init(msg->type);

  do {
    nread = parse_pause(buf, buflen);

    // We can only set the upgrade buffer once we've gotten our message
    // completion callback.
    if (messages[0].message_complete_cb_called &&
        msg->upgrade &&
        parser.upgrade) {
      messages[0].upgrade = buf + nread;
      goto test;
    }

    if (nread < buflen) {

      // Not much do to if we failed a strict-mode check
      if (HTTP_PARSER_ERRNO(&parser) == HPE_STRICT) {
        return;
      }

      assert (HTTP_PARSER_ERRNO(&parser) == HPE_PAUSED);
    }

    buf += nread;
    buflen -= nread;
    http_parser_pause(&parser, 0);
  } while (buflen > 0);

  nread = parse_pause(NULL, 0);
  assert (nread == 0);

test:
  if (num_messages != 1) {
    printf("\n*** num_messages != 1 after testing '%s' ***\n\n", msg->name);
    abort();
  }

  if(!message_eq(0, 0, msg)) abort();
}

/* Verify that body and next message won't be parsed in responses to CONNECT */
void
test_message_connect (const struct message *msg)
{
  char *buf = (char*) msg->raw;
  size_t buflen = strlen(msg->raw);

  parser_init(msg->type);

  parse_connect(buf, buflen);

  if (num_messages != 1) {
    printf("\n*** num_messages != 1 after testing '%s' ***\n\n", msg->name);
    abort();
  }

  if(!message_eq(0, 1, msg)) abort();
}

int
main (void)
{
  unsigned i, j, k;
  unsigned long version;
  unsigned major;
  unsigned minor;
  unsigned patch;

  version = http_parser_version();
  major = (version >> 16) & 255;
  minor = (version >> 8) & 255;
  patch = version & 255;
  printf("http_parser v%u.%u.%u (0x%06lx)\n", major, minor, patch, version);

  printf("sizeof(http_parser) = %u\n", (unsigned int)sizeof(http_parser));

  //// API
  test_preserve_data();
  test_parse_url();
  test_method_str();
  test_status_str();

  //// NREAD
  test_header_nread_value();

  //// OVERFLOW CONDITIONS
  test_no_overflow_parse_url();

  test_header_overflow_error(HTTP_REQUEST);
  test_no_overflow_long_body(HTTP_REQUEST, 1000);
  test_no_overflow_long_body(HTTP_REQUEST, 100000);

  test_header_overflow_error(HTTP_RESPONSE);
  test_no_overflow_long_body(HTTP_RESPONSE, 1000);
  test_no_overflow_long_body(HTTP_RESPONSE, 100000);

  test_header_content_length_overflow_error();
  test_chunk_content_length_overflow_error();

  //// HEADER FIELD CONDITIONS
  test_double_content_length_error(HTTP_REQUEST);
  test_chunked_content_length_error(HTTP_REQUEST);
  test_header_cr_no_lf_error(HTTP_REQUEST);
  test_invalid_header_field_token_error(HTTP_REQUEST);
  test_invalid_header_field_content_error(HTTP_REQUEST);
  test_double_content_length_error(HTTP_RESPONSE);
  test_chunked_content_length_error(HTTP_RESPONSE);
  test_header_cr_no_lf_error(HTTP_RESPONSE);
  test_invalid_header_field_token_error(HTTP_RESPONSE);
  test_invalid_header_field_content_error(HTTP_RESPONSE);

  test_simple_type(
      "POST / HTTP/1.1\r\n"
      "Content-Length:\r\n"  // empty
      "\r\n",
      HPE_INVALID_CONTENT_LENGTH,
      HTTP_REQUEST);

  test_simple_type(
      "POST / HTTP/1.1\r\n"
      "Content-Length:  42 \r\n"  // Note the surrounding whitespace.
      "\r\n",
      HPE_OK,
      HTTP_REQUEST);

  test_simple_type(
      "POST / HTTP/1.1\r\n"
      "Content-Length: 4 2\r\n"
      "\r\n",
      HPE_INVALID_CONTENT_LENGTH,
      HTTP_REQUEST);

  test_simple_type(
      "POST / HTTP/1.1\r\n"
      "Content-Length: 13 37\r\n"
      "\r\n",
      HPE_INVALID_CONTENT_LENGTH,
      HTTP_REQUEST);

  test_simple_type(
      "POST / HTTP/1.1\r\n"
      "Content-Length:  42\r\n"
      " Hello world!\r\n",
      HPE_INVALID_CONTENT_LENGTH,
      HTTP_REQUEST);

  test_simple_type(
      "POST / HTTP/1.1\r\n"
      "Content-Length:  42\r\n"
      " \r\n",
      HPE_OK,
      HTTP_REQUEST);

  //// RESPONSES

  test_simple_type("HTP/1.1 200 OK\r\n\r\n", HPE_INVALID_VERSION, HTTP_RESPONSE);
  test_simple_type("HTTP/01.1 200 OK\r\n\r\n", HPE_INVALID_VERSION, HTTP_RESPONSE);
  test_simple_type("HTTP/11.1 200 OK\r\n\r\n", HPE_INVALID_VERSION, HTTP_RESPONSE);
  test_simple_type("HTTP/1.01 200 OK\r\n\r\n", HPE_INVALID_VERSION, HTTP_RESPONSE);
  test_simple_type("HTTP/1.1\t200 OK\r\n\r\n", HPE_INVALID_VERSION, HTTP_RESPONSE);
  test_simple_type("\rHTTP/1.1\t200 OK\r\n\r\n", HPE_INVALID_VERSION, HTTP_RESPONSE);

  for (i = 0; i < ARRAY_SIZE(responses); i++) {
    test_message(&responses[i]);
  }

  for (i = 0; i < ARRAY_SIZE(responses); i++) {
    test_message_pause(&responses[i]);
  }

  for (i = 0; i < ARRAY_SIZE(responses); i++) {
    test_message_connect(&responses[i]);
  }

  for (i = 0; i < ARRAY_SIZE(responses); i++) {
    if (!responses[i].should_keep_alive) continue;
    for (j = 0; j < ARRAY_SIZE(responses); j++) {
      if (!responses[j].should_keep_alive) continue;
      for (k = 0; k < ARRAY_SIZE(responses); k++) {
        test_multiple3(&responses[i], &responses[j], &responses[k]);
      }
    }
  }

  test_message_count_body(&responses[NO_HEADERS_NO_BODY_404]);
  test_message_count_body(&responses[TRAILING_SPACE_ON_CHUNKED_BODY]);

  // test very large chunked response
  {
    char * msg = create_large_chunked_message(31337,
      "\x48\x54\x54\x50\x2f\x31\x2e\x30\x20\x32\x30\x30\x20\x4f\x4b\xd\xa"
      "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x63\x68\x75\x6e\x6b\x65\x64\xd\xa"
      "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e\xd\xa"
      "\xd\xa");
    struct message large_chunked =
      {.name= "\x6c\x61\x72\x67\x65\x20\x63\x68\x75\x6e\x6b\x65\x64"
      ,.type= HTTP_RESPONSE
      ,.raw= msg
      ,.should_keep_alive= FALSE
      ,.message_complete_on_eof= FALSE
      ,.http_major= 1
      ,.http_minor= 0
      ,.status_code= 200
      ,.response_status= "\x4f\x4b"
      ,.num_headers= 2
      ,.headers=
        { { "\x54\x72\x61\x6e\x73\x66\x65\x72\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67", "\x63\x68\x75\x6e\x6b\x65\x64" }
        , { "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65", "\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e" }
        }
      ,.body_size= 31337*1024
      ,.num_chunks_complete= 31338
      };
    for (i = 0; i < MAX_CHUNKS; i++) {
      large_chunked.chunk_lengths[i] = 1024;
    }
    test_message_count_body(&large_chunked);
    free(msg);
  }



  printf("response scan 1/2      ");
  test_scan( &responses[TRAILING_SPACE_ON_CHUNKED_BODY]
           , &responses[NO_BODY_HTTP10_KA_204]
           , &responses[NO_REASON_PHRASE]
           );

  printf("response scan 2/2      ");
  test_scan( &responses[BONJOUR_MADAME_FR]
           , &responses[UNDERSTORE_HEADER_KEY]
           , &responses[NO_CARRIAGE_RET]
           );

  puts("\x72\x65\x73\x70\x6f\x6e\x73\x65\x73\x20\x6f\x6b\x61\x79");


  /// REQUESTS

  test_simple(u8"GET / IHTTP/1.0\r\n\r\n", HPE_INVALID_CONSTANT);
  test_simple(u8"GET / ICE/1.0\r\n\r\n", HPE_INVALID_CONSTANT);
  test_simple(u8"GET / HTP/1.1\r\n\r\n", HPE_INVALID_VERSION);
  test_simple(u8"GET / HTTP/01.1\r\n\r\n", HPE_INVALID_VERSION);
  test_simple(u8"GET / HTTP/11.1\r\n\r\n", HPE_INVALID_VERSION);
  test_simple(u8"GET / HTTP/1.01\r\n\r\n", HPE_INVALID_VERSION);

  test_simple("GET / HTTP/1.0\r\nHello: w\1rld\r\n\r\n", HPE_INVALID_HEADER_TOKEN);
  test_simple("GET / HTTP/1.0\r\nHello: woooo\2rld\r\n\r\n", HPE_INVALID_HEADER_TOKEN);

  // Extended characters - see nodejs/test/parallel/test-http-headers-obstext.js
  test_simple("\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
              "\x54\x65\x73\x74\x3a\x20\x44\xff\xff\x73\x73\x65\x6c\x64\x6f\x72\x66\xd\xa",
              HPE_OK);

  // Well-formed but incomplete
  test_simple("\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
              "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65\x3a\x20\x74\x65\x78\x74\x2f\x70\x6c\x61\x69\x6e\xd\xa"
              "\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x4c\x65\x6e\x67\x74\x68\x3a\x20\x36\xd\xa"
              "\xd\xa"
              "\x66\x6f\x6f\x62\x61",
              HPE_OK);

  // Unknown Transfer-Encoding in request
  test_simple("GET / HTTP/1.1\r\n"
              "Transfer-Encoding: unknown\r\n"
              "\r\n",
              HPE_INVALID_TRANSFER_ENCODING);

  static const char *all_methods[] = {
    "\x44\x45\x4c\x45\x54\x45",
    "\x47\x45\x54",
    "\x48\x45\x41\x44",
    "\x50\x4f\x53\x54",
    "\x50\x55\x54",
    //"CONNECT", //CONNECT can't be tested like other methods, it's a tunnel
    "\x4f\x50\x54\x49\x4f\x4e\x53",
    "\x54\x52\x41\x43\x45",
    "\x43\x4f\x50\x59",
    "\x4c\x4f\x43\x4b",
    "\x4d\x4b\x43\x4f\x4c",
    "\x4d\x4f\x56\x45",
    "\x50\x52\x4f\x50\x46\x49\x4e\x44",
    "\x50\x52\x4f\x50\x50\x41\x54\x43\x48",
    "\x53\x45\x41\x52\x43\x48",
    "\x55\x4e\x4c\x4f\x43\x4b",
    "\x42\x49\x4e\x44",
    "\x52\x45\x42\x49\x4e\x44",
    "\x55\x4e\x42\x49\x4e\x44",
    "\x41\x43\x4c",
    "\x52\x45\x50\x4f\x52\x54",
    "\x4d\x4b\x41\x43\x54\x49\x56\x49\x54\x59",
    "\x43\x48\x45\x43\x4b\x4f\x55\x54",
    "\x4d\x45\x52\x47\x45",
    "\x4d\x2d\x53\x45\x41\x52\x43\x48",
    "\x4e\x4f\x54\x49\x46\x59",
    "\x53\x55\x42\x53\x43\x52\x49\x42\x45",
    "\x55\x4e\x53\x55\x42\x53\x43\x52\x49\x42\x45",
    "\x50\x41\x54\x43\x48",
    "\x50\x55\x52\x47\x45",
    "\x4d\x4b\x43\x41\x4c\x45\x4e\x44\x41\x52",
    "\x4c\x49\x4e\x4b",
    "\x55\x4e\x4c\x49\x4e\x4b",
    0 };
  const char **this_method;
  for (this_method = all_methods; *this_method; this_method++) {
    char buf[200];
    sprintf(buf, "%s / HTTP/1.1\r\n\r\n", *this_method);
    test_simple(buf, HPE_OK);
  }

  static const char *bad_methods[] = {
      "\x41\x53\x44\x46",
      "\x43\x2a\x2a\x2a\x2a\x2a\x2a",
      "\x43\x4f\x4c\x41",
      "\x47\x45\x4d",
      "\x47\x45\x54\x41",
      "\x4d\x2a\x2a\x2a\x2a",
      "\x4d\x4b\x43\x4f\x4c\x41",
      "\x50\x52\x4f\x50\x50\x41\x54\x43\x48\x41",
      "\x50\x55\x4e",
      "\x50\x58",
      "\x53\x41",
      "\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64",
      0 };
  for (this_method = bad_methods; *this_method; this_method++) {
    char buf[200];
    sprintf(buf, "%s / HTTP/1.1\r\n\r\n", *this_method);
    test_simple(buf, HPE_INVALID_METHOD);
  }

  // illegal header field name line folding
  test_simple("\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
              "\x6e\x61\x6d\x65\xd\xa"
              "\x20\x3a\x20\x76\x61\x6c\x75\x65\xd\xa"
              "\xd\xa",
              HPE_INVALID_HEADER_TOKEN);

  const char *dumbluck2 =
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
    "\x58\x2d\x53\x53\x4c\x2d\x4e\x6f\x6e\x73\x65\x6e\x73\x65\x3a\x20\x20\x20\x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x43\x45\x52\x54\x49\x46\x49\x43\x41\x54\x45\x2d\x2d\x2d\x2d\x2d\xd\xa"
    "\x9\x4d\x49\x49\x46\x62\x54\x43\x43\x42\x46\x57\x67\x41\x77\x49\x42\x41\x67\x49\x43\x48\x34\x63\x77\x44\x51\x59\x4a\x4b\x6f\x5a\x49\x68\x76\x63\x4e\x41\x51\x45\x46\x42\x51\x41\x77\x63\x44\x45\x4c\x4d\x41\x6b\x47\x41\x31\x55\x45\x42\x68\x4d\x43\x56\x55\x73\x78\xd\xa"
    "\x9\x45\x54\x41\x50\x42\x67\x4e\x56\x42\x41\x6f\x54\x43\x47\x56\x54\x59\x32\x6c\x6c\x62\x6d\x4e\x6c\x4d\x52\x49\x77\x45\x41\x59\x44\x56\x51\x51\x4c\x45\x77\x6c\x42\x64\x58\x52\x6f\x62\x33\x4a\x70\x64\x48\x6b\x78\x43\x7a\x41\x4a\x42\x67\x4e\x56\x42\x41\x4d\x54\xd\xa"
    "\x9\x41\x6b\x4e\x42\x4d\x53\x30\x77\x4b\x77\x59\x4a\x4b\x6f\x5a\x49\x68\x76\x63\x4e\x41\x51\x6b\x42\x46\x68\x35\x6a\x59\x53\x31\x76\x63\x47\x56\x79\x59\x58\x52\x76\x63\x6b\x42\x6e\x63\x6d\x6c\x6b\x4c\x58\x4e\x31\x63\x48\x42\x76\x63\x6e\x51\x75\x59\x57\x4d\x75\xd\xa"
    "\x9\x64\x57\x73\x77\x48\x68\x63\x4e\x4d\x44\x59\x77\x4e\x7a\x49\x33\x4d\x54\x51\x78\x4d\x7a\x49\x34\x57\x68\x63\x4e\x4d\x44\x63\x77\x4e\x7a\x49\x33\x4d\x54\x51\x78\x4d\x7a\x49\x34\x57\x6a\x42\x62\x4d\x51\x73\x77\x43\x51\x59\x44\x56\x51\x51\x47\x45\x77\x4a\x56\xd\xa"
    "\x9\x53\x7a\x45\x52\x4d\x41\x38\x47\x41\x31\x55\x45\x43\x68\x4d\x49\x5a\x56\x4e\x6a\x61\x57\x56\x75\x59\x32\x55\x78\x45\x7a\x41\x52\x42\x67\x4e\x56\x42\x41\x73\x54\x43\x6b\x31\x68\x62\x6d\x4e\x6f\x5a\x58\x4e\x30\x5a\x58\x49\x78\x43\x7a\x41\x4a\x42\x67\x4e\x56\xd\xa"
    "\x9\x42\x41\x63\x54\x6d\x72\x73\x6f\x67\x72\x69\x71\x4d\x57\x4c\x41\x6b\x31\x44\x4d\x52\x63\x77\x46\x51\x59\x44\x56\x51\x51\x44\x45\x77\x35\x74\x61\x57\x4e\x6f\x59\x57\x56\x73\x49\x48\x42\x68\x63\x6d\x51\x59\x4a\x4b\x6f\x5a\x49\x68\x76\x63\x4e\x41\x51\x45\x42\xd\xa"
    "\x9\x42\x51\x41\x44\x67\x67\x45\x50\x41\x44\x43\x43\x41\x51\x6f\x43\x67\x67\x45\x42\x41\x4e\x50\x45\x51\x42\x67\x6c\x31\x49\x61\x4b\x64\x53\x53\x31\x54\x62\x68\x46\x33\x68\x45\x58\x53\x6c\x37\x32\x47\x39\x4a\x2b\x57\x43\x2f\x31\x52\x36\x34\x66\x41\x63\x45\x46\xd\xa"
    "\x9\x57\x35\x31\x72\x45\x79\x46\x59\x69\x49\x65\x5a\x47\x78\x2f\x42\x56\x7a\x77\x58\x62\x65\x42\x6f\x4e\x55\x4b\x34\x31\x4f\x4b\x36\x35\x73\x78\x47\x75\x66\x6c\x4d\x6f\x35\x67\x4c\x66\x6c\x62\x77\x4a\x74\x48\x42\x52\x49\x45\x4b\x41\x66\x56\x56\x70\x33\x59\x52\xd\xa"
    "\x9\x67\x57\x37\x63\x4d\x41\x2f\x73\x2f\x58\x4b\x67\x4c\x31\x47\x45\x43\x37\x72\x51\x77\x38\x6c\x49\x5a\x54\x38\x52\x41\x70\x75\x6b\x43\x47\x71\x4f\x56\x48\x53\x69\x2f\x46\x31\x53\x69\x46\x6c\x50\x44\x78\x75\x44\x66\x6d\x64\x69\x4e\x7a\x4c\x33\x31\x2b\x73\x4c\xd\xa"
    "\x9\x30\x69\x77\x48\x44\x64\x4e\x6b\x47\x6a\x79\x35\x70\x79\x42\x53\x42\x38\x59\x37\x39\x64\x73\x53\x4a\x74\x43\x57\x2f\x69\x61\x4c\x42\x30\x2f\x6e\x38\x53\x6a\x37\x48\x67\x76\x76\x5a\x4a\x37\x78\x30\x66\x72\x2b\x52\x51\x6a\x59\x4f\x55\x55\x66\x72\x65\x50\x50\xd\xa"
    "\x9\x75\x32\x4d\x53\x70\x46\x79\x66\x2b\x39\x42\x62\x43\x2f\x61\x58\x67\x61\x5a\x75\x69\x43\x76\x53\x52\x2b\x38\x53\x6e\x76\x33\x78\x41\x70\x51\x59\x2b\x66\x55\x4c\x4b\x2f\x78\x59\x38\x68\x38\x55\x61\x35\x31\x69\x58\x6f\x51\x35\x6a\x72\x67\x75\x32\x53\x71\x52\xd\xa"
    "\x9\x77\x67\x41\x37\x42\x55\x69\x33\x47\x38\x4c\x46\x7a\x4d\x42\x6c\x38\x46\x52\x43\x44\x59\x47\x55\x44\x79\x37\x4d\x36\x51\x61\x48\x58\x78\x31\x5a\x57\x49\x50\x57\x4e\x4b\x73\x43\x41\x77\x45\x41\x41\x61\x4f\x43\x41\x69\x51\x77\x67\x67\x49\x67\x4d\x41\x77\x47\xd\xa"
    "\x9\x41\x31\x55\x64\x45\x77\x45\x42\x2f\x77\x51\x43\x4d\x41\x41\x77\x45\x51\x59\x4a\x59\x49\x5a\x49\x41\x59\x62\x34\x51\x67\x48\x54\x54\x50\x41\x51\x44\x41\x67\x57\x67\x4d\x41\x34\x47\x41\x31\x55\x64\x44\x77\x45\x42\x2f\x77\x51\x45\x41\x77\x49\x44\x36\x44\x41\x73\xd\xa"
    "\x9\x42\x67\x6c\x67\x68\x6b\x67\x42\x68\x76\x68\x43\x41\x51\x30\x45\x48\x78\x59\x64\x56\x55\x73\x67\x5a\x53\x31\x54\x59\x32\x6c\x6c\x62\x6d\x4e\x6c\x49\x46\x56\x7a\x5a\x58\x49\x67\x51\x32\x56\x79\x64\x47\x6c\x6d\x61\x57\x4e\x68\x64\x47\x55\x77\x48\x51\x59\x44\xd\xa"
    "\x9\x56\x52\x30\x4f\x42\x42\x59\x45\x46\x44\x54\x74\x2f\x73\x66\x39\x50\x65\x4d\x61\x5a\x44\x48\x6b\x55\x49\x6c\x64\x72\x44\x59\x4d\x4e\x54\x42\x5a\x4d\x49\x47\x61\x42\x67\x4e\x56\x48\x53\x4d\x45\x67\x5a\x49\x77\x67\x59\x2b\x41\x46\x41\x49\x34\x71\x78\x47\x6a\xd\xa"
    "\x9\x6c\x6f\x43\x4c\x44\x64\x4d\x56\x4b\x77\x69\x6c\x6a\x6a\x44\x61\x73\x74\x71\x6f\x6f\x58\x53\x6b\x63\x6a\x42\x77\x4d\x51\x73\x77\x43\x51\x59\x44\x56\x51\x51\x47\x45\x77\x4a\x56\x53\x7a\x45\x52\x4d\x41\x38\x47\x41\x31\x55\x45\x43\x68\x4d\x49\x5a\x56\x4e\x6a\xd\xa"
    "\x9\x61\x57\x56\x75\x59\x32\x55\x78\x45\x6a\x41\x51\x42\x67\x4e\x56\x42\x41\x73\x54\x43\x55\x46\x31\x64\x47\x68\x76\x63\x6d\x6c\x30\x65\x54\x45\x4c\x4d\x41\x6b\x47\x41\x31\x55\x45\x41\x78\x4d\x43\x51\x30\x45\x78\x4c\x54\x41\x72\x42\x67\x6b\x71\x68\x6b\x69\x47\xd\xa"
    "\x9\x39\x77\x30\x42\x43\x51\x45\x57\x48\x6d\x4e\x68\x4c\x57\x39\x77\x5a\x58\x4a\x68\x64\x47\x39\x79\x51\x47\x64\x79\x61\x57\x51\x74\x63\x33\x56\x77\x63\x47\x39\x79\x64\x43\x35\x68\x59\x79\x35\x31\x61\x34\x49\x42\x41\x44\x41\x70\x42\x67\x4e\x56\x48\x52\x49\x45\xd\xa"
    "\x9\x49\x6a\x41\x67\x67\x52\x35\x6a\x59\x53\x31\x76\x63\x47\x56\x79\x59\x58\x52\x76\x63\x6b\x42\x6e\x63\x6d\x6c\x6b\x4c\x58\x4e\x31\x63\x48\x42\x76\x63\x6e\x51\x75\x59\x57\x4d\x75\x64\x57\x73\x77\x47\x51\x59\x44\x56\x52\x30\x67\x42\x42\x49\x77\x45\x44\x41\x4f\xd\xa"
    "\x9\x42\x67\x77\x72\x42\x67\x45\x45\x41\x64\x6b\x76\x41\x51\x45\x42\x41\x51\x59\x77\x50\x51\x59\x4a\x59\x49\x5a\x49\x41\x59\x62\x34\x51\x67\x45\x45\x42\x44\x41\x57\x4c\x6d\x68\x30\x64\x48\x41\x36\x4c\x79\x39\x6a\x59\x53\x35\x6e\x63\x6d\x6c\x6b\x4c\x58\x4e\x31\xd\xa"
    "\x9\x63\x48\x42\x76\x63\x6e\x51\x75\x59\x57\x4d\x75\x64\x6d\x54\x34\x73\x6f\x70\x77\x71\x6c\x42\x57\x73\x76\x63\x48\x56\x69\x4c\x32\x4e\x79\x62\x43\x39\x6a\x59\x57\x4e\x79\x62\x43\x35\x6a\x63\x6d\x77\x77\x50\x51\x59\x4a\x59\x49\x5a\x49\x41\x59\x62\x34\x51\x67\x45\x44\x42\x44\x41\x57\x4c\x6d\x68\x30\xd\xa"
    "\x9\x64\x48\x41\x36\x4c\x79\x39\x6a\x59\x53\x35\x6e\x63\x6d\x6c\x6b\x4c\x58\x4e\x31\x63\x48\x42\x76\x63\x6e\x51\x75\x59\x57\x4d\x75\x64\x57\x73\x76\x63\x48\x56\x69\x4c\x32\x4e\x79\x62\x43\x39\x6a\x59\x57\x4e\x79\x62\x43\x35\x6a\x63\x6d\x77\x77\x50\x77\x59\x44\xd\xa"
    "\x9\x56\x52\x30\x66\x42\x44\x67\x77\x4e\x6a\x41\x30\x6f\x44\x4b\x67\x4d\x49\x59\x75\x61\x48\x52\x30\x63\x44\x6f\x76\x4c\x32\x4e\x68\x4c\x6d\x64\x79\x61\x57\x51\x74\x35\x68\x59\x79\x35\x31\x61\x79\x39\x77\x64\x57\x49\x76\xd\xa"
    "\x9\x59\x33\x4a\x73\x4c\x32\x4e\x68\x59\x33\x4a\x73\x4c\x6d\x4e\x79\x62\x44\x41\x4e\x42\x67\x6b\x71\x68\x6b\x69\x47\x39\x77\x30\x42\x41\x51\x55\x46\x41\x41\x4f\x43\x41\x51\x45\x41\x53\x2f\x55\x34\x69\x69\x6f\x6f\x42\x45\x4e\x47\x57\x2f\x48\x77\x6d\x6d\x64\x33\xd\xa"
    "\x9\x58\x43\x79\x36\x5a\x72\x74\x30\x38\x59\x6a\x4b\x43\x7a\x47\x4e\x6a\x6f\x72\x54\x39\x38\x67\x38\x75\x47\x73\x71\x59\x6a\x53\x78\x76\x2f\x68\x6d\x69\x30\x71\x6c\x6e\x6c\x48\x73\x2b\x6b\x2f\x33\x49\x6f\x62\x63\x33\x4c\x6a\x53\x35\x41\x4d\x59\x72\x35\x4c\x38\xd\xa"
    "\x9\x55\x4f\x37\x4f\x53\x6b\x67\x46\x46\x6c\x4c\x48\x51\x79\x43\x39\x4a\x7a\x50\x66\x6d\x4c\x43\x41\x75\x67\x76\x7a\x45\x62\x79\x76\x34\x4f\x6c\x6e\x73\x72\x38\x68\x62\x78\x46\x31\x4d\x62\x4b\x5a\x6f\x51\x78\x55\x5a\x74\x4d\x56\x75\x32\x39\x77\x6a\x66\x58\x6b\xd\xa"
    "\x9\x68\x54\x65\x41\x70\x42\x76\x37\x65\x61\x4b\x43\x57\x70\x53\x70\x37\x4d\x43\x62\x76\x67\x7a\x6d\x37\x34\x69\x7a\x4b\x68\x75\x33\x76\x6c\x44\x6b\x39\x77\x36\x71\x56\x72\x78\x65\x50\x66\x47\x67\x70\x4b\x50\x71\x66\x48\x69\x4f\x6f\x47\x68\x46\x6e\x62\x54\x4b\xd\xa"
    "\x9\x77\x54\x43\x36\x6f\x32\x78\x71\x35\x79\x30\x71\x5a\x30\x33\x4a\x6f\x6e\x46\x37\x4f\x4a\x73\x70\x45\x64\x33\x49\x35\x7a\x4b\x59\x33\x45\x2b\x6f\x76\x37\x2f\x5a\x68\x57\x36\x44\x71\x54\x38\x55\x46\x76\x73\x41\x64\x6a\x76\x51\x62\x58\x79\x68\x56\x38\x45\x75\xd\xa"
    "\x9\x59\x68\x69\x78\x77\x31\x61\x4b\x45\x50\x7a\x4e\x6a\x4e\x6f\x77\x75\x49\x73\x65\x56\x6f\x67\x4b\x4f\x4c\x58\x78\x57\x49\x35\x76\x41\x69\x35\x48\x67\x58\x64\x53\x30\x2f\x45\x53\x35\x67\x44\x47\x73\x41\x42\x6f\x34\x66\x71\x6f\x76\x55\x4b\x6c\x67\x6f\x70\x33\xd\xa"
    "\x9\x52\x41\x3d\x3d\xd\xa"
    "\x9\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x43\x45\x52\x54\x49\x46\x49\x43\x41\x54\x45\x2d\x2d\x2d\x2d\x2d\xd\xa"
    "\xd\xa";
  test_simple(dumbluck2, HPE_OK);

  const char *corrupted_connection =
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
    "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
    "\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\xd\x03\x33\x06\x35\x5c\x33\x32\x35\x65\x65\x70\x2d\x41\x6c\x69\x76\x65\xd\xa"
    "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x67\x7a\x69\x70\xd\xa"
    "\xd\xa";
  test_simple(corrupted_connection, HPE_INVALID_HEADER_TOKEN);

  const char *corrupted_header_name =
    "\x47\x45\x54\x20\x2f\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
    "\x48\x6f\x73\x74\x3a\x20\x77\x77\x77\x2e\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\xd\xa"
    "\x58\x2d\x53\x6f\x6d\x65\x2d\x48\x65\x61\x64\x65\x72\xd\x03\x33\x06\x35\x5c\x33\x32\x35\x65\x65\x70\x2d\x41\x6c\x69\x76\x65\xd\xa"
    "\x41\x63\x63\x65\x70\x74\x2d\x45\x6e\x63\x6f\x64\x69\x6e\x67\x3a\x20\x67\x7a\x69\x70\xd\xa"
    "\xd\xa";
  test_simple(corrupted_header_name, HPE_INVALID_HEADER_TOKEN);

#if 0
  // NOTE(Wed Nov 18 11:57:27 CET 2009) this seems okay. we just read body
  // until EOF.
  //
  // no content-length
  // error if there is a body without content length
  const char *bad_get_no_headers_no_body = "\x47\x45\x54\x20\x2f\x62\x61\x64\x5f\x67\x65\x74\x5f\x6e\x6f\x5f\x68\x65\x61\x64\x65\x72\x73\x5f\x6e\x6f\x5f\x62\x6f\x64\x79\x2f\x77\x6f\x72\x6c\x64\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\xd\xa"
                                           "\x41\x63\x63\x65\x70\x74\x3a\x20\x2a\x2f\x2a\xd\xa"
                                           "\xd\xa"
                                           "\x48\x45\x4c\x4c\x4f";
  test_simple(bad_get_no_headers_no_body, 0);
#endif
  /* TODO sending junk and large headers gets rejected */


  /* check to make sure our predefined requests are okay */
  for (i = 0; i < ARRAY_SIZE(requests); i++) {
    test_message(&requests[i]);
  }

  for (i = 0; i < ARRAY_SIZE(requests); i++) {
    test_message_pause(&requests[i]);
  }

  for (i = 0; i < ARRAY_SIZE(requests); i++) {
    if (!requests[i].should_keep_alive) continue;
    for (j = 0; j < ARRAY_SIZE(requests); j++) {
      if (!requests[j].should_keep_alive) continue;
      for (k = 0; k < ARRAY_SIZE(requests); k++) {
        test_multiple3(&requests[i], &requests[j], &requests[k]);
      }
    }
  }

  printf("request scan 1/4      ");
  test_scan( &requests[GET_NO_HEADERS_NO_BODY]
           , &requests[GET_ONE_HEADER_NO_BODY]
           , &requests[GET_NO_HEADERS_NO_BODY]
           );

  printf("request scan 2/4      ");
  test_scan( &requests[POST_CHUNKED_ALL_YOUR_BASE]
           , &requests[POST_IDENTITY_BODY_WORLD]
           , &requests[GET_FUNKY_CONTENT_LENGTH]
           );

  printf("request scan 3/4      ");
  test_scan( &requests[TWO_CHUNKS_MULT_ZERO_END]
           , &requests[CHUNKED_W_TRAILING_HEADERS]
           , &requests[CHUNKED_W_NONSENSE_AFTER_LENGTH]
           );

  printf("request scan 4/4      ");
  test_scan( &requests[QUERY_URL_WITH_QUESTION_MARK_GET]
           , &requests[PREFIX_NEWLINE_GET ]
           , &requests[CONNECT_REQUEST]
           );

  puts("\x72\x65\x71\x75\x65\x73\x74\x73\x20\x6f\x6b\x61\x79");

  return 0;
}
